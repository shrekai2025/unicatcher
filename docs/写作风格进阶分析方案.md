# 写作风格进阶分析方案

## 🎯 新增分析维度概览

当前系统主要分析**词汇、句法、类型、专业度**，需要增加：

1. **全文结构分析** - 文章组织逻辑和叙述模式
2. **典型句式模板** - 高频使用的句子结构
3. **吸引力机制分析** - 为什么这篇推文能引起关注
4. **情绪钩子识别** - 如何设置和触发情感反应
5. **叙述风格分析** - 故事性、说服性、互动性等

## 📖 全文结构分析 (Document Structure Analysis)

### 核心目标
识别用户习惯的**行文结构**和**逻辑组织方式**

### 分析维度

#### 1. 开头模式识别
```typescript
interface OpeningPatterns {
  questionHook: number;        // "你知道吗？" 疑问开头比例
  statementHook: number;       // "今天发生了..." 陈述开头
  dataHook: number;           // "数据显示..." 数据开头
  storyHook: number;          // "昨天遇到一件事..." 故事开头
  contrastHook: number;       // "很多人以为...但实际上..." 对比开头
  urgencyHook: number;        // "刚刚！突发！" 紧急开头
}
```

**实现逻辑**：
```javascript
analyzeOpeningPatterns(tweets) {
  const patterns = {
    questionHook: 0,
    statementHook: 0,
    dataHook: 0,
    storyHook: 0,
    contrastHook: 0,
    urgencyHook: 0
  };

  tweets.forEach(tweet => {
    const opening = tweet.content.substring(0, 20);

    // 疑问开头
    if (/^(你知道|有没有人|大家觉得|是否|为什么|如何|怎么)/.test(opening)) {
      patterns.questionHook++;
    }

    // 数据开头
    if (/^(数据显示|研究表明|统计发现|调查显示|\d+%)/.test(opening)) {
      patterns.dataHook++;
    }

    // 故事开头
    if (/^(今天|昨天|刚刚|刚才|上周|前几天).*?(遇到|发生|看到|听到)/.test(opening)) {
      patterns.storyHook++;
    }

    // 对比开头
    if (/(很多人以为|大家都说|传统观念|以前我也|但实际上|然而)/.test(opening)) {
      patterns.contrastHook++;
    }

    // 紧急开头
    if (/^(刚刚|突发|最新|重磅|震惊)/.test(opening)) {
      patterns.urgencyHook++;
    }

    // 默认陈述开头
    if (Object.values(patterns).every(v => v === 0)) {
      patterns.statementHook++;
    }
  });

  return patterns;
}
```

#### 2. 中间展开模式
```typescript
interface DevelopmentPatterns {
  listStructure: number;       // 列举式：1）2）3）
  storyNarrative: number;      // 故事叙述：然后...接着...
  logicalArgument: number;     // 逻辑论证：因为...所以...
  exampleIllustration: number; // 举例说明：比如...例如...
  dataSupport: number;         // 数据支撑：数据显示...研究表明...
}
```

#### 3. 结尾收束模式
```typescript
interface ClosingPatterns {
  callToAction: number;        // "大家怎么看？" 行动号召
  summaryClosing: number;      // "总的来说..." 总结式
  questionClosing: number;     // "你觉得呢？" 疑问式
  insightClosing: number;      // "这给我们的启发是..." 洞察式
  openEnding: number;          // 开放式结尾
}
```

#### 4. 逻辑流转模式
```typescript
interface LogicalFlow {
  problemSolution: number;     // 问题→解决方案
  causeEffect: number;         // 原因→结果
  beforeAfter: number;         // 对比前后
  generalSpecific: number;     // 总论→分论
  storyInsight: number;        // 故事→洞察
}
```

## 📝 典型句式模板分析 (Sentence Pattern Analysis)

### 核心目标
提取用户**高频使用的句子结构模板**，用于内容生成

### 分析方法

#### 1. 句式模板提取
```javascript
extractSentenceTemplates(tweets) {
  const templates = new Map();

  tweets.forEach(tweet => {
    const sentences = this.splitSentences(tweet.content);

    sentences.forEach(sentence => {
      // 提取句式结构模板
      const template = this.extractTemplate(sentence);

      if (template) {
        const count = templates.get(template) || 0;
        templates.set(template, count + 1);
      }
    });
  });

  // 返回高频模板（出现3次以上）
  return Array.from(templates.entries())
    .filter(([template, count]) => count >= 3)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 20);
}

extractTemplate(sentence) {
  // 将具体内容抽象化为模板
  return sentence
    .replace(/\d+/g, '[NUM]')           // 数字 → [NUM]
    .replace(/[a-zA-Z]+/g, '[ENG]')     // 英文 → [ENG]
    .replace(/机器学习|深度学习|AI/g, '[TECH]') // 技术词汇 → [TECH]
    .replace(/今天|昨天|明天/g, '[TIME]') // 时间词 → [TIME]
    .replace(/我|你|他/g, '[PERSON]');   // 人称 → [PERSON]
}
```

#### 2. 情感句式识别
```typescript
interface EmotionalTemplates {
  excitement: string[];        // 兴奋："太[ADJ]了！"
  surprise: string[];          // 惊讶："没想到[THING]竟然..."
  concern: string[];           // 担忧："[PERSON]觉得[THING]有点..."
  approval: string[];          // 赞同："[PERSON]说得对，[THING]确实..."
  questioning: string[];       // 质疑："但是[THING]真的[ADJ]吗？"
}
```

## 💡 吸引力机制分析 (Engagement Analysis)

### 核心目标
分析推文为什么能引起关注，识别**吸引力因素**

### 分析框架

#### 1. 内容吸引力分析
```typescript
interface ContentAttraction {
  noveltyScore: number;        // 新颖性评分
  controversyScore: number;    // 争议性评分
  practicalityScore: number;   // 实用性评分
  emotionalResonance: number;  // 情感共鸣度
  cognitiveLoad: number;       // 认知负担（越低越好）
}
```

**实现逻辑**：
```javascript
analyzeContentAttraction(tweet, engagementMetrics) {
  const content = tweet.content;
  let attraction = {
    noveltyScore: 0,
    controversyScore: 0,
    practicalityScore: 0,
    emotionalResonance: 0,
    cognitiveLoad: 0
  };

  // 新颖性：包含新概念、数据、发现
  if (/首次|最新|突破|发现|新的|创新/.test(content)) {
    attraction.noveltyScore += 0.3;
  }
  if (/\d+%/.test(content)) { // 具体数据增加新颖性
    attraction.noveltyScore += 0.2;
  }

  // 争议性：对立观点、批评、质疑
  if (/(但是|然而|不过|反对|质疑|争议|问题)/.test(content)) {
    attraction.controversyScore += 0.3;
  }

  // 实用性：教程、技巧、方法、工具
  if (/(如何|方法|技巧|工具|步骤|攻略)/.test(content)) {
    attraction.practicalityScore += 0.4;
  }

  // 情感共鸣：第一人称、情感词汇
  if (/(我觉得|我发现|让我|令我|感到|觉得)/.test(content)) {
    attraction.emotionalResonance += 0.2;
  }

  // 认知负担：句子长度、复杂度
  const avgSentenceLength = content.length / this.splitSentences(content).length;
  attraction.cognitiveLoad = Math.min(avgSentenceLength / 30, 1.0);

  return attraction;
}
```

#### 2. 结构吸引力分析
```typescript
interface StructuralAttraction {
  hookStrength: number;        // 开头钩子强度
  flowSmoothness: number;      // 逻辑流畅度
  climaxPlacement: number;     // 高潮位置优化
  closingPower: number;        // 结尾影响力
}
```

## 🎣 情绪钩子识别与分析 (Emotional Hook Analysis)

### 核心目标
识别如何设置**情绪触发点**和**互动钩子**

### 钩子类型体系

#### 1. 开头钩子 (Opening Hooks)
```typescript
interface OpeningHooks {
  curiosityGap: {              // 好奇心缺口
    pattern: string;           // "你知道...吗？但实际上..."
    effectiveness: number;     // 有效性评分
    examples: string[];        // 实际使用例子
  };

  personalStory: {             // 个人故事
    pattern: string;           // "昨天遇到一件事..."
    effectiveness: number;
    examples: string[];
  };

  controversialStatement: {    // 争议性观点
    pattern: string;           // "很多人都错了..."
    effectiveness: number;
    examples: string[];
  };

  dataShock: {                // 数据冲击
    pattern: string;           // "你绝对想不到，...竟然有[NUM]%"
    effectiveness: number;
    examples: string[];
  };
}
```

#### 2. 中间维持钩子 (Sustaining Hooks)
```typescript
interface SustainingHooks {
  progressiveRevelation: number;  // 渐进揭示："更重要的是..."
  unexpectedTurn: number;         // 意外转折："但是..."
  personalConnection: number;     // 个人连接："这让我想到..."
  readerInvolvement: number;      // 读者卷入："你是否也..."
}
```

#### 3. 结尾钩子 (Closing Hooks)
```typescript
interface ClosingHooks {
  callToAction: number;        // 行动号召："你怎么看？"
  cliffhanger: number;         // 悬念："下次分享..."
  emotionalResonance: number;  // 情感共鸣："希望对你有帮助"
  thoughtProvoking: number;    // 引发思考："这让我们思考..."
}
```

## 📊 叙述风格分析 (Narrative Style Analysis)

### 核心目标
识别用户的**叙述偏好**和**表达风格**

```typescript
interface NarrativeStyle {
  storytelling: {              // 故事性
    usePersonalAnecdotes: number;    // 个人轶事使用率
    chronologicalOrder: number;      // 时间顺序叙述
    characterDevelopment: number;    // 人物塑造
  };

  persuasion: {               // 说服性
    logicalArgument: number;        // 逻辑论证
    evidenceSupport: number;        // 证据支持
    emotionalAppeal: number;        // 情感诉求
  };

  interaction: {              // 互动性
    directAddress: number;          // 直接称呼读者
    questionEngagement: number;     // 提问互动
    conversationalTone: number;     // 对话语调
  };

  authority: {                // 权威性
    expertiseDisplay: number;       // 专业知识展示
    confidenceLevel: number;        // 语气自信程度
    citationUsage: number;         // 引用使用
  };
}
```

## 🏗️ 实施架构设计

### 1. 新增数据表结构

```sql
-- 扩展用户风格档案表
ALTER TABLE user_style_profile ADD COLUMN
  opening_patterns TEXT,           -- 开头模式分析结果
  development_patterns TEXT,       -- 中间展开模式
  closing_patterns TEXT,          -- 结尾模式
  sentence_templates TEXT,        -- 句式模板
  attraction_factors TEXT,        -- 吸引力因素
  emotional_hooks TEXT,           -- 情绪钩子
  narrative_style TEXT;           -- 叙述风格

-- 新增推文吸引力分析表
CREATE TABLE tweet_attraction_analysis (
  id TEXT PRIMARY KEY,
  tweet_id TEXT NOT NULL,
  username TEXT NOT NULL,

  -- 吸引力评分
  novelty_score REAL DEFAULT 0,
  controversy_score REAL DEFAULT 0,
  practicality_score REAL DEFAULT 0,
  emotional_resonance REAL DEFAULT 0,

  -- 钩子识别
  opening_hook_type TEXT,
  sustaining_hooks TEXT,           -- JSON数组
  closing_hook_type TEXT,

  -- 结构分析
  logical_flow_type TEXT,
  climax_position REAL,            -- 高潮位置 (0-1)

  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (tweet_id) REFERENCES writing_analysis_tweet(id)
);

-- 句式模板库
CREATE TABLE sentence_templates (
  id TEXT PRIMARY KEY,
  username TEXT NOT NULL,
  template_pattern TEXT NOT NULL,  -- 句式模板
  frequency INTEGER DEFAULT 1,     -- 使用频率
  category TEXT,                   -- 类别：opening/development/closing
  emotion_type TEXT,               -- 情感类型
  effectiveness_score REAL,        -- 有效性评分
  examples TEXT,                   -- JSON: 实际例子
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 2. 服务架构扩展

```typescript
// 新增高级风格分析服务
export class AdvancedStyleAnalysisService extends StyleAnalysisService {

  // 全文结构分析
  async analyzeDocumentStructure(tweets: Tweet[]): Promise<DocumentStructure> {
    const openingPatterns = this.analyzeOpeningPatterns(tweets);
    const developmentPatterns = this.analyzeDevelopmentPatterns(tweets);
    const closingPatterns = this.analyzeClosingPatterns(tweets);
    const logicalFlows = this.analyzeLogicalFlows(tweets);

    return {
      openingPatterns,
      developmentPatterns,
      closingPatterns,
      logicalFlows
    };
  }

  // 吸引力机制分析
  async analyzeAttraction(tweet: Tweet, engagementMetrics?: EngagementMetrics): Promise<AttractionAnalysis> {
    const contentAttraction = this.analyzeContentAttraction(tweet, engagementMetrics);
    const structuralAttraction = this.analyzeStructuralAttraction(tweet);
    const emotionalHooks = this.identifyEmotionalHooks(tweet);

    return {
      contentAttraction,
      structuralAttraction,
      emotionalHooks,
      overallScore: this.calculateOverallAttraction(contentAttraction, structuralAttraction, emotionalHooks)
    };
  }

  // 句式模板提取
  async extractSentenceTemplates(username: string): Promise<SentenceTemplate[]> {
    const tweets = await this.getUserTweets(username);
    const templates = this.extractTemplatePatterns(tweets);

    // 保存到数据库
    await this.saveSentenceTemplates(username, templates);

    return templates;
  }

  // 叙述风格分析
  async analyzeNarrativeStyle(tweets: Tweet[]): Promise<NarrativeStyle> {
    return {
      storytelling: this.analyzeStorytellingStyle(tweets),
      persuasion: this.analyzePersuasionStyle(tweets),
      interaction: this.analyzeInteractionStyle(tweets),
      authority: this.analyzeAuthorityStyle(tweets)
    };
  }
}
```

### 3. API 接口扩展

```typescript
// POST /api/writing-analysis/advanced-style
export async function POST(request: NextRequest) {
  const { username, analysisType = 'full' } = await request.json();

  const advancedService = new AdvancedStyleAnalysisService();

  const results = await advancedService.analyzeAdvancedStyle(username, {
    includeStructure: analysisType === 'full',
    includeAttraction: analysisType === 'full',
    includeTemplates: true,
    includeNarrative: analysisType === 'full'
  });

  return NextResponse.json({
    success: true,
    data: results
  });
}
```

## 🎯 应用场景

### 1. 内容生成优化
```javascript
// 基于用户的高频开头模式生成
if (user.openingPatterns.questionHook > 0.3) {
  // 30%以上使用疑问开头，优先生成疑问式开头
  generatedOpening = generateQuestionHook(topic);
}
```

### 2. 吸引力预测
```javascript
// 预测生成内容的吸引力分数
const attractionScore = predictAttraction({
  content: generatedTweet,
  userStyle: userStyleProfile,
  topic: inputTopic
});

if (attractionScore < 0.6) {
  // 吸引力不足，重新生成或优化
  generatedTweet = enhanceAttraction(generatedTweet, userStyleProfile);
}
```

### 3. 个性化推荐
```javascript
// 基于用户风格推荐写作建议
const suggestions = generateWritingSuggestions({
  userWeaknesses: styleProfile.weakAreas,
  effectivePatterns: styleProfile.highPerformingPatterns,
  currentTopic: inputTopic
});
```

## 📈 进阶效果预期

实施这个进阶方案后，系统将能够：

1. **精准风格建模**: 从句式到结构全面建模用户写作风格
2. **吸引力预测**: 预测内容的传播潜力和用户参与度
3. **智能优化建议**: 提供具体的写作改进建议
4. **个性化生成**: 生成更符合用户风格和习惯的内容
5. **情绪设计**: 有意识地设计情绪触发点和互动钩子

这个方案将写作风格分析从**基础特征识别**提升到**深度模式洞察**的水平！🚀