# è¿›é˜¶é£æ ¼åˆ†æåŠŸèƒ½å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å®ç°å’Œåº”ç”¨5ä¸ªè¿›é˜¶é£æ ¼åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°æ®åº“è®¾è®¡ã€åˆ†æç®—æ³•ã€APIæ¥å£ã€å‰ç«¯å±•ç¤ºï¼Œä»¥åŠåœ¨å†…å®¹ç”Ÿæˆä¸­çš„å…·ä½“åº”ç”¨æ–¹å¼ã€‚

---

## ğŸ¯ åŠŸèƒ½1ï¼šå¼€å¤´æ¨¡å¼è¯†åˆ«

### 1.1 åˆ†æç›®æ ‡

è¯†åˆ«ç”¨æˆ·ä¹ æƒ¯çš„**å¼€å¤´å¥—è·¯**ï¼ŒåŒ…æ‹¬ï¼š
- ç–‘é—®å¼€å¤´ï¼ˆ"ä½ çŸ¥é“å—ï¼Ÿ"ï¼‰
- æ•°æ®å¼€å¤´ï¼ˆ"æ•°æ®æ˜¾ç¤º..."ï¼‰
- æ•…äº‹å¼€å¤´ï¼ˆ"æ˜¨å¤©é‡åˆ°..."ï¼‰
- å¯¹æ¯”å¼€å¤´ï¼ˆ"å¾ˆå¤šäººä»¥ä¸º...ä½†å®é™…ä¸Š..."ï¼‰
- ç´§æ€¥å¼€å¤´ï¼ˆ"åˆšåˆšï¼çªå‘ï¼"ï¼‰
- é™ˆè¿°å¼€å¤´ï¼ˆç›´æ¥é™ˆè¿°äº‹å®ï¼‰

### 1.2 æ•°æ®åº“è®¾è®¡

#### æ‰©å±• user_style_profile è¡¨
```sql
ALTER TABLE user_style_profile ADD COLUMN
  -- å¼€å¤´æ¨¡å¼åˆ†å¸ƒï¼ˆJSONï¼‰
  opening_patterns TEXT;

-- ç¤ºä¾‹æ•°æ®æ ¼å¼
{
  "questionHook": 0.30,      // 30%ä½¿ç”¨ç–‘é—®å¼€å¤´
  "dataHook": 0.25,          // 25%ä½¿ç”¨æ•°æ®å¼€å¤´
  "storyHook": 0.20,         // 20%ä½¿ç”¨æ•…äº‹å¼€å¤´
  "contrastHook": 0.15,      // 15%ä½¿ç”¨å¯¹æ¯”å¼€å¤´
  "urgencyHook": 0.05,       // 5%ä½¿ç”¨ç´§æ€¥å¼€å¤´
  "statementHook": 0.05,     // 5%ä½¿ç”¨é™ˆè¿°å¼€å¤´
  "examples": {
    "questionHook": ["ä½ çŸ¥é“å—", "æœ‰æ²¡æœ‰æƒ³è¿‡", "ä¸ºä»€ä¹ˆä¼š"],
    "dataHook": ["æ•°æ®æ˜¾ç¤º", "ç ”ç©¶è¡¨æ˜", "ç»Ÿè®¡å‘ç°"],
    "storyHook": ["æ˜¨å¤©é‡åˆ°", "æœ€è¿‘å‘ç°", "åˆšåˆšçœ‹åˆ°"],
    "contrastHook": ["å¾ˆå¤šäººä»¥ä¸º...ä½†å®é™…ä¸Š", "ä¼ ç»Ÿè§‚ç‚¹è®¤ä¸º...ç„¶è€Œ"],
    "urgencyHook": ["åˆšåˆš", "çªå‘", "æœ€æ–°"]
  }
}
```

### 1.3 åˆ†æç®—æ³•å®ç°

```typescript
// src/server/services/advanced-style-analysis.ts

interface OpeningPatterns {
  questionHook: number;
  dataHook: number;
  storyHook: number;
  contrastHook: number;
  urgencyHook: number;
  statementHook: number;
  examples: Record<string, string[]>;
}

export class AdvancedStyleAnalysisService {

  /**
   * åˆ†æå¼€å¤´æ¨¡å¼
   */
  analyzeOpeningPatterns(tweets: Array<{content: string}>): OpeningPatterns {
    const patterns = {
      questionHook: 0,
      dataHook: 0,
      storyHook: 0,
      contrastHook: 0,
      urgencyHook: 0,
      statementHook: 0,
    };

    const examples: Record<string, Set<string>> = {
      questionHook: new Set(),
      dataHook: new Set(),
      storyHook: new Set(),
      contrastHook: new Set(),
      urgencyHook: new Set(),
    };

    tweets.forEach(tweet => {
      const content = tweet.content.trim();
      // æå–å¼€å¤´ï¼ˆå‰30ä¸ªå­—ç¬¦ï¼‰
      const opening = content.substring(0, Math.min(30, content.length));

      let matched = false;

      // 1. ç–‘é—®å¼€å¤´
      const questionPatterns = [
        /^(ä½ çŸ¥é“|æœ‰æ²¡æœ‰|æ˜¯å¦|ä¸ºä»€ä¹ˆ|å¦‚ä½•|æ€ä¹ˆ|ä»€ä¹ˆæ˜¯|èƒ½ä¸èƒ½|å¯ä»¥å—)/,
        /\?$/,  // å¼€å¤´å°±æ˜¯é—®å·ç»“å°¾
      ];
      if (questionPatterns.some(p => p.test(opening))) {
        patterns.questionHook++;
        const match = opening.match(/^([^ï¼Œã€‚ï¼ï¼Ÿ]{2,8})/);
        if (match) examples.questionHook.add(match[1]);
        matched = true;
      }

      // 2. æ•°æ®å¼€å¤´
      const dataPatterns = [
        /^(æ•°æ®æ˜¾ç¤º|ç ”ç©¶è¡¨æ˜|ç»Ÿè®¡å‘ç°|è°ƒæŸ¥æ˜¾ç¤º|æŠ¥å‘ŠæŒ‡å‡º)/,
        /^\d+%/,  // ç›´æ¥ä»¥ç™¾åˆ†æ¯”å¼€å¤´
        /^æ ¹æ®.*?(æ•°æ®|ç ”ç©¶|è°ƒæŸ¥)/,
      ];
      if (!matched && dataPatterns.some(p => p.test(opening))) {
        patterns.dataHook++;
        const match = opening.match(/^([^ï¼Œã€‚]{2,10})/);
        if (match) examples.dataHook.add(match[1]);
        matched = true;
      }

      // 3. æ•…äº‹å¼€å¤´
      const storyPatterns = [
        /^(ä»Šå¤©|æ˜¨å¤©|åˆšåˆš|åˆšæ‰|ä¸Šå‘¨|å‰å‡ å¤©|æœ€è¿‘)/,
        /^(ä»Šå¤©|æ˜¨å¤©|åˆšåˆš|åˆšæ‰|æœ€è¿‘).{0,5}(é‡åˆ°|å‘ç”Ÿ|çœ‹åˆ°|å¬åˆ°|å‘ç°)/,
      ];
      if (!matched && storyPatterns.some(p => p.test(opening))) {
        patterns.storyHook++;
        const match = opening.match(/^([^ï¼Œã€‚]{2,10})/);
        if (match) examples.storyHook.add(match[1]);
        matched = true;
      }

      // 4. å¯¹æ¯”å¼€å¤´
      const contrastPatterns = [
        /å¾ˆå¤šäºº(ä»¥ä¸º|è®¤ä¸º|è§‰å¾—|è¯´)/,
        /ä¼ ç»Ÿ(è§‚å¿µ|çœ‹æ³•|è®¤çŸ¥)/,
        /(ä»¥å‰|è¿‡å»).{0,5}(æˆ‘ä¹Ÿ|å¤§å®¶éƒ½)/,
        /(ä½†æ˜¯|ç„¶è€Œ|ä¸è¿‡).{0,10}(å®é™…ä¸Š|å…¶å®|äº‹å®ä¸Š)/,
      ];
      if (!matched && contrastPatterns.some(p => p.test(content.substring(0, 50)))) {
        patterns.contrastHook++;
        const match = opening.match(/^([^ï¼Œã€‚]{2,15})/);
        if (match) examples.contrastHook.add(match[1]);
        matched = true;
      }

      // 5. ç´§æ€¥å¼€å¤´
      const urgencyPatterns = [
        /^(åˆšåˆš|çªå‘|æœ€æ–°|é‡ç£…|éœ‡æƒŠ|æ³¨æ„)/,
        /^ï¼/,
      ];
      if (!matched && urgencyPatterns.some(p => p.test(opening))) {
        patterns.urgencyHook++;
        const match = opening.match(/^([^ï¼Œã€‚ï¼]{2,8})/);
        if (match) examples.urgencyHook.add(match[1]);
        matched = true;
      }

      // 6. é»˜è®¤ä¸ºé™ˆè¿°å¼€å¤´
      if (!matched) {
        patterns.statementHook++;
      }
    });

    // è½¬æ¢ä¸ºæ¯”ä¾‹
    const total = tweets.length;
    const result: OpeningPatterns = {
      questionHook: patterns.questionHook / total,
      dataHook: patterns.dataHook / total,
      storyHook: patterns.storyHook / total,
      contrastHook: patterns.contrastHook / total,
      urgencyHook: patterns.urgencyHook / total,
      statementHook: patterns.statementHook / total,
      examples: {
        questionHook: Array.from(examples.questionHook).slice(0, 5),
        dataHook: Array.from(examples.dataHook).slice(0, 5),
        storyHook: Array.from(examples.storyHook).slice(0, 5),
        contrastHook: Array.from(examples.contrastHook).slice(0, 5),
        urgencyHook: Array.from(examples.urgencyHook).slice(0, 5),
      }
    };

    return result;
  }

  /**
   * ä¿å­˜å¼€å¤´æ¨¡å¼åˆ°æ•°æ®åº“
   */
  async saveOpeningPatterns(username: string, contentType: string, patterns: OpeningPatterns): Promise<void> {
    await db.userStyleProfile.update({
      where: {
        username_contentType: {
          username,
          contentType
        }
      },
      data: {
        openingPatterns: JSON.stringify(patterns)
      }
    });
  }
}
```

### 1.4 åœ¨å†…å®¹ç”Ÿæˆä¸­çš„åº”ç”¨

#### åº”ç”¨åœºæ™¯1ï¼šå¤§çº²ç”Ÿæˆé˜¶æ®µ

```typescript
async function generateOutlineWithOpeningStyle(task: any): Promise<string> {
  // 1. åŠ è½½ç”¨æˆ·é£æ ¼æ¡£æ¡ˆ
  const profile = await db.userStyleProfile.findUnique({
    where: {
      username_contentType: {
        username: task.username,
        contentType: task.contentType
      }
    }
  });

  if (!profile?.openingPatterns) {
    return generateOutline(task); // å›é€€åˆ°é»˜è®¤æ–¹å¼
  }

  // 2. è§£æå¼€å¤´æ¨¡å¼
  const patterns = JSON.parse(profile.openingPatterns) as OpeningPatterns;

  // 3. é€‰æ‹©æœ€å¸¸ç”¨çš„å¼€å¤´æ¨¡å¼
  const topPattern = getTopPattern(patterns);

  // 4. æ„å»ºå¼€å¤´æŒ‡ä»¤
  const openingInstruction = buildOpeningInstruction(topPattern, patterns);

  const prompt = `
è¯·ä¸ºä»¥ä¸‹ä¸»é¢˜ç”Ÿæˆæ–‡ç« å¤§çº²ï¼š

ä¸»é¢˜ï¼š${task.topic}
å¹³å°ï¼š${task.platform.name}

${openingInstruction}

å¤§çº²è¦æ±‚ï¼š
1. å¼€å¤´éƒ¨åˆ†è¦ç‰¹åˆ«è®¾è®¡ï¼Œç¬¦åˆç”¨æˆ·ä¹ æƒ¯
2. åŒ…å«3-5ä¸ªä¸»è¦éƒ¨åˆ†
3. é€»è¾‘è¿è´¯
`;

  const aiService = AIServiceFactory.createService({...});
  return await aiService.generateText(prompt);
}

// è·å–æœ€å¸¸ç”¨çš„å¼€å¤´æ¨¡å¼
function getTopPattern(patterns: OpeningPatterns): string {
  const entries = Object.entries(patterns).filter(([key]) => key !== 'examples');
  entries.sort((a, b) => (b[1] as number) - (a[1] as number));
  return entries[0][0];
}

// æ„å»ºå¼€å¤´æŒ‡ä»¤
function buildOpeningInstruction(topPattern: string, patterns: OpeningPatterns): string {
  const patternMap: Record<string, string> = {
    questionHook: `
å¼€å¤´ç­–ç•¥ï¼šä½¿ç”¨ç–‘é—®å¥å¼€å¤´ï¼ˆç”¨æˆ·${(patterns.questionHook * 100).toFixed(0)}%çš„å†…å®¹ä½¿ç”¨æ­¤æ–¹å¼ï¼‰

ç”¨æˆ·å¸¸ç”¨çš„ç–‘é—®å¼€å¤´ç¤ºä¾‹ï¼š
${patterns.examples.questionHook.map((ex, i) => `${i+1}. ${ex}...`).join('\n')}

è¦æ±‚ï¼š
- å¼€å¤´ä½¿ç”¨å¼•äººæ€è€ƒçš„ç–‘é—®å¥
- å¯ä»¥æ˜¯åé—®ã€è®¾é—®æˆ–ç›´æ¥æé—®
- æ¿€å‘è¯»è€…çš„å¥½å¥‡å¿ƒå’Œæ€è€ƒæ¬²æœ›
`,
    dataHook: `
å¼€å¤´ç­–ç•¥ï¼šä½¿ç”¨æ•°æ®æˆ–ç ”ç©¶å¼€å¤´ï¼ˆç”¨æˆ·${(patterns.dataHook * 100).toFixed(0)}%çš„å†…å®¹ä½¿ç”¨æ­¤æ–¹å¼ï¼‰

ç”¨æˆ·å¸¸ç”¨çš„æ•°æ®å¼€å¤´ç¤ºä¾‹ï¼š
${patterns.examples.dataHook.map((ex, i) => `${i+1}. ${ex}...`).join('\n')}

è¦æ±‚ï¼š
- å¼€å¤´å¼•ç”¨å…·ä½“æ•°æ®ã€ç ”ç©¶æˆ–ç»Ÿè®¡
- å»ºç«‹æƒå¨æ€§å’Œå¯ä¿¡åº¦
- æ•°æ®è¦å‡†ç¡®ã€æœ‰è¯´æœåŠ›
`,
    storyHook: `
å¼€å¤´ç­–ç•¥ï¼šä½¿ç”¨æ•…äº‹æˆ–æ¡ˆä¾‹å¼€å¤´ï¼ˆç”¨æˆ·${(patterns.storyHook * 100).toFixed(0)}%çš„å†…å®¹ä½¿ç”¨æ­¤æ–¹å¼ï¼‰

ç”¨æˆ·å¸¸ç”¨çš„æ•…äº‹å¼€å¤´ç¤ºä¾‹ï¼š
${patterns.examples.storyHook.map((ex, i) => `${i+1}. ${ex}...`).join('\n')}

è¦æ±‚ï¼š
- å¼€å¤´è®²è¿°ä¸€ä¸ªçœŸå®æˆ–è™šæ„çš„å°æ•…äº‹
- å¢å¼ºä»£å…¥æ„Ÿå’Œæƒ…æ„Ÿå…±é¸£
- æ•…äº‹è¦ä¸ä¸»é¢˜ç›¸å…³
`,
    contrastHook: `
å¼€å¤´ç­–ç•¥ï¼šä½¿ç”¨å¯¹æ¯”æˆ–åå·®å¼€å¤´ï¼ˆç”¨æˆ·${(patterns.contrastHook * 100).toFixed(0)}%çš„å†…å®¹ä½¿ç”¨æ­¤æ–¹å¼ï¼‰

ç”¨æˆ·å¸¸ç”¨çš„å¯¹æ¯”å¼€å¤´ç¤ºä¾‹ï¼š
${patterns.examples.contrastHook.map((ex, i) => `${i+1}. ${ex}...`).join('\n')}

è¦æ±‚ï¼š
- å¼€å¤´å‘ˆç°å¸¸è§è¯¯è§£vsçœŸå®æƒ…å†µ
- åˆ¶é€ è®¤çŸ¥åå·®ï¼Œå¼•èµ·å…³æ³¨
- "å¾ˆå¤šäººä»¥ä¸º...ä½†å®é™…ä¸Š..."çš„ç»“æ„
`,
    urgencyHook: `
å¼€å¤´ç­–ç•¥ï¼šä½¿ç”¨ç´§æ€¥æˆ–æ–°é—»å¼å¼€å¤´ï¼ˆç”¨æˆ·${(patterns.urgencyHook * 100).toFixed(0)}%çš„å†…å®¹ä½¿ç”¨æ­¤æ–¹å¼ï¼‰

ç”¨æˆ·å¸¸ç”¨çš„ç´§æ€¥å¼€å¤´ç¤ºä¾‹ï¼š
${patterns.examples.urgencyHook.map((ex, i) => `${i+1}. ${ex}...`).join('\n')}

è¦æ±‚ï¼š
- å¼€å¤´å¼ºè°ƒæ—¶æ•ˆæ€§å’Œé‡è¦æ€§
- ä½¿ç”¨"åˆšåˆš"ã€"æœ€æ–°"ã€"çªå‘"ç­‰è¯æ±‡
- è¥é€ ç´§è¿«æ„Ÿ
`,
    statementHook: `
å¼€å¤´ç­–ç•¥ï¼šä½¿ç”¨ç›´æ¥é™ˆè¿°å¼€å¤´ï¼ˆç”¨æˆ·${(patterns.statementHook * 100).toFixed(0)}%çš„å†…å®¹ä½¿ç”¨æ­¤æ–¹å¼ï¼‰

è¦æ±‚ï¼š
- å¼€å¤´ç›´æ¥é™ˆè¿°æ ¸å¿ƒè§‚ç‚¹æˆ–äº‹å®
- ç®€æ´æ˜äº†ï¼Œä¸ç»•å¼¯å­
- é€‚åˆä¸“ä¸šæ€§å¼ºçš„å†…å®¹
`,
  };

  return patternMap[topPattern] || patternMap.statementHook;
}
```

#### åº”ç”¨åœºæ™¯2ï¼šå†…å®¹ç”Ÿæˆé˜¶æ®µ

```typescript
async function generateContentWithOpeningStyle(
  task: any,
  outline: string
): Promise<string> {
  const profile = await db.userStyleProfile.findUnique({
    where: {
      username_contentType: {
        username: task.username,
        contentType: task.contentType
      }
    }
  });

  const patterns = profile?.openingPatterns
    ? JSON.parse(profile.openingPatterns) as OpeningPatterns
    : null;

  const openingGuide = patterns
    ? `
ã€å¼€å¤´å†™ä½œæŒ‡å—ã€‘
ç”¨æˆ·æœ€å¸¸ç”¨çš„å¼€å¤´æ–¹å¼ï¼š${getTopPattern(patterns)}

å…·ä½“è¦æ±‚ï¼š
${buildOpeningInstruction(getTopPattern(patterns), patterns)}

è¯·åœ¨æ­£æ–‡å¼€å¤´ä¸¥æ ¼éµå¾ªæ­¤é£æ ¼ï¼
`
    : '';

  const prompt = `
åŸºäºä»¥ä¸‹å¤§çº²æ’°å†™å®Œæ•´æ–‡ç« ï¼š

${outline}

${openingGuide}

å†™ä½œè¦æ±‚ï¼š
1. å¼€å¤´å¿…é¡»ç¬¦åˆç”¨æˆ·çš„ä¹ æƒ¯é£æ ¼
2. å¼€å¤´è¦å¸å¼•äººï¼Œå¼•å‘å…´è¶£
3. æ•´ä½“å†…å®¹è¿è´¯å®Œæ•´
`;

  const aiService = AIServiceFactory.createService({...});
  return await aiService.generateText(prompt);
}
```

### 1.5 å‰ç«¯å±•ç¤º

åœ¨é£æ ¼æ¡£æ¡ˆé¡µé¢æ·»åŠ å¼€å¤´æ¨¡å¼å¯è§†åŒ–ï¼š

```tsx
// å¼€å¤´æ¨¡å¼åˆ†å¸ƒå›¾
{profile.openingPatterns && (
  <div className="mt-4">
    <h4 className="text-sm font-semibold mb-2">å¼€å¤´æ¨¡å¼åˆ†å¸ƒ</h4>
    {Object.entries(JSON.parse(profile.openingPatterns))
      .filter(([key]) => key !== 'examples')
      .map(([pattern, ratio]) => (
        <div key={pattern} className="mb-2">
          <div className="flex justify-between text-xs mb-1">
            <span>{patternNameMap[pattern]}</span>
            <span>{((ratio as number) * 100).toFixed(0)}%</span>
          </div>
          <div className="w-full bg-gray-200 rounded-full h-2">
            <div
              className="bg-indigo-600 h-2 rounded-full"
              style={{ width: `${(ratio as number) * 100}%` }}
            />
          </div>
        </div>
      ))}
  </div>
)}
```

---

## ğŸ£ åŠŸèƒ½2ï¼šå¸å¼•åŠ›æœºåˆ¶åˆ†æ

### 2.1 åˆ†æç›®æ ‡

é‡åŒ–è¯„ä¼°å†…å®¹çš„å¸å¼•åŠ›å› ç´ ï¼š
- **æ–°é¢–æ€§**ï¼šåŒ…å«æ–°æ¦‚å¿µã€æ–°æ•°æ®ã€æ–°å‘ç°
- **äº‰è®®æ€§**ï¼šå­˜åœ¨å¯¹ç«‹è§‚ç‚¹ã€æ‰¹è¯„ã€è´¨ç–‘
- **å®ç”¨æ€§**ï¼šæä¾›æ–¹æ³•ã€æŠ€å·§ã€å·¥å…·
- **æƒ…æ„Ÿå…±é¸£**ï¼šå¼•å‘æƒ…æ„Ÿååº”
- **è®¤çŸ¥è´Ÿæ‹…**ï¼šç†è§£éš¾åº¦ï¼ˆè¶Šä½è¶Šå¥½ï¼‰

### 2.2 æ•°æ®åº“è®¾è®¡

#### åˆ›å»ºæ–°è¡¨ï¼štweet_attraction_analysis
```sql
CREATE TABLE tweet_attraction_analysis (
  id TEXT PRIMARY KEY,
  tweet_id TEXT NOT NULL,
  username TEXT NOT NULL,

  -- å¸å¼•åŠ›è¯„åˆ† (0-1)
  novelty_score REAL DEFAULT 0,         -- æ–°é¢–æ€§
  controversy_score REAL DEFAULT 0,     -- äº‰è®®æ€§
  practicality_score REAL DEFAULT 0,    -- å®ç”¨æ€§
  emotional_resonance REAL DEFAULT 0,   -- æƒ…æ„Ÿå…±é¸£
  cognitive_load REAL DEFAULT 0,        -- è®¤çŸ¥è´Ÿæ‹…

  -- ç»¼åˆå¸å¼•åŠ›åˆ†æ•°
  overall_attraction_score REAL DEFAULT 0,

  -- äº’åŠ¨æ•°æ®ï¼ˆç”¨äºéªŒè¯å¸å¼•åŠ›ï¼‰
  like_count INTEGER DEFAULT 0,
  retweet_count INTEGER DEFAULT 0,
  reply_count INTEGER DEFAULT 0,

  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (tweet_id) REFERENCES writing_analysis_tweet(id) ON DELETE CASCADE
);

CREATE INDEX idx_tweet_attraction_username ON tweet_attraction_analysis(username);
CREATE INDEX idx_tweet_attraction_score ON tweet_attraction_analysis(overall_attraction_score DESC);

-- åœ¨ user_style_profile è¡¨ä¸­æ·»åŠ å¹³å‡å¸å¼•åŠ›ç‰¹å¾
ALTER TABLE user_style_profile ADD COLUMN
  attraction_profile TEXT;  -- JSON: ç”¨æˆ·çš„å¹³å‡å¸å¼•åŠ›ç‰¹å¾

-- ç¤ºä¾‹æ•°æ®
{
  "avgNoveltyScore": 0.65,
  "avgControversyScore": 0.30,
  "avgPracticalityScore": 0.75,
  "avgEmotionalResonance": 0.55,
  "avgCognitiveLoad": 0.35,
  "highPerformingFactors": ["practicality", "novelty"],  // æœ€æœ‰æ•ˆçš„å¸å¼•åŠ›å› ç´ 
  "correlationWithEngagement": 0.72  // ä¸äº’åŠ¨æ•°æ®çš„ç›¸å…³æ€§
}
```

### 2.3 åˆ†æç®—æ³•å®ç°

```typescript
interface AttractionScores {
  noveltyScore: number;
  controversyScore: number;
  practicalityScore: number;
  emotionalResonance: number;
  cognitiveLoad: number;
  overallScore: number;
}

export class AdvancedStyleAnalysisService {

  /**
   * åˆ†æå•æ¡æ¨æ–‡çš„å¸å¼•åŠ›
   */
  analyzeAttraction(tweet: {content: string}, engagement?: {
    likeCount: number;
    retweetCount: number;
    replyCount: number;
  }): AttractionScores {
    const content = tweet.content;
    const scores: AttractionScores = {
      noveltyScore: 0,
      controversyScore: 0,
      practicalityScore: 0,
      emotionalResonance: 0,
      cognitiveLoad: 0,
      overallScore: 0,
    };

    // 1. æ–°é¢–æ€§åˆ†æ
    scores.noveltyScore = this.calculateNoveltyScore(content);

    // 2. äº‰è®®æ€§åˆ†æ
    scores.controversyScore = this.calculateControversyScore(content);

    // 3. å®ç”¨æ€§åˆ†æ
    scores.practicalityScore = this.calculatePracticalityScore(content);

    // 4. æƒ…æ„Ÿå…±é¸£åˆ†æ
    scores.emotionalResonance = this.calculateEmotionalResonance(content);

    // 5. è®¤çŸ¥è´Ÿæ‹…åˆ†æ
    scores.cognitiveLoad = this.calculateCognitiveLoad(content);

    // 6. è®¡ç®—ç»¼åˆå¸å¼•åŠ›
    scores.overallScore = this.calculateOverallAttraction(scores);

    return scores;
  }

  /**
   * è®¡ç®—æ–°é¢–æ€§åˆ†æ•°
   */
  private calculateNoveltyScore(content: string): number {
    let score = 0;

    // æ–°æ¦‚å¿µå…³é”®è¯
    const noveltyKeywords = [
      'é¦–æ¬¡', 'æœ€æ–°', 'çªç ´', 'å‘ç°', 'æ–°çš„', 'åˆ›æ–°',
      'é©å‘½æ€§', 'é¢ è¦†', 'å‰æ²¿', 'å¼€åˆ›', 'é¦–ä¸ª'
    ];
    noveltyKeywords.forEach(keyword => {
      if (content.includes(keyword)) score += 0.1;
    });

    // åŒ…å«å…·ä½“æ•°æ®
    if (/\d+%/.test(content)) score += 0.15;
    if (/\d+å€/.test(content)) score += 0.15;

    // åŒ…å«æ—¶é—´æ ‡è®°ï¼ˆè¡¨ç¤ºæ–°è¿‘å‘ç”Ÿï¼‰
    if (/(ä»Šå¤©|æ˜¨å¤©|åˆšåˆš|æœ€è¿‘|æœ¬å‘¨)/.test(content)) score += 0.1;

    // åŒ…å«"ç ”ç©¶"ã€"æŠ¥å‘Š"ç­‰æƒå¨æ¥æº
    if (/(ç ”ç©¶|æŠ¥å‘Š|è®ºæ–‡|è°ƒæŸ¥).*?(æ˜¾ç¤º|è¡¨æ˜|å‘ç°|æŒ‡å‡º)/.test(content)) {
      score += 0.15;
    }

    return Math.min(score, 1.0);
  }

  /**
   * è®¡ç®—äº‰è®®æ€§åˆ†æ•°
   */
  private calculateControversyScore(content: string): number {
    let score = 0;

    // å¯¹ç«‹è§‚ç‚¹å…³é”®è¯
    const controversyKeywords = [
      'ä½†æ˜¯', 'ç„¶è€Œ', 'ä¸è¿‡', 'åå¯¹', 'è´¨ç–‘', 'äº‰è®®',
      'é—®é¢˜', 'æ‰¹è¯„', 'ä¸åº”è¯¥', 'é”™è¯¯', 'è¯¯åŒº', 'çœŸç›¸'
    ];
    controversyKeywords.forEach(keyword => {
      if (content.includes(keyword)) score += 0.1;
    });

    // åŒ…å«å¯¹æ¯”ç»“æ„
    if (/(å¾ˆå¤šäºº|å¤§å®¶éƒ½|ä¼ ç»Ÿ|ä»¥å‰).{0,10}(è®¤ä¸º|è§‰å¾—|ä»¥ä¸º)/.test(content)) {
      score += 0.15;
    }
    if (/(ä½†|ç„¶è€Œ|å®é™…ä¸Š|å…¶å®|äº‹å®ä¸Š)/.test(content)) {
      score += 0.1;
    }

    // åŒ…å«å¦å®šè¯
    const negativeWords = ['ä¸', 'æ²¡', 'åˆ«', 'é', 'å', 'é”™'];
    negativeWords.forEach(word => {
      const count = (content.match(new RegExp(word, 'g')) || []).length;
      score += Math.min(count * 0.05, 0.2);
    });

    return Math.min(score, 1.0);
  }

  /**
   * è®¡ç®—å®ç”¨æ€§åˆ†æ•°
   */
  private calculatePracticalityScore(content: string): number {
    let score = 0;

    // å®ç”¨æ€§å…³é”®è¯
    const practicalKeywords = [
      'å¦‚ä½•', 'æ–¹æ³•', 'æŠ€å·§', 'å·¥å…·', 'æ­¥éª¤', 'æ”»ç•¥',
      'æ•™ç¨‹', 'æŒ‡å—', 'ç§˜ç±', 'å®æˆ˜', 'ç»éªŒ', 'å»ºè®®'
    ];
    practicalKeywords.forEach(keyword => {
      if (content.includes(keyword)) score += 0.15;
    });

    // åŒ…å«åˆ—è¡¨ç»“æ„
    if (/[1-9]\)|[ä¸€äºŒä¸‰å››äº”]ã€|ç¬¬[ä¸€äºŒä¸‰å››äº”]/.test(content)) {
      score += 0.2;
    }

    // åŒ…å«æ“ä½œæ€§è¯æ±‡
    const actionWords = ['å¯ä»¥', 'åº”è¯¥', 'éœ€è¦', 'å»ºè®®', 'æ¨è', 'è¯•è¯•'];
    actionWords.forEach(word => {
      if (content.includes(word)) score += 0.08;
    });

    return Math.min(score, 1.0);
  }

  /**
   * è®¡ç®—æƒ…æ„Ÿå…±é¸£åˆ†æ•°
   */
  private calculateEmotionalResonance(content: string): number {
    let score = 0;

    // ç¬¬ä¸€äººç§°ï¼ˆå¢å¼ºä¸ªäººè¿æ¥ï¼‰
    if (/(æˆ‘|å’±|ä¿º|è€å­|æœ¬äºº)/.test(content)) {
      const count = (content.match(/(æˆ‘|å’±)/g) || []).length;
      score += Math.min(count * 0.08, 0.25);
    }

    // ç¬¬äºŒäººç§°ï¼ˆç›´æ¥å¯¹è¯ï¼‰
    if (/(ä½ |æ‚¨|å¤§å®¶|å„ä½)/.test(content)) {
      score += 0.15;
    }

    // æƒ…æ„Ÿè¯æ±‡
    const emotionWords = [
      'å¼€å¿ƒ', 'é«˜å…´', 'éš¾è¿‡', 'æ„ŸåŠ¨', 'æ¿€åŠ¨', 'å…´å¥‹',
      'æ‹…å¿ƒ', 'ç„¦è™‘', 'å®³æ€•', 'æƒŠè®¶', 'éœ‡æƒŠ', 'æ„å¤–',
      'å–œæ¬¢', 'è®¨åŒ', 'çˆ±', 'æ¨', 'å¸Œæœ›', 'å¤±æœ›'
    ];
    emotionWords.forEach(word => {
      if (content.includes(word)) score += 0.08;
    });

    // æ„Ÿå¹å·ï¼ˆæƒ…æ„Ÿå¼ºåº¦ï¼‰
    const exclamationCount = (content.match(/ï¼|!/g) || []).length;
    score += Math.min(exclamationCount * 0.1, 0.2);

    return Math.min(score, 1.0);
  }

  /**
   * è®¡ç®—è®¤çŸ¥è´Ÿæ‹…
   */
  private calculateCognitiveLoad(content: string): number {
    // å¥å­æ•°é‡
    const sentences = content.split(/[ã€‚ï¼ï¼Ÿ\n]/).filter(s => s.trim().length > 0);
    const avgSentenceLength = content.length / sentences.length;

    // å¥å­è¶Šé•¿ï¼Œè®¤çŸ¥è´Ÿæ‹…è¶Šé«˜
    let load = Math.min(avgSentenceLength / 50, 1.0);

    // ä¸“ä¸šæœ¯è¯­å¯†åº¦ï¼ˆè‹±æ–‡å•è¯æ¯”ä¾‹ï¼‰
    const englishWords = content.match(/[a-zA-Z]+/g) || [];
    const technicalDensity = englishWords.length / (content.length / 10);
    load += Math.min(technicalDensity * 0.5, 0.3);

    // æ•°å­—å¯†åº¦
    const numbers = content.match(/\d+/g) || [];
    if (numbers.length > 5) load += 0.2;

    return Math.min(load, 1.0);
  }

  /**
   * è®¡ç®—ç»¼åˆå¸å¼•åŠ›åˆ†æ•°
   */
  private calculateOverallAttraction(scores: AttractionScores): number {
    // åŠ æƒå¹³å‡ï¼ˆè®¤çŸ¥è´Ÿæ‹…æ˜¯è´Ÿå‘æŒ‡æ ‡ï¼‰
    const overall = (
      scores.noveltyScore * 0.25 +
      scores.controversyScore * 0.15 +
      scores.practicalityScore * 0.30 +
      scores.emotionalResonance * 0.20 +
      (1 - scores.cognitiveLoad) * 0.10
    );

    return Math.min(Math.max(overall, 0), 1.0);
  }

  /**
   * æ‰¹é‡åˆ†æç”¨æˆ·æ¨æ–‡çš„å¸å¼•åŠ›
   */
  async analyzeUserAttraction(username: string): Promise<void> {
    // è·å–ç”¨æˆ·æ¨æ–‡
    const tweets = await db.writingAnalysisTweet.findMany({
      where: { userUsername: username },
      select: {
        id: true,
        content: true,
        likeCount: true,
        retweetCount: true,
        replyCount: true,
      }
    });

    // åˆ†ææ¯æ¡æ¨æ–‡
    const analyses = tweets.map(tweet => {
      const scores = this.analyzeAttraction(tweet, {
        likeCount: tweet.likeCount,
        retweetCount: tweet.retweetCount,
        replyCount: tweet.replyCount,
      });

      return {
        tweetId: tweet.id,
        ...scores,
        likeCount: tweet.likeCount,
        retweetCount: tweet.retweetCount,
        replyCount: tweet.replyCount,
      };
    });

    // ä¿å­˜åˆ°æ•°æ®åº“
    for (const analysis of analyses) {
      await db.tweetAttractionAnalysis.create({
        data: {
          tweetId: analysis.tweetId,
          username,
          noveltyScore: analysis.noveltyScore,
          controversyScore: analysis.controversyScore,
          practicalityScore: analysis.practicalityScore,
          emotionalResonance: analysis.emotionalResonance,
          cognitiveLoad: analysis.cognitiveLoad,
          overallAttractionScore: analysis.overallScore,
          likeCount: analysis.likeCount,
          retweetCount: analysis.retweetCount,
          replyCount: analysis.replyCount,
        }
      });
    }

    // è®¡ç®—ç”¨æˆ·çš„å¹³å‡å¸å¼•åŠ›ç‰¹å¾
    await this.calculateUserAttractionProfile(username, analyses);
  }

  /**
   * è®¡ç®—ç”¨æˆ·çš„å¸å¼•åŠ›æ¡£æ¡ˆ
   */
  private async calculateUserAttractionProfile(
    username: string,
    analyses: any[]
  ): Promise<void> {
    const avgScores = {
      avgNoveltyScore: this.average(analyses.map(a => a.noveltyScore)),
      avgControversyScore: this.average(analyses.map(a => a.controversyScore)),
      avgPracticalityScore: this.average(analyses.map(a => a.practicalityScore)),
      avgEmotionalResonance: this.average(analyses.map(a => a.emotionalResonance)),
      avgCognitiveLoad: this.average(analyses.map(a => a.cognitiveLoad)),
    };

    // æ‰¾å‡ºæœ€æœ‰æ•ˆçš„å¸å¼•åŠ›å› ç´ ï¼ˆä¸äº’åŠ¨æ•°æ®ç›¸å…³æ€§æœ€é«˜ï¼‰
    const factors = ['novelty', 'controversy', 'practicality', 'emotional'];
    const correlations = factors.map(factor => ({
      factor,
      correlation: this.calculateCorrelation(
        analyses.map(a => a[`${factor}Score`]),
        analyses.map(a => a.likeCount + a.retweetCount * 2)
      )
    }));
    correlations.sort((a, b) => b.correlation - a.correlation);

    const attractionProfile = {
      ...avgScores,
      highPerformingFactors: correlations.slice(0, 2).map(c => c.factor),
      correlationWithEngagement: correlations[0].correlation,
    };

    // æ›´æ–°åˆ°é£æ ¼æ¡£æ¡ˆï¼ˆå‡è®¾å·²æœ‰åŸºç¡€é£æ ¼æ¡£æ¡ˆï¼‰
    // è¿™é‡Œéœ€è¦éå†æ‰€æœ‰å†…å®¹ç±»å‹çš„æ¡£æ¡ˆ
    const profiles = await db.userStyleProfile.findMany({
      where: { username }
    });

    for (const profile of profiles) {
      await db.userStyleProfile.update({
        where: { id: profile.id },
        data: {
          attractionProfile: JSON.stringify(attractionProfile)
        }
      });
    }
  }

  private average(numbers: number[]): number {
    return numbers.reduce((a, b) => a + b, 0) / numbers.length;
  }

  private calculateCorrelation(x: number[], y: number[]): number {
    const n = x.length;
    const sumX = x.reduce((a, b) => a + b, 0);
    const sumY = y.reduce((a, b) => a + b, 0);
    const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
    const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
    const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);

    const numerator = n * sumXY - sumX * sumY;
    const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));

    return denominator === 0 ? 0 : numerator / denominator;
  }
}
```

### 2.4 åœ¨å†…å®¹ç”Ÿæˆä¸­çš„åº”ç”¨

```typescript
async function generateWithAttractionOptimization(
  task: any,
  outline: string
): Promise<string> {
  // 1. è·å–ç”¨æˆ·çš„å¸å¼•åŠ›æ¡£æ¡ˆ
  const profile = await db.userStyleProfile.findUnique({
    where: {
      username_contentType: {
        username: task.username,
        contentType: task.contentType
      }
    }
  });

  const attractionProfile = profile?.attractionProfile
    ? JSON.parse(profile.attractionProfile)
    : null;

  if (!attractionProfile) {
    return generateContent(task, outline); // å›é€€
  }

  // 2. æ„å»ºå¸å¼•åŠ›ä¼˜åŒ–æŒ‡ä»¤
  const attractionGuide = `
ã€å†…å®¹å¸å¼•åŠ›ä¼˜åŒ–æŒ‡å—ã€‘

åŸºäºç”¨æˆ·${task.username}çš„æˆåŠŸç»éªŒï¼Œä»¥ä¸‹å› ç´ æœ€èƒ½æå‡å†…å®¹å¸å¼•åŠ›ï¼š

ä¸»è¦å¸å¼•åŠ›æ¥æºï¼š
${attractionProfile.highPerformingFactors.map((factor: string) => {
  const factorMap: Record<string, string> = {
    novelty: 'âœ“ æ–°é¢–æ€§ï¼ˆç”¨æˆ·å¹³å‡åˆ†: ' + (attractionProfile.avgNoveltyScore * 100).toFixed(0) + '%ï¼‰\n  - å¼•å…¥æ–°æ¦‚å¿µã€æ–°æ•°æ®ã€æ–°å‘ç°\n  - ä½¿ç”¨"é¦–æ¬¡"ã€"æœ€æ–°"ã€"çªç ´"ç­‰è¯æ±‡',
    controversy: 'âœ“ äº‰è®®æ€§ï¼ˆç”¨æˆ·å¹³å‡åˆ†: ' + (attractionProfile.avgControversyScore * 100).toFixed(0) + '%ï¼‰\n  - æå‡ºä¸åŒè§‚ç‚¹æˆ–è´¨ç–‘å¸¸è§è®¤çŸ¥\n  - ä½¿ç”¨"ä½†æ˜¯"ã€"ç„¶è€Œ"ã€"çœŸç›¸æ˜¯"ç­‰è¯æ±‡',
    practicality: 'âœ“ å®ç”¨æ€§ï¼ˆç”¨æˆ·å¹³å‡åˆ†: ' + (attractionProfile.avgPracticalityScore * 100).toFixed(0) + '%ï¼‰\n  - æä¾›å…·ä½“æ–¹æ³•ã€æ­¥éª¤ã€å·¥å…·\n  - ä½¿ç”¨"å¦‚ä½•"ã€"æŠ€å·§"ã€"æ”»ç•¥"ç­‰è¯æ±‡',
    emotional: 'âœ“ æƒ…æ„Ÿå…±é¸£ï¼ˆç”¨æˆ·å¹³å‡åˆ†: ' + (attractionProfile.avgEmotionalResonance * 100).toFixed(0) + '%ï¼‰\n  - ä½¿ç”¨ç¬¬ä¸€äººç§°"æˆ‘"åˆ†äº«æ„Ÿå—\n  - ä½¿ç”¨æƒ…æ„Ÿè¯æ±‡å’Œæ„Ÿå¹å¥',
  };
  return factorMap[factor] || '';
}).join('\n\n')}

è®¤çŸ¥è´Ÿæ‹…æ§åˆ¶ï¼š
- ç”¨æˆ·å¹³å‡è®¤çŸ¥è´Ÿæ‹…ï¼š${(attractionProfile.avgCognitiveLoad * 100).toFixed(0)}%
- å»ºè®®ï¼šä¿æŒå¥å­ç®€æ´${attractionProfile.avgCognitiveLoad < 0.4 ? 'ï¼ˆçŸ­å¥ä¸ºä¸»ï¼‰' : 'ï¼ˆå¯ä»¥ä½¿ç”¨é•¿å¥ï¼‰'}

ç›®æ ‡ï¼šç”Ÿæˆçš„å†…å®¹åº”è¯¥åœ¨ä¸Šè¿°é«˜æ•ˆå› ç´ ä¸Šå¾—åˆ†è¾ƒé«˜ï¼
`;

  const prompt = `
åŸºäºä»¥ä¸‹å¤§çº²æ’°å†™å®Œæ•´æ–‡ç« ï¼š

${outline}

${attractionGuide}

å†™ä½œè¦æ±‚ï¼š
1. é‡ç‚¹å¼ºåŒ–ç”¨æˆ·çš„é«˜æ•ˆå¸å¼•åŠ›å› ç´ 
2. å†…å®¹è¦æœ‰å¸å¼•åŠ›ï¼Œè®©äººæƒ³è¯»ä¸‹å»
3. ä¿æŒé€»è¾‘è¿è´¯å’Œå†…å®¹è´¨é‡
`;

  const aiService = AIServiceFactory.createService({...});
  return await aiService.generateText(prompt);
}
```

#### ç”ŸæˆåéªŒè¯

```typescript
/**
 * ç”Ÿæˆå†…å®¹åï¼Œè¯„ä¼°å¸å¼•åŠ›å¹¶ç»™å‡ºæ”¹è¿›å»ºè®®
 */
async function evaluateGeneratedContent(content: string): Promise<{
  scores: AttractionScores;
  suggestions: string[];
}> {
  const service = new AdvancedStyleAnalysisService();
  const scores = service.analyzeAttraction({ content });

  const suggestions: string[] = [];

  // æ ¹æ®è¯„åˆ†ç»™å‡ºå»ºè®®
  if (scores.noveltyScore < 0.4) {
    suggestions.push('ğŸ’¡ æ–°é¢–æ€§ä¸è¶³ï¼šå»ºè®®æ·»åŠ æœ€æ–°æ•°æ®ã€ç ”ç©¶å‘ç°æˆ–æ–°æ¦‚å¿µ');
  }
  if (scores.practicalityScore < 0.5) {
    suggestions.push('ğŸ”§ å®ç”¨æ€§ä¸è¶³ï¼šå»ºè®®æ·»åŠ å…·ä½“æ–¹æ³•ã€æ­¥éª¤æˆ–å·¥å…·æ¨è');
  }
  if (scores.emotionalResonance < 0.3) {
    suggestions.push('â¤ï¸ æƒ…æ„Ÿå…±é¸£ä¸è¶³ï¼šå»ºè®®ä½¿ç”¨ç¬¬ä¸€äººç§°åˆ†äº«æ„Ÿå—ï¼Œå¢å¼ºæƒ…æ„Ÿè¡¨è¾¾');
  }
  if (scores.cognitiveLoad > 0.7) {
    suggestions.push('ğŸ“– è®¤çŸ¥è´Ÿæ‹…è¿‡é«˜ï¼šå»ºè®®ç®€åŒ–å¥å­ï¼Œå‡å°‘ä¸“ä¸šæœ¯è¯­');
  }

  if (scores.overallScore >= 0.7) {
    suggestions.push('âœ… æ•´ä½“å¸å¼•åŠ›ä¼˜ç§€ï¼');
  } else if (scores.overallScore >= 0.5) {
    suggestions.push('âœ“ æ•´ä½“å¸å¼•åŠ›è‰¯å¥½ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–');
  } else {
    suggestions.push('âš ï¸ æ•´ä½“å¸å¼•åŠ›è¾ƒä½ï¼Œå»ºè®®é‡ç‚¹æ”¹è¿›');
  }

  return { scores, suggestions };
}
```

---

## ğŸ­ åŠŸèƒ½3ï¼šæƒ…ç»ªé’©å­è¯†åˆ«

### 3.1 åˆ†æç›®æ ‡

è¯†åˆ«ç”¨æˆ·å¦‚ä½•è®¾ç½®æƒ…ç»ªè§¦å‘ç‚¹ï¼š
- **å¼€å¤´é’©å­**ï¼šå¥½å¥‡å¿ƒç¼ºå£ã€ä¸ªäººæ•…äº‹ã€æ•°æ®å†²å‡»
- **ä¸­é—´ç»´æŒé’©å­**ï¼šæ¸è¿›æ­ç¤ºã€æ„å¤–è½¬æŠ˜
- **ç»“å°¾é’©å­**ï¼šè¡ŒåŠ¨å·å¬ã€å¼•å‘æ€è€ƒ

### 3.2 æ•°æ®åº“è®¾è®¡

```sql
ALTER TABLE user_style_profile ADD COLUMN
  emotional_hooks TEXT;  -- JSON: æƒ…ç»ªé’©å­æ¨¡å¼

-- ç¤ºä¾‹æ•°æ®
{
  "openingHooks": {
    "curiosityGap": {
      "usage": 0.35,  // ä½¿ç”¨ç‡35%
      "effectiveness": 0.82,  // æœ‰æ•ˆæ€§82%
      "examples": ["ä½ çŸ¥é“...ä½†å®é™…ä¸Š...", "å¾ˆå¤šäººä¸çŸ¥é“..."]
    },
    "personalStory": {
      "usage": 0.25,
      "effectiveness": 0.75,
      "examples": ["æ˜¨å¤©é‡åˆ°ä¸€ä»¶äº‹...", "æœ€è¿‘å‘ç°..."]
    },
    "dataShock": {
      "usage": 0.20,
      "effectiveness": 0.78,
      "examples": ["æ•°æ®æ˜¾ç¤ºç«Ÿç„¶æœ‰70%...", "ç ”ç©¶å‘ç°..."]
    }
  },
  "sustainingHooks": {
    "progressiveRevelation": 0.40,  // "æ›´é‡è¦çš„æ˜¯..."
    "unexpectedTurn": 0.30,         // "ä½†æ˜¯..."
    "readerInvolvement": 0.20       // "ä½ æ˜¯å¦ä¹Ÿ..."
  },
  "closingHooks": {
    "callToAction": 0.50,           // "ä½ æ€ä¹ˆçœ‹ï¼Ÿ"
    "thoughtProvoking": 0.30,       // "è¿™è®©æˆ‘ä»¬æ€è€ƒ..."
    "cliffhanger": 0.20             // "ä¸‹æ¬¡åˆ†äº«..."
  }
}
```

### 3.3 åˆ†æç®—æ³•

```typescript
interface EmotionalHooks {
  openingHooks: {
    curiosityGap: { usage: number; effectiveness: number; examples: string[] };
    personalStory: { usage: number; effectiveness: number; examples: string[] };
    dataShock: { usage: number; effectiveness: number; examples: string[] };
  };
  sustainingHooks: {
    progressiveRevelation: number;
    unexpectedTurn: number;
    readerInvolvement: number;
  };
  closingHooks: {
    callToAction: number;
    thoughtProvoking: number;
    cliffhanger: number;
  };
}

export class AdvancedStyleAnalysisService {

  /**
   * è¯†åˆ«æƒ…ç»ªé’©å­
   */
  analyzeEmotionalHooks(tweets: Array<{
    content: string;
    likeCount: number;
    retweetCount: number;
  }>): EmotionalHooks {

    const hooks: EmotionalHooks = {
      openingHooks: {
        curiosityGap: { usage: 0, effectiveness: 0, examples: [] },
        personalStory: { usage: 0, effectiveness: 0, examples: [] },
        dataShock: { usage: 0, effectiveness: 0, examples: [] },
      },
      sustainingHooks: {
        progressiveRevelation: 0,
        unexpectedTurn: 0,
        readerInvolvement: 0,
      },
      closingHooks: {
        callToAction: 0,
        thoughtProvoking: 0,
        cliffhanger: 0,
      }
    };

    const openingExamples = {
      curiosityGap: [] as Array<{text: string, engagement: number}>,
      personalStory: [] as Array<{text: string, engagement: number}>,
      dataShock: [] as Array<{text: string, engagement: number}>,
    };

    tweets.forEach(tweet => {
      const content = tweet.content;
      const opening = content.substring(0, 50);
      const ending = content.substring(Math.max(0, content.length - 50));
      const engagement = tweet.likeCount + tweet.retweetCount * 2;

      // 1. å¼€å¤´é’©å­è¯†åˆ«

      // å¥½å¥‡å¿ƒç¼ºå£
      if (/(ä½ çŸ¥é“|æœ‰æ²¡æœ‰æƒ³è¿‡|å¾ˆå¤šäººä¸çŸ¥é“).*?(ä½†|å…¶å®|å®é™…ä¸Š)/.test(opening)) {
        hooks.openingHooks.curiosityGap.usage++;
        openingExamples.curiosityGap.push({
          text: opening.substring(0, 30),
          engagement
        });
      }

      // ä¸ªäººæ•…äº‹
      if (/(æ˜¨å¤©|ä»Šå¤©|æœ€è¿‘|ä¸Šå‘¨).{0,5}(é‡åˆ°|å‘ç”Ÿ|çœ‹åˆ°|å¬åˆ°|å‘ç°)/.test(opening)) {
        hooks.openingHooks.personalStory.usage++;
        openingExamples.personalStory.push({
          text: opening.substring(0, 30),
          engagement
        });
      }

      // æ•°æ®å†²å‡»
      if (/(æ•°æ®æ˜¾ç¤º|ç ”ç©¶è¡¨æ˜|ç»Ÿè®¡å‘ç°).*?(\d+%|ç«Ÿç„¶|å±…ç„¶)/.test(opening)) {
        hooks.openingHooks.dataShock.usage++;
        openingExamples.dataShock.push({
          text: opening.substring(0, 30),
          engagement
        });
      }

      // 2. ä¸­é—´ç»´æŒé’©å­

      // æ¸è¿›æ­ç¤º
      if (/(æ›´é‡è¦çš„æ˜¯|è¿˜æœ‰|å¦å¤–|æ­¤å¤–|è€Œä¸”)/.test(content)) {
        hooks.sustainingHooks.progressiveRevelation++;
      }

      // æ„å¤–è½¬æŠ˜
      if (/(ä½†æ˜¯|ç„¶è€Œ|ä¸è¿‡|å¯æ˜¯|å´)/.test(content)) {
        hooks.sustainingHooks.unexpectedTurn++;
      }

      // è¯»è€…å·å…¥
      if (/(ä½ æ˜¯å¦|ä½ æœ‰æ²¡æœ‰|ä½ ä¼šä¸ä¼š|æƒ³è±¡ä¸€ä¸‹)/.test(content)) {
        hooks.sustainingHooks.readerInvolvement++;
      }

      // 3. ç»“å°¾é’©å­

      // è¡ŒåŠ¨å·å¬
      if (/(ä½ æ€ä¹ˆçœ‹|æ¬¢è¿è®¨è®º|æ¬¢è¿ç•™è¨€|è¯´è¯´ä½ çš„çœ‹æ³•)/.test(ending)) {
        hooks.closingHooks.callToAction++;
      }

      // å¼•å‘æ€è€ƒ
      if (/(è¿™è®©æˆ‘ä»¬|å€¼å¾—æˆ‘ä»¬|åº”è¯¥è®©æˆ‘ä»¬).{0,5}(æ€è€ƒ|åæ€|è­¦é†’)/.test(ending)) {
        hooks.closingHooks.thoughtProvoking++;
      }

      // æ‚¬å¿µ
      if (/(ä¸‹æ¬¡|ä¸‹æœŸ|æœªå®Œå¾…ç»­|æ•¬è¯·æœŸå¾…|å¾…ç»­)/.test(ending)) {
        hooks.closingHooks.cliffhanger++;
      }
    });

    // è½¬æ¢ä¸ºæ¯”ä¾‹å¹¶è®¡ç®—æœ‰æ•ˆæ€§
    const total = tweets.length;

    // å¼€å¤´é’©å­
    ['curiosityGap', 'personalStory', 'dataShock'].forEach(hookType => {
      const hook = hooks.openingHooks[hookType as keyof typeof hooks.openingHooks];
      hook.usage = hook.usage / total;

      // è®¡ç®—æœ‰æ•ˆæ€§ï¼ˆä½¿ç”¨æ­¤é’©å­çš„æ¨æ–‡çš„å¹³å‡äº’åŠ¨æ•° / æ‰€æœ‰æ¨æ–‡çš„å¹³å‡äº’åŠ¨æ•°ï¼‰
      const examples = openingExamples[hookType as keyof typeof openingExamples];
      if (examples.length > 0) {
        const avgEngagement = examples.reduce((sum, e) => sum + e.engagement, 0) / examples.length;
        const totalAvgEngagement = tweets.reduce((sum, t) => sum + (t.likeCount + t.retweetCount * 2), 0) / total;
        hook.effectiveness = totalAvgEngagement > 0 ? Math.min(avgEngagement / totalAvgEngagement, 1.0) : 0;

        // ä¿å­˜æ•ˆæœæœ€å¥½çš„ä¾‹å­
        examples.sort((a, b) => b.engagement - a.engagement);
        hook.examples = examples.slice(0, 3).map(e => e.text);
      }
    });

    // ä¸­é—´é’©å­å’Œç»“å°¾é’©å­ï¼ˆè½¬æ¢ä¸ºæ¯”ä¾‹ï¼‰
    Object.keys(hooks.sustainingHooks).forEach(key => {
      hooks.sustainingHooks[key as keyof typeof hooks.sustainingHooks] /= total;
    });
    Object.keys(hooks.closingHooks).forEach(key => {
      hooks.closingHooks[key as keyof typeof hooks.closingHooks] /= total;
    });

    return hooks;
  }
}
```

### 3.4 åœ¨å†…å®¹ç”Ÿæˆä¸­çš„åº”ç”¨

```typescript
async function generateWithEmotionalHooks(
  task: any,
  outline: string
): Promise<string> {
  const profile = await db.userStyleProfile.findUnique({
    where: {
      username_contentType: {
        username: task.username,
        contentType: task.contentType
      }
    }
  });

  const emotionalHooks = profile?.emotionalHooks
    ? JSON.parse(profile.emotionalHooks) as EmotionalHooks
    : null;

  if (!emotionalHooks) {
    return generateContent(task, outline);
  }

  // é€‰æ‹©æœ€æœ‰æ•ˆçš„å¼€å¤´é’©å­
  const topOpeningHook = Object.entries(emotionalHooks.openingHooks)
    .sort(([,a], [,b]) => b.effectiveness - a.effectiveness)[0];

  const hookGuide = `
ã€æƒ…ç»ªé’©å­è®¾è®¡æŒ‡å—ã€‘

ç”¨æˆ·${task.username}æœ€æœ‰æ•ˆçš„å¼€å¤´é’©å­ï¼š${topOpeningHook[0]}
ï¼ˆæœ‰æ•ˆæ€§ï¼š${(topOpeningHook[1].effectiveness * 100).toFixed(0)}%ï¼‰

ç¤ºä¾‹ï¼š
${topOpeningHook[1].examples.map((ex: string, i: number) => `${i+1}. ${ex}...`).join('\n')}

ä¸­é—´ç»´æŒæŠ€å·§ï¼ˆç”¨æˆ·ä½¿ç”¨é¢‘ç‡ï¼‰ï¼š
${emotionalHooks.sustainingHooks.progressiveRevelation > 0.3 ? 'âœ“ æ¸è¿›æ­ç¤ºï¼š"æ›´é‡è¦çš„æ˜¯..."ã€"è¿˜æœ‰..."ï¼ˆ' + (emotionalHooks.sustainingHooks.progressiveRevelation * 100).toFixed(0) + '%ï¼‰\n' : ''}
${emotionalHooks.sustainingHooks.unexpectedTurn > 0.2 ? 'âœ“ æ„å¤–è½¬æŠ˜ï¼š"ä½†æ˜¯..."ã€"ç„¶è€Œ..."ï¼ˆ' + (emotionalHooks.sustainingHooks.unexpectedTurn * 100).toFixed(0) + '%ï¼‰\n' : ''}
${emotionalHooks.sustainingHooks.readerInvolvement > 0.15 ? 'âœ“ è¯»è€…å·å…¥ï¼š"ä½ æ˜¯å¦ä¹Ÿ..."ã€"æƒ³è±¡ä¸€ä¸‹..."ï¼ˆ' + (emotionalHooks.sustainingHooks.readerInvolvement * 100).toFixed(0) + '%ï¼‰\n' : ''}

ç»“å°¾é’©å­ï¼ˆç”¨æˆ·æœ€å¸¸ç”¨ï¼‰ï¼š
${Object.entries(emotionalHooks.closingHooks)
  .sort(([,a], [,b]) => (b as number) - (a as number))[0]?.[0] === 'callToAction' ? 'âœ“ è¡ŒåŠ¨å·å¬ï¼š"ä½ æ€ä¹ˆçœ‹ï¼Ÿ"ã€"æ¬¢è¿è®¨è®º"' :
  Object.entries(emotionalHooks.closingHooks).sort(([,a], [,b]) => (b as number) - (a as number))[0]?.[0] === 'thoughtProvoking' ? 'âœ“ å¼•å‘æ€è€ƒï¼š"è¿™è®©æˆ‘ä»¬æ€è€ƒ..."' :
  'âœ“ æ‚¬å¿µç»“å°¾ï¼š"ä¸‹æ¬¡åˆ†äº«..."'}

è®¾è®¡è¦æ±‚ï¼š
1. å¼€å¤´å¿…é¡»ä½¿ç”¨ç”¨æˆ·æœ€æœ‰æ•ˆçš„é’©å­ç±»å‹
2. ä¸­é—´é€‚å½“ä½¿ç”¨ç»´æŒé’©å­ï¼Œä¿æŒè¯»è€…å…´è¶£
3. ç»“å°¾ä½¿ç”¨ç”¨æˆ·ä¹ æƒ¯çš„é’©å­ç±»å‹
`;

  const prompt = `
åŸºäºä»¥ä¸‹å¤§çº²æ’°å†™å®Œæ•´æ–‡ç« ï¼š

${outline}

${hookGuide}

å†™ä½œè¦æ±‚ï¼š
1. ä¸¥æ ¼æŒ‰ç…§æƒ…ç»ªé’©å­æŒ‡å—è®¾è®¡å†…å®¹ç»“æ„
2. å¼€å¤´è¦å¸å¼•äººï¼Œä¸­é—´è¦ç»´æŒå…´è¶£ï¼Œç»“å°¾è¦æœ‰å†²å‡»åŠ›
3. æ•´ä½“ä¿æŒè¿è´¯å’Œè‡ªç„¶
`;

  const aiService = AIServiceFactory.createService({...});
  return await aiService.generateText(prompt);
}
```

---

## ğŸ“ åŠŸèƒ½4ï¼šå¥å¼æ¨¡æ¿æå–

### 4.1 åˆ†æç›®æ ‡

æå–ç”¨æˆ·é«˜é¢‘ä½¿ç”¨çš„å¥å­ç»“æ„æ¨¡æ¿ï¼Œç”¨äºï¼š
- å†…å®¹ç”Ÿæˆæ—¶çš„å¥å¼å‚è€ƒ
- ä¿æŒç”¨æˆ·ç‹¬ç‰¹çš„è¡¨è¾¾ä¹ æƒ¯
- æ„å»ºä¸ªæ€§åŒ–çš„å¥å¼åº“

### 4.2 æ•°æ®åº“è®¾è®¡

```sql
-- å¥å¼æ¨¡æ¿åº“
CREATE TABLE sentence_templates (
  id TEXT PRIMARY KEY,
  username TEXT NOT NULL,
  template_pattern TEXT NOT NULL,     -- å¥å¼æ¨¡æ¿
  frequency INTEGER DEFAULT 1,        -- ä½¿ç”¨é¢‘ç‡
  category TEXT,                      -- ç±»åˆ«ï¼šopening/development/closing
  emotion_type TEXT,                  -- æƒ…æ„Ÿç±»å‹ï¼šneutral/positive/negative
  avg_engagement REAL DEFAULT 0,      -- å¹³å‡äº’åŠ¨æ•°
  examples TEXT,                      -- JSON: å®é™…ä¾‹å­
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_sentence_templates_username ON sentence_templates(username);
CREATE INDEX idx_sentence_templates_frequency ON sentence_templates(frequency DESC);
CREATE INDEX idx_sentence_templates_category ON sentence_templates(category);

-- åœ¨ user_style_profile ä¸­æ·»åŠ æ‘˜è¦å­—æ®µ
ALTER TABLE user_style_profile ADD COLUMN
  sentence_templates_summary TEXT;  -- JSON: é«˜é¢‘æ¨¡æ¿æ‘˜è¦

-- ç¤ºä¾‹æ•°æ®
{
  "topTemplates": [
    {
      "pattern": "[PERSON]è§‰å¾—[THING][ADJ]",
      "frequency": 15,
      "examples": ["æˆ‘è§‰å¾—è¿™ä¸ªæŠ€æœ¯å¾ˆæœ‰æ½œåŠ›", "å¤§å®¶è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆä¸é”™"]
    },
    {
      "pattern": "[THING]çš„[ASPECT]éå¸¸[ADJ]",
      "frequency": 12,
      "examples": ["AIçš„å‘å±•éå¸¸è¿…é€Ÿ", "æŠ€æœ¯çš„åº”ç”¨éå¸¸å¹¿æ³›"]
    }
  ],
  "totalTemplates": 50
}
```

### 4.3 åˆ†æç®—æ³•

```typescript
interface SentenceTemplate {
  pattern: string;        // æ¨¡æ¿æ¨¡å¼
  frequency: number;      // é¢‘ç‡
  category: string;       // ç±»åˆ«
  emotionType: string;    // æƒ…æ„Ÿç±»å‹
  examples: string[];     // ä¾‹å­
}

export class AdvancedStyleAnalysisService {

  /**
   * æå–å¥å¼æ¨¡æ¿
   */
  extractSentenceTemplates(tweets: Array<{
    content: string;
    likeCount: number;
    retweetCount: number;
  }>): SentenceTemplate[] {

    const templateMap = new Map<string, {
      count: number;
      examples: Array<{text: string, engagement: number}>;
      category: string;
      emotionType: string;
    }>();

    tweets.forEach(tweet => {
      const sentences = this.splitIntoSentences(tweet.content);
      const engagement = tweet.likeCount + tweet.retweetCount * 2;

      sentences.forEach((sentence, index) => {
        // æå–æ¨¡æ¿
        const template = this.extractTemplatePattern(sentence);

        if (template && sentence.length >= 5 && sentence.length <= 100) {
          // åˆ¤æ–­ç±»åˆ«
          const category = index === 0 ? 'opening' :
                          index === sentences.length - 1 ? 'closing' :
                          'development';

          // åˆ¤æ–­æƒ…æ„Ÿç±»å‹
          const emotionType = this.detectEmotionType(sentence);

          if (!templateMap.has(template)) {
            templateMap.set(template, {
              count: 0,
              examples: [],
              category,
              emotionType,
            });
          }

          const entry = templateMap.get(template)!;
          entry.count++;
          entry.examples.push({ text: sentence, engagement });
        }
      });
    });

    // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
    const templates: SentenceTemplate[] = [];

    templateMap.forEach((value, pattern) => {
      // åªä¿ç•™å‡ºç°3æ¬¡ä»¥ä¸Šçš„æ¨¡æ¿
      if (value.count >= 3) {
        // é€‰æ‹©äº’åŠ¨æœ€é«˜çš„3ä¸ªä¾‹å­
        value.examples.sort((a, b) => b.engagement - a.engagement);

        templates.push({
          pattern,
          frequency: value.count,
          category: value.category,
          emotionType: value.emotionType,
          examples: value.examples.slice(0, 3).map(e => e.text),
        });
      }
    });

    // æŒ‰é¢‘ç‡æ’åº
    templates.sort((a, b) => b.frequency - a.frequency);

    return templates.slice(0, 50); // ä¿ç•™å‰50ä¸ª
  }

  /**
   * å°†æ–‡æœ¬åˆ†å‰²ä¸ºå¥å­
   */
  private splitIntoSentences(text: string): string[] {
    return text
      .split(/[ã€‚ï¼ï¼Ÿ\n]/)
      .map(s => s.trim())
      .filter(s => s.length > 0);
  }

  /**
   * æå–æ¨¡æ¿æ¨¡å¼
   */
  private extractTemplatePattern(sentence: string): string {
    let template = sentence;

    // 1. æ›¿æ¢æ•°å­— â†’ [NUM]
    template = template.replace(/\d+/g, '[NUM]');

    // 2. æ›¿æ¢è‹±æ–‡ â†’ [ENG]
    template = template.replace(/[a-zA-Z]+/g, '[ENG]');

    // 3. æ›¿æ¢å¸¸è§ä¸“ä¸šæœ¯è¯­ â†’ [TECH]
    const techTerms = ['AI', 'æœºå™¨å­¦ä¹ ', 'æ·±åº¦å­¦ä¹ ', 'åŒºå—é“¾', 'ç®—æ³•', 'æ¨¡å‹', 'æ•°æ®', 'æŠ€æœ¯'];
    techTerms.forEach(term => {
      template = template.replace(new RegExp(term, 'g'), '[TECH]');
    });

    // 4. æ›¿æ¢æ—¶é—´è¯ â†’ [TIME]
    const timeWords = ['ä»Šå¤©', 'æ˜¨å¤©', 'æ˜å¤©', 'æœ€è¿‘', 'ä»¥å‰', 'ç°åœ¨', 'æœªæ¥'];
    timeWords.forEach(word => {
      template = template.replace(new RegExp(word, 'g'), '[TIME]');
    });

    // 5. æ›¿æ¢äººç§° â†’ [PERSON]
    const persons = ['æˆ‘', 'ä½ ', 'ä»–', 'å¥¹', 'æˆ‘ä»¬', 'å¤§å®¶', 'ç”¨æˆ·'];
    persons.forEach(word => {
      template = template.replace(new RegExp(word, 'g'), '[PERSON]');
    });

    // 6. æ›¿æ¢å½¢å®¹è¯ â†’ [ADJ]
    const adjectives = ['å¥½', 'å', 'å¤§', 'å°', 'å¤š', 'å°‘', 'é«˜', 'ä½', 'å¿«', 'æ…¢', 'å¼º', 'å¼±', 'é‡è¦', 'æœ‰è¶£', 'æœ‰ç”¨'];
    adjectives.forEach(word => {
      template = template.replace(new RegExp(word, 'g'), '[ADJ]');
    });

    // 7. æ›¿æ¢æŠ½è±¡æ¦‚å¿µ â†’ [THING]
    // ä¿ç•™å¥å­ç»“æ„å’ŒåŠŸèƒ½è¯ï¼Œä½†å°†å®ä½“åè¯æŠ½è±¡åŒ–
    // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œæ£€æµ‹å¸¸è§æ¨¡å¼
    if (/çš„/.test(template)) {
      template = template.replace(/([^çš„]{2,8})çš„/g, '[THING]çš„');
    }

    return template;
  }

  /**
   * æ£€æµ‹æƒ…æ„Ÿç±»å‹
   */
  private detectEmotionType(sentence: string): string {
    const positiveWords = ['å¥½', 'æ£’', 'ä¼˜ç§€', 'æˆåŠŸ', 'å–œæ¬¢', 'å¼€å¿ƒ', 'å¸Œæœ›', 'ä¸é”™'];
    const negativeWords = ['å', 'å·®', 'å¤±è´¥', 'é—®é¢˜', 'æ‹…å¿ƒ', 'éš¾', 'ä¸è¡Œ'];

    const hasPositive = positiveWords.some(word => sentence.includes(word));
    const hasNegative = negativeWords.some(word => sentence.includes(word));

    if (hasPositive && !hasNegative) return 'positive';
    if (hasNegative && !hasPositive) return 'negative';
    return 'neutral';
  }

  /**
   * ä¿å­˜å¥å¼æ¨¡æ¿åˆ°æ•°æ®åº“
   */
  async saveSentenceTemplates(username: string, templates: SentenceTemplate[]): Promise<void> {
    // åˆ é™¤æ—§æ¨¡æ¿
    await db.sentenceTemplate.deleteMany({
      where: { username }
    });

    // ä¿å­˜æ–°æ¨¡æ¿
    for (const template of templates) {
      await db.sentenceTemplate.create({
        data: {
          username,
          templatePattern: template.pattern,
          frequency: template.frequency,
          category: template.category,
          emotionType: template.emotionType,
          examples: JSON.stringify(template.examples),
        }
      });
    }

    // æ›´æ–°é£æ ¼æ¡£æ¡ˆæ‘˜è¦
    const topTemplates = templates.slice(0, 10).map(t => ({
      pattern: t.pattern,
      frequency: t.frequency,
      examples: t.examples.slice(0, 2),
    }));

    // æ›´æ–°æ‰€æœ‰å†…å®¹ç±»å‹çš„æ¡£æ¡ˆ
    await db.userStyleProfile.updateMany({
      where: { username },
      data: {
        sentenceTemplatesSummary: JSON.stringify({
          topTemplates,
          totalTemplates: templates.length,
        })
      }
    });
  }
}
```

### 4.4 åœ¨å†…å®¹ç”Ÿæˆä¸­çš„åº”ç”¨

```typescript
async function generateWithSentenceTemplates(
  task: any,
  outline: string
): Promise<string> {
  // 1. è·å–ç”¨æˆ·çš„å¥å¼æ¨¡æ¿
  const templates = await db.sentenceTemplate.findMany({
    where: { username: task.username },
    orderBy: { frequency: 'desc' },
    take: 10,
  });

  if (templates.length === 0) {
    return generateContent(task, outline);
  }

  // 2. æ„å»ºå¥å¼å‚è€ƒ
  const templateGuide = `
ã€å¥å¼é£æ ¼å‚è€ƒã€‘

ç”¨æˆ·${task.username}çš„é«˜é¢‘å¥å¼æ¨¡æ¿ï¼š

å¼€å¤´å¸¸ç”¨å¥å¼ï¼š
${templates
  .filter(t => t.category === 'opening')
  .slice(0, 3)
  .map((t, i) => {
    const examples = JSON.parse(t.examples);
    return `${i+1}. æ¨¡æ¿ï¼š${t.templatePattern}\n   ç¤ºä¾‹ï¼š${examples[0]}`;
  })
  .join('\n\n')}

æ­£æ–‡å¸¸ç”¨å¥å¼ï¼š
${templates
  .filter(t => t.category === 'development')
  .slice(0, 5)
  .map((t, i) => {
    const examples = JSON.parse(t.examples);
    return `${i+1}. æ¨¡æ¿ï¼š${t.templatePattern}\n   ç¤ºä¾‹ï¼š${examples[0]}`;
  })
  .join('\n\n')}

å†™ä½œè¦æ±‚ï¼š
1. å‚è€ƒä»¥ä¸Šå¥å¼æ¨¡æ¿ï¼Œæ¨¡ä»¿ç”¨æˆ·çš„è¡¨è¾¾ä¹ æƒ¯
2. ä¸è¦ç”Ÿç¡¬å¥—ç”¨ï¼Œè¦è‡ªç„¶èå…¥å†…å®¹
3. ä¿æŒå¥å¼çš„å¤šæ ·æ€§ï¼Œé€‚å½“å˜åŒ–
`;

  const prompt = `
åŸºäºä»¥ä¸‹å¤§çº²æ’°å†™å®Œæ•´æ–‡ç« ï¼š

${outline}

${templateGuide}

æ³¨æ„ï¼šå‚è€ƒç”¨æˆ·çš„å¥å¼ä¹ æƒ¯ï¼Œä½†è¦æ ¹æ®å…·ä½“å†…å®¹çµæ´»è¿ç”¨ã€‚
`;

  const aiService = AIServiceFactory.createService({...});
  return await aiService.generateText(prompt);
}
```

---

## ğŸ¨ åŠŸèƒ½5ï¼šå™è¿°é£æ ¼åˆ†æ

### 5.1 åˆ†æç›®æ ‡

æ·±åº¦åˆ†æç”¨æˆ·çš„å™è¿°åå¥½ï¼š
- **æ•…äº‹æ€§**ï¼šä¸ªäººè½¶äº‹ã€æ—¶é—´é¡ºåºã€äººç‰©å¡‘é€ 
- **è¯´æœæ€§**ï¼šé€»è¾‘è®ºè¯ã€è¯æ®æ”¯æŒã€æƒ…æ„Ÿè¯‰æ±‚
- **äº’åŠ¨æ€§**ï¼šç›´æ¥ç§°å‘¼ã€æé—®äº’åŠ¨ã€å¯¹è¯è¯­è°ƒ
- **æƒå¨æ€§**ï¼šä¸“ä¸šå±•ç¤ºã€è‡ªä¿¡ç¨‹åº¦ã€å¼•ç”¨ä½¿ç”¨

### 5.2 æ•°æ®åº“è®¾è®¡

```sql
ALTER TABLE user_style_profile ADD COLUMN
  narrative_style TEXT;  -- JSON: å™è¿°é£æ ¼ç‰¹å¾

-- ç¤ºä¾‹æ•°æ®
{
  "storytelling": {
    "usePersonalAnecdotes": 0.40,      // 40%ä½¿ç”¨ä¸ªäººæ•…äº‹
    "chronologicalOrder": 0.55,        // 55%ä½¿ç”¨æ—¶é—´é¡ºåº
    "characterDevelopment": 0.25       // 25%æœ‰äººç‰©å¡‘é€ 
  },
  "persuasion": {
    "logicalArgument": 0.65,           // 65%ä½¿ç”¨é€»è¾‘è®ºè¯
    "evidenceSupport": 0.50,           // 50%æä¾›è¯æ®æ”¯æŒ
    "emotionalAppeal": 0.35            // 35%ä½¿ç”¨æƒ…æ„Ÿè¯‰æ±‚
  },
  "interaction": {
    "directAddress": 0.60,             // 60%ç›´æ¥ç§°å‘¼è¯»è€…
    "questionEngagement": 0.45,        // 45%ä½¿ç”¨æé—®äº’åŠ¨
    "conversationalTone": 0.70         // 70%ä½¿ç”¨å¯¹è¯è¯­è°ƒ
  },
  "authority": {
    "expertiseDisplay": 0.55,          // 55%å±•ç¤ºä¸“ä¸šçŸ¥è¯†
    "confidenceLevel": 0.75,           // 75%è¯­æ°”è‡ªä¿¡
    "citationUsage": 0.30              // 30%ä½¿ç”¨å¼•ç”¨
  },
  "dominantStyle": "persuasion"        // ä¸»å¯¼é£æ ¼
}
```

### 5.3 åˆ†æç®—æ³•

```typescript
interface NarrativeStyle {
  storytelling: {
    usePersonalAnecdotes: number;
    chronologicalOrder: number;
    characterDevelopment: number;
  };
  persuasion: {
    logicalArgument: number;
    evidenceSupport: number;
    emotionalAppeal: number;
  };
  interaction: {
    directAddress: number;
    questionEngagement: number;
    conversationalTone: number;
  };
  authority: {
    expertiseDisplay: number;
    confidenceLevel: number;
    citationUsage: number;
  };
  dominantStyle: string;
}

export class AdvancedStyleAnalysisService {

  /**
   * åˆ†æå™è¿°é£æ ¼
   */
  analyzeNarrativeStyle(tweets: Array<{content: string}>): NarrativeStyle {
    const style: NarrativeStyle = {
      storytelling: {
        usePersonalAnecdotes: 0,
        chronologicalOrder: 0,
        characterDevelopment: 0,
      },
      persuasion: {
        logicalArgument: 0,
        evidenceSupport: 0,
        emotionalAppeal: 0,
      },
      interaction: {
        directAddress: 0,
        questionEngagement: 0,
        conversationalTone: 0,
      },
      authority: {
        expertiseDisplay: 0,
        confidenceLevel: 0,
        citationUsage: 0,
      },
      dominantStyle: '',
    };

    tweets.forEach(tweet => {
      const content = tweet.content;

      // 1. æ•…äº‹æ€§åˆ†æ

      // ä¸ªäººè½¶äº‹
      if (/(æˆ‘|å’±).{0,5}(é‡åˆ°|ç»å†|å‘ç°|çœ‹åˆ°|å¬åˆ°)/.test(content)) {
        style.storytelling.usePersonalAnecdotes++;
      }

      // æ—¶é—´é¡ºåº
      if (/(é¦–å…ˆ|ç„¶å|æ¥ç€|æœ€å|ä¹‹å|åæ¥|å†åæ¥)/.test(content)) {
        style.storytelling.chronologicalOrder++;
      }

      // äººç‰©å¡‘é€ ï¼ˆæè¿°äººç‰©ç‰¹å¾ã€è¡Œä¸ºï¼‰
      if (/(ä»–|å¥¹|è¿™ä¸ªäºº|é‚£ä¸ªäºº).{0,10}(è¯´|åš|æƒ³|è®¤ä¸º)/.test(content)) {
        style.storytelling.characterDevelopment++;
      }

      // 2. è¯´æœæ€§åˆ†æ

      // é€»è¾‘è®ºè¯
      if (/(å› ä¸º|æ‰€ä»¥|å› æ­¤|ç”±äº|æ—¢ç„¶|é‚£ä¹ˆ)/.test(content)) {
        style.persuasion.logicalArgument++;
      }

      // è¯æ®æ”¯æŒ
      if (/(æ•°æ®|ç ”ç©¶|æŠ¥å‘Š|ç»Ÿè®¡|è°ƒæŸ¥|äº‹å®|è¯æ˜|è¡¨æ˜)/.test(content)) {
        style.persuasion.evidenceSupport++;
      }

      // æƒ…æ„Ÿè¯‰æ±‚
      if (/(æ„ŸåŠ¨|éœ‡æƒŠ|æ‹…å¿ƒ|å¸Œæœ›|ç›¸ä¿¡|æ¢¦æƒ³|å®³æ€•)/.test(content)) {
        style.persuasion.emotionalAppeal++;
      }

      // 3. äº’åŠ¨æ€§åˆ†æ

      // ç›´æ¥ç§°å‘¼
      if (/(ä½ |æ‚¨|å¤§å®¶|å„ä½|æœ‹å‹ä»¬)/.test(content)) {
        style.interaction.directAddress++;
      }

      // æé—®äº’åŠ¨
      const questionCount = (content.match(/[ï¼Ÿ?]/g) || []).length;
      if (questionCount > 0) {
        style.interaction.questionEngagement++;
      }

      // å¯¹è¯è¯­è°ƒï¼ˆå£è¯­åŒ–è¡¨è¾¾ï¼‰
      if (/(å˜›|å‘¢|å•¦|å“¦|å“ˆ|å§|å‘€|å’¯)/.test(content)) {
        style.interaction.conversationalTone++;
      }

      // 4. æƒå¨æ€§åˆ†æ

      // ä¸“ä¸šçŸ¥è¯†å±•ç¤ºï¼ˆä½¿ç”¨ä¸“ä¸šæœ¯è¯­ï¼‰
      const techCount = (content.match(/[a-zA-Z]{3,}/g) || []).length;
      if (techCount >= 3) {
        style.authority.expertiseDisplay++;
      }

      // è‡ªä¿¡ç¨‹åº¦ï¼ˆä½¿ç”¨æ–­è¨€æ€§è¯æ±‡ï¼‰
      if (/(å¿…é¡»|ä¸€å®š|è‚¯å®š|æ˜¾ç„¶|æ¯«æ— ç–‘é—®|æ¯‹åº¸ç½®ç–‘|ç¡®å®)/.test(content)) {
        style.authority.confidenceLevel++;
      }

      // å¼•ç”¨ä½¿ç”¨
      if (/(æ ¹æ®|å¼•ç”¨|æ¥è‡ª|å‡ºè‡ª|[ã€Š""''])/.test(content)) {
        style.authority.citationUsage++;
      }
    });

    // è½¬æ¢ä¸ºæ¯”ä¾‹
    const total = tweets.length;

    Object.keys(style.storytelling).forEach(key => {
      style.storytelling[key as keyof typeof style.storytelling] /= total;
    });
    Object.keys(style.persuasion).forEach(key => {
      style.persuasion[key as keyof typeof style.persuasion] /= total;
    });
    Object.keys(style.interaction).forEach(key => {
      style.interaction[key as keyof typeof style.interaction] /= total;
    });
    Object.keys(style.authority).forEach(key => {
      style.authority[key as keyof typeof style.authority] /= total;
    });

    // ç¡®å®šä¸»å¯¼é£æ ¼
    const styleScores = {
      storytelling: this.average(Object.values(style.storytelling)),
      persuasion: this.average(Object.values(style.persuasion)),
      interaction: this.average(Object.values(style.interaction)),
      authority: this.average(Object.values(style.authority)),
    };

    style.dominantStyle = Object.entries(styleScores)
      .sort(([,a], [,b]) => b - a)[0][0];

    return style;
  }

  private average(numbers: number[]): number {
    return numbers.reduce((a, b) => a + b, 0) / numbers.length;
  }
}
```

### 5.4 åœ¨å†…å®¹ç”Ÿæˆä¸­çš„åº”ç”¨

```typescript
async function generateWithNarrativeStyle(
  task: any,
  outline: string
): Promise<string> {
  const profile = await db.userStyleProfile.findUnique({
    where: {
      username_contentType: {
        username: task.username,
        contentType: task.contentType
      }
    }
  });

  const narrativeStyle = profile?.narrativeStyle
    ? JSON.parse(profile.narrativeStyle) as NarrativeStyle
    : null;

  if (!narrativeStyle) {
    return generateContent(task, outline);
  }

  // æ ¹æ®ä¸»å¯¼é£æ ¼æ„å»ºæŒ‡ä»¤
  const styleGuide = buildNarrativeStyleGuide(narrativeStyle);

  const prompt = `
åŸºäºä»¥ä¸‹å¤§çº²æ’°å†™å®Œæ•´æ–‡ç« ï¼š

${outline}

${styleGuide}

å†™ä½œè¦æ±‚ï¼š
1. ä¸¥æ ¼éµå¾ªç”¨æˆ·çš„å™è¿°é£æ ¼ç‰¹å¾
2. ä¿æŒé£æ ¼çš„ä¸€è‡´æ€§
3. å†…å®¹å……å®ï¼Œé€»è¾‘è¿è´¯
`;

  const aiService = AIServiceFactory.createService({...});
  return await aiService.generateText(prompt);
}

function buildNarrativeStyleGuide(style: NarrativeStyle): string {
  const guide: string[] = [
    `ã€å™è¿°é£æ ¼æŒ‡å—ã€‘`,
    ``,
    `ç”¨æˆ·çš„ä¸»å¯¼å™è¿°é£æ ¼ï¼š${style.dominantStyle === 'storytelling' ? 'æ•…äº‹æ€§' :
                              style.dominantStyle === 'persuasion' ? 'è¯´æœæ€§' :
                              style.dominantStyle === 'interaction' ? 'äº’åŠ¨æ€§' : 'æƒå¨æ€§'}`,
    ``,
  ];

  // æ•…äº‹æ€§
  if (style.storytelling.usePersonalAnecdotes > 0.3) {
    guide.push(`âœ“ æ•…äº‹æ€§ï¼ˆé«˜ï¼‰ï¼š`);
    if (style.storytelling.usePersonalAnecdotes > 0.3) {
      guide.push(`  - ç»å¸¸ä½¿ç”¨ä¸ªäººæ•…äº‹å’Œç»å†ï¼ˆ${(style.storytelling.usePersonalAnecdotes * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - å¤šç”¨"æˆ‘é‡åˆ°..."ã€"æˆ‘å‘ç°..."ç­‰ç¬¬ä¸€äººç§°å™è¿°`);
    }
    if (style.storytelling.chronologicalOrder > 0.4) {
      guide.push(`  - å–œæ¬¢æŒ‰æ—¶é—´é¡ºåºå™è¿°ï¼ˆ${(style.storytelling.chronologicalOrder * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - ä½¿ç”¨"é¦–å…ˆ...ç„¶å...æœ€å..."çš„ç»“æ„`);
    }
    guide.push(``);
  }

  // è¯´æœæ€§
  if (style.persuasion.logicalArgument > 0.5) {
    guide.push(`âœ“ è¯´æœæ€§ï¼ˆé«˜ï¼‰ï¼š`);
    if (style.persuasion.logicalArgument > 0.5) {
      guide.push(`  - å¼ºè°ƒé€»è¾‘è®ºè¯ï¼ˆ${(style.persuasion.logicalArgument * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - å¤šä½¿ç”¨"å› ä¸º...æ‰€ä»¥..."ã€"ç”±äº...å› æ­¤..."çš„é€»è¾‘è¿æ¥`);
    }
    if (style.persuasion.evidenceSupport > 0.4) {
      guide.push(`  - æ³¨é‡è¯æ®æ”¯æŒï¼ˆ${(style.persuasion.evidenceSupport * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - å¼•ç”¨æ•°æ®ã€ç ”ç©¶ã€ç»Ÿè®¡æ¥æ”¯æ’‘è§‚ç‚¹`);
    }
    if (style.persuasion.emotionalAppeal > 0.3) {
      guide.push(`  - é€‚åº¦ä½¿ç”¨æƒ…æ„Ÿè¯‰æ±‚ï¼ˆ${(style.persuasion.emotionalAppeal * 100).toFixed(0)}%ï¼‰`);
    }
    guide.push(``);
  }

  // äº’åŠ¨æ€§
  if (style.interaction.directAddress > 0.5) {
    guide.push(`âœ“ äº’åŠ¨æ€§ï¼ˆé«˜ï¼‰ï¼š`);
    if (style.interaction.directAddress > 0.5) {
      guide.push(`  - ç»å¸¸ç›´æ¥ç§°å‘¼è¯»è€…ï¼ˆ${(style.interaction.directAddress * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - å¤šä½¿ç”¨"ä½ "ã€"å¤§å®¶"ç­‰ç¬¬äºŒäººç§°`);
    }
    if (style.interaction.questionEngagement > 0.3) {
      guide.push(`  - é¢‘ç¹ä½¿ç”¨æé—®äº’åŠ¨ï¼ˆ${(style.interaction.questionEngagement * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - é€‚æ—¶æŠ›å‡ºé—®é¢˜å¼•å¯¼æ€è€ƒ`);
    }
    if (style.interaction.conversationalTone > 0.6) {
      guide.push(`  - ä½¿ç”¨å¯¹è¯è¯­è°ƒï¼ˆ${(style.interaction.conversationalTone * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - è¯­æ°”è½»æ¾ï¼Œåƒæœ‹å‹èŠå¤©ä¸€æ ·`);
    }
    guide.push(``);
  }

  // æƒå¨æ€§
  if (style.authority.expertiseDisplay > 0.4) {
    guide.push(`âœ“ æƒå¨æ€§ï¼ˆé«˜ï¼‰ï¼š`);
    if (style.authority.expertiseDisplay > 0.4) {
      guide.push(`  - å±•ç¤ºä¸“ä¸šçŸ¥è¯†ï¼ˆ${(style.authority.expertiseDisplay * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - é€‚å½“ä½¿ç”¨ä¸“ä¸šæœ¯è¯­å±•ç¤ºæ·±åº¦`);
    }
    if (style.authority.confidenceLevel > 0.6) {
      guide.push(`  - è¯­æ°”è‡ªä¿¡åšå®šï¼ˆ${(style.authority.confidenceLevel * 100).toFixed(0)}%ï¼‰`);
      guide.push(`  - ä½¿ç”¨"å¿…é¡»"ã€"æ˜¾ç„¶"ã€"æ¯«æ— ç–‘é—®"ç­‰æ–­è¨€æ€§è¯æ±‡`);
    }
    if (style.authority.citationUsage > 0.2) {
      guide.push(`  - é€‚åº¦å¼•ç”¨æƒå¨æ¥æºï¼ˆ${(style.authority.citationUsage * 100).toFixed(0)}%ï¼‰`);
    }
    guide.push(``);
  }

  return guide.join('\n');
}
```

---

## ğŸ”„ é›†æˆæµç¨‹

### å®Œæ•´çš„åˆ†ææµç¨‹

```typescript
/**
 * æ‰§è¡Œå®Œæ•´çš„è¿›é˜¶é£æ ¼åˆ†æ
 */
async function performAdvancedStyleAnalysis(username: string): Promise<void> {
  const service = new AdvancedStyleAnalysisService();

  // 1. è·å–ç”¨æˆ·æ¨æ–‡
  const tweets = await db.writingAnalysisTweet.findMany({
    where: { userUsername: username },
    select: {
      id: true,
      content: true,
      likeCount: true,
      retweetCount: true,
      replyCount: true,
    }
  });

  if (tweets.length < 10) {
    throw new Error('æ¨æ–‡æ•°é‡ä¸è¶³ï¼Œéœ€è¦è‡³å°‘10æ¡');
  }

  // 2. æŒ‰å†…å®¹ç±»å‹åˆ†ç»„
  const typeAnnotations = await db.tweetTypeAnnotation.findMany({
    where: { username }
  });

  const tweetsByType = new Map<string, typeof tweets>();

  tweets.forEach(tweet => {
    const annotation = typeAnnotations.find(a => a.tweetId === tweet.id);
    if (annotation) {
      const types = JSON.parse(annotation.tweetTypes);
      const mainType = Object.entries(types)
        .sort(([,a], [,b]) => (b as number) - (a as number))[0][0];

      if (!tweetsByType.has(mainType)) {
        tweetsByType.set(mainType, []);
      }
      tweetsByType.get(mainType)!.push(tweet);
    }
  });

  // 3. å¯¹æ¯ä¸ªå†…å®¹ç±»å‹è¿›è¡Œè¿›é˜¶åˆ†æ
  for (const [contentType, typeTweets] of tweetsByType) {
    if (typeTweets.length < 5) continue; // æ ·æœ¬ä¸è¶³è·³è¿‡

    console.log(`åˆ†æç”¨æˆ· ${username} çš„ ${contentType} ç±»å‹...`);

    // 3.1 å¼€å¤´æ¨¡å¼è¯†åˆ«
    const openingPatterns = service.analyzeOpeningPatterns(typeTweets);

    // 3.2 å¸å¼•åŠ›åˆ†æ
    await service.analyzeUserAttraction(username);

    // 3.3 æƒ…ç»ªé’©å­è¯†åˆ«
    const emotionalHooks = service.analyzeEmotionalHooks(typeTweets);

    // 3.4 å¥å¼æ¨¡æ¿æå–
    const sentenceTemplates = service.extractSentenceTemplates(typeTweets);
    await service.saveSentenceTemplates(username, sentenceTemplates);

    // 3.5 å™è¿°é£æ ¼åˆ†æ
    const narrativeStyle = service.analyzeNarrativeStyle(typeTweets);

    // 4. ä¿å­˜åˆ°æ•°æ®åº“
    await db.userStyleProfile.update({
      where: {
        username_contentType: {
          username,
          contentType
        }
      },
      data: {
        openingPatterns: JSON.stringify(openingPatterns),
        emotionalHooks: JSON.stringify(emotionalHooks),
        narrativeStyle: JSON.stringify(narrativeStyle),
        updatedAt: new Date(),
      }
    });

    console.log(`âœ“ ${contentType} ç±»å‹åˆ†æå®Œæˆ`);
  }

  console.log(`ç”¨æˆ· ${username} çš„è¿›é˜¶é£æ ¼åˆ†æå…¨éƒ¨å®Œæˆï¼`);
}
```

### API è·¯ç”±

```typescript
// POST /api/writing-analysis/advanced-style-analysis
export async function POST(request: NextRequest) {
  try {
    const { username } = await request.json();

    if (!username) {
      return NextResponse.json(
        { success: false, error: 'Username is required' },
        { status: 400 }
      );
    }

    // æ‰§è¡Œè¿›é˜¶åˆ†æ
    await performAdvancedStyleAnalysis(username);

    return NextResponse.json({
      success: true,
      message: 'è¿›é˜¶é£æ ¼åˆ†æå®Œæˆ',
      data: { username }
    });

  } catch (error) {
    console.error('è¿›é˜¶é£æ ¼åˆ†æå¤±è´¥:', error);
    return NextResponse.json(
      {
        success: false,
        error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
      },
      { status: 500 }
    );
  }
}
```

---

## ğŸ“Š å‰ç«¯å±•ç¤ºç•Œé¢

### åœ¨é£æ ¼æ¡£æ¡ˆé¡µé¢æ·»åŠ è¿›é˜¶ç‰¹å¾å±•ç¤º

```tsx
// è¿›é˜¶ç‰¹å¾å±•ç¤ºç»„ä»¶
function AdvancedStyleFeatures({ profile }: { profile: UserStyleProfile }) {
  const [expandedSections, setExpandedSections] = useState<string[]>([]);

  const toggleSection = (section: string) => {
    setExpandedSections(prev =>
      prev.includes(section)
        ? prev.filter(s => s !== section)
        : [...prev, section]
    );
  };

  return (
    <div className="space-y-4">
      {/* å¼€å¤´æ¨¡å¼ */}
      {profile.openingPatterns && (
        <div className="border rounded-lg overflow-hidden">
          <button
            onClick={() => toggleSection('opening')}
            className="w-full px-4 py-3 bg-gray-50 flex justify-between items-center hover:bg-gray-100"
          >
            <span className="font-medium">ğŸ¯ å¼€å¤´æ¨¡å¼åˆ†å¸ƒ</span>
            <span>{expandedSections.includes('opening') ? 'â–¼' : 'â–¶'}</span>
          </button>

          {expandedSections.includes('opening') && (
            <div className="p-4">
              <OpeningPatternsVisualization data={JSON.parse(profile.openingPatterns)} />
            </div>
          )}
        </div>
      )}

      {/* å¸å¼•åŠ›ç‰¹å¾ */}
      {profile.attractionProfile && (
        <div className="border rounded-lg overflow-hidden">
          <button
            onClick={() => toggleSection('attraction')}
            className="w-full px-4 py-3 bg-gray-50 flex justify-between items-center hover:bg-gray-100"
          >
            <span className="font-medium">ğŸ’¡ å¸å¼•åŠ›ç‰¹å¾</span>
            <span>{expandedSections.includes('attraction') ? 'â–¼' : 'â–¶'}</span>
          </button>

          {expandedSections.includes('attraction') && (
            <div className="p-4">
              <AttractionProfileVisualization data={JSON.parse(profile.attractionProfile)} />
            </div>
          )}
        </div>
      )}

      {/* æƒ…ç»ªé’©å­ */}
      {profile.emotionalHooks && (
        <div className="border rounded-lg overflow-hidden">
          <button
            onClick={() => toggleSection('hooks')}
            className="w-full px-4 py-3 bg-gray-50 flex justify-between items-center hover:bg-gray-100"
          >
            <span className="font-medium">ğŸ£ æƒ…ç»ªé’©å­æ¨¡å¼</span>
            <span>{expandedSections.includes('hooks') ? 'â–¼' : 'â–¶'}</span>
          </button>

          {expandedSections.includes('hooks') && (
            <div className="p-4">
              <EmotionalHooksVisualization data={JSON.parse(profile.emotionalHooks)} />
            </div>
          )}
        </div>
      )}

      {/* å™è¿°é£æ ¼ */}
      {profile.narrativeStyle && (
        <div className="border rounded-lg overflow-hidden">
          <button
            onClick={() => toggleSection('narrative')}
            className="w-full px-4 py-3 bg-gray-50 flex justify-between items-center hover:bg-gray-100"
          >
            <span className="font-medium">ğŸ¨ å™è¿°é£æ ¼ç‰¹å¾</span>
            <span>{expandedSections.includes('narrative') ? 'â–¼' : 'â–¶'}</span>
          </button>

          {expandedSections.includes('narrative') && (
            <div className="p-4">
              <NarrativeStyleVisualization data={JSON.parse(profile.narrativeStyle)} />
            </div>
          )}
        </div>
      )}

      {/* å¥å¼æ¨¡æ¿ */}
      {profile.sentenceTemplatesSummary && (
        <div className="border rounded-lg overflow-hidden">
          <button
            onClick={() => toggleSection('templates')}
            className="w-full px-4 py-3 bg-gray-50 flex justify-between items-center hover:bg-gray-100"
          >
            <span className="font-medium">ğŸ“ é«˜é¢‘å¥å¼æ¨¡æ¿</span>
            <span>{expandedSections.includes('templates') ? 'â–¼' : 'â–¶'}</span>
          </button>

          {expandedSections.includes('templates') && (
            <div className="p-4">
              <SentenceTemplatesVisualization data={JSON.parse(profile.sentenceTemplatesSummary)} />
            </div>
          )}
        </div>
      )}
    </div>
  );
}
```

---

## ğŸ“ˆ æ•ˆæœé¢„æœŸ

å®æ–½è¿™5ä¸ªè¿›é˜¶åŠŸèƒ½åï¼š

1. **å¼€å¤´æ¨¡å¼è¯†åˆ«** â†’ ç”Ÿæˆçš„å†…å®¹å¼€å¤´æ›´å¸å¼•äººï¼Œç¬¦åˆç”¨æˆ·ä¹ æƒ¯
2. **å¸å¼•åŠ›åˆ†æ** â†’ å¯ä»¥é¢„æµ‹å’Œä¼˜åŒ–å†…å®¹è´¨é‡ï¼Œæé«˜äº’åŠ¨ç‡
3. **æƒ…ç»ªé’©å­è¯†åˆ«** â†’ å†…å®¹æ›´æœ‰æ„ŸæŸ“åŠ›ï¼Œè¯»è€…æ›´æ„¿æ„è¯»å®Œ
4. **å¥å¼æ¨¡æ¿æå–** â†’ ç”Ÿæˆçš„æ–‡å­—æ›´åƒç”¨æˆ·æœ¬äººå†™çš„
5. **å™è¿°é£æ ¼åˆ†æ** â†’ æ•´ä½“å™è¿°æ–¹å¼é«˜åº¦ä¸ªæ€§åŒ–

**é‡åŒ–ç›®æ ‡ï¼š**
- ç”Ÿæˆå†…å®¹çš„"åƒç”¨æˆ·æœ¬äººå†™çš„"ç¨‹åº¦ï¼šä»60%æå‡åˆ°85%+
- å†…å®¹å¸å¼•åŠ›åˆ†æ•°ï¼šæå‡20-30%
- ç”¨æˆ·æ»¡æ„åº¦ï¼šæå‡è‡³90%+

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1ï¼šæ•°æ®åº“å’ŒåŸºç¡€ç®—æ³•ï¼ˆ1-2å¤©ï¼‰
1. åˆ›å»º/ä¿®æ”¹æ•°æ®åº“è¡¨
2. å®ç°5ä¸ªåˆ†æç®—æ³•
3. å•å…ƒæµ‹è¯•

### Phase 2ï¼šAPIå’Œé›†æˆï¼ˆ1å¤©ï¼‰
1. åˆ›å»ºAPIè·¯ç”±
2. é›†æˆåˆ°ç°æœ‰åˆ†ææµç¨‹
3. æµ‹è¯•ç«¯åˆ°ç«¯æµç¨‹

### Phase 3ï¼šå†…å®¹ç”Ÿæˆåº”ç”¨ï¼ˆ2-3å¤©ï¼‰
1. ä¿®æ”¹ generateOutline å‡½æ•°
2. ä¿®æ”¹ generateContent å‡½æ•°
3. æ·»åŠ ç”Ÿæˆåè¯„ä¼°

### Phase 4ï¼šå‰ç«¯å±•ç¤ºï¼ˆ1-2å¤©ï¼‰
1. åˆ›å»ºå¯è§†åŒ–ç»„ä»¶
2. æ›´æ–°é£æ ¼æ¡£æ¡ˆé¡µé¢
3. æ·»åŠ åˆ†æè§¦å‘æŒ‰é’®

### Phase 5ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
1. ç«¯åˆ°ç«¯æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·åé¦ˆæ”¶é›†

**æ€»é¢„è®¡æ—¶é—´ï¼š6-10å¤©**

---

## âœ… éªŒæ”¶æ ‡å‡†

1. æ•°æ®åº“æ­£ç¡®å­˜å‚¨æ‰€æœ‰è¿›é˜¶ç‰¹å¾
2. åˆ†æç®—æ³•å‡†ç¡®è¯†åˆ«å„é¡¹ç‰¹å¾
3. ç”Ÿæˆçš„å†…å®¹æ˜æ˜¾ä½“ç°ç”¨æˆ·é£æ ¼
4. å‰ç«¯æ¸…æ™°å±•ç¤ºæ‰€æœ‰åˆ†æç»“æœ
5. æ•´ä½“æµç¨‹ç¨³å®šå¯é 

å‡†å¤‡å¼€å§‹å®æ–½å—ï¼Ÿ