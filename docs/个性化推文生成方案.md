# åŸºäºé£æ ¼åˆ†æçš„ä¸ªæ€§åŒ–æ¨æ–‡ç”Ÿæˆæ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

å®Œå…¨é‡æ„ç°æœ‰"å†…å®¹ç”Ÿæˆ"åŠŸèƒ½,æ”¹ä¸º**ä¸ªæ€§åŒ–æ¨æ–‡ç”Ÿæˆå™¨**,è®©ç”¨æˆ·ä»…é€šè¿‡è¾“å…¥`username`å’Œ`å†…å®¹ç±»å‹`å³å¯ç”Ÿæˆç¬¦åˆå…¶å†™ä½œé£æ ¼çš„æ¨æ–‡ã€‚ç³»ç»Ÿå°†å……åˆ†åˆ©ç”¨å·²æœ‰çš„å†™ä½œåˆ†ææ•°æ®,åŒ…æ‹¬:

1. **UserWritingOverview** (LLMé©±åŠ¨çš„å†™ä½œæ¦‚è§ˆ)
2. **UserStyleProfile** (ç±»å‹åŒ–çš„é£æ ¼æ¡£æ¡ˆ)
3. **TweetTypeAnnotation** (æ¨æ–‡ç±»å‹æ ‡æ³¨æ•°æ®)
4. **WritingAnalysisTweet** (ç”¨æˆ·å†å²æ¨æ–‡)

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### ä»"æ–‡ç« ç”Ÿæˆ"åˆ°"æ¨æ–‡ç”Ÿæˆ"
- **æ—§æ¨¡å¼**: ä¸»é¢˜ + å¹³å° + å‚è€ƒæ–‡ç«  + å†…å®¹ç»“æ„ â†’ ç”Ÿæˆé•¿æ–‡ç« 
- **æ–°æ¨¡å¼**: username + å†…å®¹ç±»å‹ â†’ ç”Ÿæˆé£æ ¼åŒ–æ¨æ–‡

### æ•°æ®é©±åŠ¨çš„ä¸ªæ€§åŒ–
å®Œå…¨ä¾èµ–åˆ†æç³»ç»Ÿå·²æ”¶é›†çš„ç”¨æˆ·é£æ ¼æ•°æ®,ä¸éœ€è¦é¢å¤–é…ç½®:
```
ç”¨æˆ·æ•°æ® â†’ é£æ ¼åˆ†æ â†’ å†…å®¹ç”Ÿæˆ â†’ ä¸ªæ€§åŒ–æ¨æ–‡
```

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1. æ•°æ®å±‚æ”¹é€ 

#### 1.1 æ–°å¢æ¨æ–‡ç”Ÿæˆä»»åŠ¡è¡¨
```prisma
// æ¨æ–‡ç”Ÿæˆä»»åŠ¡è¡¨
model TweetGenerationTask {
  id                String   @id @default(cuid())

  // åŸºæœ¬è¾“å…¥å‚æ•°
  username          String   // ç›®æ ‡ç”¨æˆ·å @testuser
  contentType       String   // å†…å®¹ç±»å‹,å¯¹åº”TWEET_TYPES
  topic             String?  // å¯é€‰çš„ä¸»é¢˜/è¯é¢˜

  // ç”Ÿæˆé…ç½®
  generateCount     Int      @default(3) // ç”Ÿæˆæ¨æ–‡æ•°é‡
  lengthPreference  String   @default("auto") // auto | short | medium | long

  // AIé…ç½®
  aiProvider        String   @default("openai")
  aiModel           String   @default("gpt-4o")
  temperature       Float    @default(0.7) // è¾ƒé«˜æ¸©åº¦ä¿æŒåˆ›æ„

  // ä»»åŠ¡çŠ¶æ€
  status            String   @default("pending") // pending | processing | completed | failed
  errorMessage      String?

  // æ—¶é—´å­—æ®µ
  startedAt         DateTime?
  completedAt       DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // å…³è”çš„ç”Ÿæˆç»“æœ
  results           TweetGenerationResult[]

  @@index([username])
  @@index([contentType])
  @@index([status])
  @@index([createdAt])
  @@map("tweet_generation_task")
}

// æ¨æ–‡ç”Ÿæˆç»“æœè¡¨
model TweetGenerationResult {
  id                String   @id @default(cuid())
  taskId            String   // å…³è”ä»»åŠ¡

  // ç”Ÿæˆå†…å®¹
  generatedContent  String   // ç”Ÿæˆçš„æ¨æ–‡å†…å®¹
  contentLength     Int      // å­—ç¬¦æ•°

  // é£æ ¼ä¸€è‡´æ€§è¯„åˆ†
  styleScore        Float?   // AIè‡ªè¯„çš„é£æ ¼åŒ¹é…åº¦ 0-1
  styleAnalysis     String?  // JSON: é£æ ¼åˆ†æè¯´æ˜

  // ä½¿ç”¨çš„é£æ ¼æ•°æ®å¿«ç…§
  styleDataSnapshot String?  // JSON: è®°å½•ä½¿ç”¨äº†å“ªäº›é£æ ¼ç‰¹å¾

  // ç”¨æˆ·åé¦ˆ
  userRating        Int?     // 1-5æ˜Ÿè¯„åˆ†
  userFeedback      String?  // ç”¨æˆ·åé¦ˆæ–‡æœ¬
  isSelected        Boolean  @default(false) // æ˜¯å¦è¢«ç”¨æˆ·é€‰ä¸­ä½¿ç”¨

  // å…ƒæ•°æ®
  aiProvider        String
  aiModel           String
  generatedAt       DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  task              TweetGenerationTask @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([userRating])
  @@index([isSelected])
  @@index([generatedAt])
  @@map("tweet_generation_result")
}
```

#### 1.2 æ•°æ®å…³ç³»å›¾
```
User (@username)
    â”‚
    â”œâ”€â†’ WritingAnalysisTweet (å†å²æ¨æ–‡)
    â”‚       â””â”€â†’ TweetTypeAnnotation (ç±»å‹æ ‡æ³¨)
    â”‚
    â”œâ”€â†’ UserWritingOverview (LLMå†™ä½œæ¦‚è§ˆ)
    â”‚       â””â”€ æ•´ä½“é£æ ¼/å¥å¼/é’©å­ç­–ç•¥
    â”‚
    â””â”€â†’ UserStyleProfile (ç±»å‹åŒ–é£æ ¼æ¡£æ¡ˆ)
            â””â”€ contentTypeç‰¹å®šçš„é£æ ¼ç‰¹å¾

ä»¥ä¸Šæ•°æ® â†’ TweetGenerationTask â†’ TweetGenerationResult
```

---

## ğŸ—ï¸ ç”Ÿæˆæµç¨‹è®¾è®¡

### Phase 1: é£æ ¼æ•°æ®åŠ è½½ (Style Data Loading)

```typescript
interface StyleContext {
  username: string;
  contentType: string;
  writingOverview: {
    personality: string;
    toneCharacteristics: string[];
    typicalOpenings: any;
    typicalDevelopment: any;
    typicalClosings: any;
    highFrequencySentences: any[];
    emotionalExpressions: any[];
    primaryHooks: any[];
    engagementTactics: any[];
    openingHooks: any[];
    sustainingTechniques: any[];
    closingTechniques: any[];
  };
  typeSpecificStyle: {
    signatureWords: any[];
    vocabDiversity: number | null;
    wordComplexity: number | null;
    avgSentenceLength: number | null;
    sentenceTypeDist: any;
    punctuationPattern: any;
    technicalTermUsage: number | null;
    industryKnowledgeLevel: string | null;
    commonOpenings: string[];
    commonClosings: string[];
    avgContentLength: number | null;
    toneFeatures: any;
    sampleCount: number | null;
  };
  exampleTweets: string[];
  typeDefinition: {
    category: string;
    keywords: string[];
    patterns: string[];
    tone: string;
  };
}

async function loadUserStyleData(username: string, contentType: string): Promise<StyleContext> {

  // 1. åŠ è½½LLMé©±åŠ¨çš„å†™ä½œæ¦‚è§ˆ
  const writingOverview = await db.userWritingOverview.findUnique({
    where: { username }
  });

  if (!writingOverview) {
    throw new Error(`ç”¨æˆ· ${username} å°šæœªç”Ÿæˆå†™ä½œæ¦‚è§ˆ,è¯·å…ˆè¿è¡Œé£æ ¼åˆ†æ`);
  }

  const overview = JSON.parse(writingOverview.overviewContent) as UserWritingOverview;


  // 2. åŠ è½½è¯¥å†…å®¹ç±»å‹çš„é£æ ¼æ¡£æ¡ˆ
  const styleProfile = await db.userStyleProfile.findUnique({
    where: {
      username_contentType: { username, contentType }
    }
  });

  if (!styleProfile) {
    throw new Error(`ç”¨æˆ· ${username} å°šæœªç”Ÿæˆ "${contentType}" ç±»å‹çš„é£æ ¼æ¡£æ¡ˆ`);
  }


  // 3. è·å–è¯¥ç±»å‹çš„æ¨æ–‡æ ·æœ¬ (æœ€å¤š10æ¡,ä½œä¸ºFew-shotç¤ºä¾‹)
  const typedTweets = await db.writingAnalysisTweet.findMany({
    where: {
      userUsername: username,
      typeAnnotations: {
        some: {
          tweetTypes: { contains: contentType } // JSONå­—æ®µåŒ…å«è¯¥ç±»å‹
        }
      }
    },
    select: { content: true },
    orderBy: { publishedAt: 'desc' },
    take: 10
  });


  // 4. è·å–è¯¥ç±»å‹çš„é…ç½®ä¿¡æ¯
  const typeConfig = TWEET_TYPES[contentType as TweetType];


  // 5. æ„å»ºé£æ ¼ä¸Šä¸‹æ–‡
  return {
    username,
    contentType,

    // å…¨å±€é£æ ¼ç‰¹å¾
    writingOverview: {
      personality: overview.overallStyle.writingPersonality,
      toneCharacteristics: overview.overallStyle.toneCharacteristics,

      // å…¸å‹ç»“æ„
      typicalOpenings: overview.typicalStructure.openingPatterns,
      typicalDevelopment: overview.typicalStructure.developmentPatterns,
      typicalClosings: overview.typicalStructure.closingPatterns,

      // å…¸å‹å¥å¼
      highFrequencySentences: overview.typicalSentences.highFrequencyPatterns,
      emotionalExpressions: overview.typicalSentences.emotionalExpressions,

      // å¸å¼•åŠ›æœºåˆ¶
      primaryHooks: overview.attractionMechanisms.primaryHooks,
      engagementTactics: overview.attractionMechanisms.engagementTactics,

      // æƒ…ç»ªé’©å­
      openingHooks: overview.emotionalHookStrategies.openingHooks,
      sustainingTechniques: overview.emotionalHookStrategies.sustainingTechniques,
      closingTechniques: overview.emotionalHookStrategies.closingTechniques
    },

    // ç±»å‹ç‰¹å®šé£æ ¼
    typeSpecificStyle: {
      // è¯æ±‡ç‰¹å¾
      signatureWords: styleProfile.signatureWords ? JSON.parse(styleProfile.signatureWords) : [],
      vocabDiversity: styleProfile.vocabDiversity,
      wordComplexity: styleProfile.wordComplexity,

      // å¥å¼ç‰¹å¾
      avgSentenceLength: styleProfile.avgSentenceLength,
      sentenceTypeDist: styleProfile.sentenceTypeDist ? JSON.parse(styleProfile.sentenceTypeDist) : null,
      punctuationPattern: styleProfile.punctuationPattern ? JSON.parse(styleProfile.punctuationPattern) : null,

      // ä¸“ä¸šåº¦
      technicalTermUsage: styleProfile.technicalTermUsage,
      industryKnowledgeLevel: styleProfile.industryKnowledgeLevel,

      // è¯¥ç±»å‹ç‰¹æœ‰çš„å¼€å¤´/ç»“å°¾
      commonOpenings: styleProfile.commonOpenings ? JSON.parse(styleProfile.commonOpenings) : [],
      commonClosings: styleProfile.commonClosings ? JSON.parse(styleProfile.commonClosings) : [],
      avgContentLength: styleProfile.avgContentLength,
      toneFeatures: styleProfile.toneFeatures ? JSON.parse(styleProfile.toneFeatures) : {},

      sampleCount: styleProfile.sampleCount
    },

    // Few-shotç¤ºä¾‹
    exampleTweets: typedTweets.map(t => t.content),

    // ç±»å‹å®šä¹‰
    typeDefinition: {
      category: typeConfig.category,
      keywords: typeConfig.keywords,
      patterns: typeConfig.patterns,
      tone: typeConfig.tone
    }
  };
}
```

### Phase 2: Promptæ„å»º (Prompt Engineering)

```typescript
function buildGenerationPrompt(styleContext: StyleContext, topic?: string, count: number = 3): string {

  const { username, contentType, writingOverview, typeSpecificStyle, exampleTweets, typeDefinition } = styleContext;

  return `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¤¾äº¤åª’ä½“å†…å®¹åˆ›ä½œåŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ¨¡ä»¿ç”¨æˆ·"${username}"çš„å†™ä½œé£æ ¼,ç”Ÿæˆ${count}æ¡"${contentType}"ç±»å‹çš„æ¨æ–‡ã€‚

# ç”¨æˆ·å†™ä½œé£æ ¼æ¡£æ¡ˆ

## æ•´ä½“å†™ä½œäººæ ¼
- **å†™ä½œäººæ ¼**: ${writingOverview.personality}
- **è¯­è°ƒç‰¹å¾**: ${writingOverview.toneCharacteristics.join('ã€')}

## å…¸å‹è¡Œæ–‡ç»“æ„

### å¼€å¤´æ¨¡å¼
- **ä¸»è¦æ¨¡å¼**: ${writingOverview.typicalOpenings.primaryPattern}
- **æè¿°**: ${writingOverview.typicalOpenings.description}
- **å…¸å‹ä¾‹å­**:
${writingOverview.typicalOpenings.examples.map((ex: string, i: number) => `  ${i+1}. "${ex}"`).join('\n')}

### å±•å¼€æ¨¡å¼
- **ä¸»è¦æ¨¡å¼**: ${writingOverview.typicalDevelopment.primaryPattern}
- **æè¿°**: ${writingOverview.typicalDevelopment.description}
- **ç‰¹å¾**: ${writingOverview.typicalDevelopment.characteristics.join('ã€')}

### ç»“å°¾æ¨¡å¼
- **ä¸»è¦æ¨¡å¼**: ${writingOverview.typicalClosings.primaryPattern}
- **æè¿°**: ${writingOverview.typicalClosings.description}

## å…¸å‹å¥å¼æ¨¡æ¿

### é«˜é¢‘å¥å¼
${writingOverview.highFrequencySentences.slice(0, 3).map((pattern: any, i: number) => `
${i+1}. **${pattern.pattern}**
   - ç”¨æ³•: ${pattern.description}
   - åœºæ™¯: ${pattern.context}
   - ä¾‹å­: ${pattern.examples.slice(0, 2).join(' / ')}
`).join('')}

### æƒ…æ„Ÿè¡¨è¾¾æ–¹å¼
${writingOverview.emotionalExpressions.slice(0, 2).map((exp: any, i: number) => `
${i+1}. **${exp.emotion}**
   - è¡¨è¾¾: ${exp.expressions.join('ã€')}
`).join('')}

## å¸å¼•åŠ›æœºåˆ¶

### ä¸»è¦é’©å­ç­–ç•¥
${writingOverview.primaryHooks.slice(0, 2).map((hook: any, i: number) => `
${i+1}. **${hook.type}**
   - å·¥ä½œæœºåˆ¶: ${hook.description}
   - æ•ˆæœ: ${hook.effectiveness}
   - ä¾‹å­: "${hook.examples[0]}"
`).join('')}

### äº’åŠ¨ç­–ç•¥
${writingOverview.engagementTactics.slice(0, 2).map((tactic: any, i: number) => `
${i+1}. **${tactic.tactic}**
   - ${tactic.description}
   - ä½¿ç”¨æ—¶æœº: ${tactic.whenToUse}
`).join('')}

## "${contentType}"ç±»å‹ä¸“å±é£æ ¼

### å†…å®¹ç±»å‹å®šä¹‰
- **ç±»åˆ«**: ${typeDefinition.category}
- **å…¸å‹ç‰¹å¾**: ${typeDefinition.patterns.join('ã€')}
- **è¯­æ°”**: ${typeDefinition.tone}

### è¯¥ç±»å‹çš„è¯æ±‡ç‰¹å¾
- **è¯æ±‡ä¸°å¯Œåº¦**: ${((typeSpecificStyle.vocabDiversity || 0) * 100).toFixed(0)}%
- **å¹³å‡è¯é•¿**: ${(typeSpecificStyle.wordComplexity || 2).toFixed(1)}å­—ç¬¦
- **æ ‡å¿—æ€§è¯æ±‡**: ${typeSpecificStyle.signatureWords.slice(0, 10).map((w: any) => w.word).join('ã€')}

### è¯¥ç±»å‹çš„å¥å¼ç‰¹å¾
- **å¹³å‡å¥é•¿**: ${(typeSpecificStyle.avgSentenceLength || 20).toFixed(0)}å­—
${typeSpecificStyle.sentenceTypeDist ? `
- **å¥å‹åˆ†å¸ƒ**:
  - é™ˆè¿°å¥: ${(typeSpecificStyle.sentenceTypeDist.declarative * 100).toFixed(0)}%
  - ç–‘é—®å¥: ${(typeSpecificStyle.sentenceTypeDist.interrogative * 100).toFixed(0)}%
  - æ„Ÿå¹å¥: ${(typeSpecificStyle.sentenceTypeDist.exclamatory * 100).toFixed(0)}%
` : ''}

### è¯¥ç±»å‹å¸¸ç”¨å¼€å¤´ (ä»ä»¥ä¸‹æ¨¡å¼ä¸­é€‰æ‹©æˆ–ç»„åˆ)
${typeSpecificStyle.commonOpenings.slice(0, 5).map((opening: string, i: number) => `${i+1}. "${opening}"`).join('\n')}

### è¯¥ç±»å‹å¸¸ç”¨ç»“å°¾ (ä»ä»¥ä¸‹æ¨¡å¼ä¸­é€‰æ‹©æˆ–ç»„åˆ)
${typeSpecificStyle.commonClosings.slice(0, 5).map((closing: string, i: number) => `${i+1}. "${closing}"`).join('\n')}

### è¯¥ç±»å‹çš„è¯­æ°”ç‰¹å¾
${Object.entries(typeSpecificStyle.toneFeatures || {})
  .filter(([_, value]) => (value as number) > 0.2)
  .map(([tone, value]) => `- ${tone}: ${((value as number) * 100).toFixed(0)}%`)
  .join('\n')}

### è¯¥ç±»å‹çš„ä¸“ä¸šåº¦
- **æŠ€æœ¯æœ¯è¯­ä½¿ç”¨ç‡**: ${((typeSpecificStyle.technicalTermUsage || 0) * 100).toFixed(0)}%
- **è¡Œä¸šçŸ¥è¯†æ°´å¹³**: ${typeSpecificStyle.industryKnowledgeLevel || 'intermediate'}

### è¯¥ç±»å‹çš„å…¸å‹é•¿åº¦
- **å¹³å‡å­—ç¬¦æ•°**: ${(typeSpecificStyle.avgContentLength || 140).toFixed(0)}å­—ç¬¦

## å®é™…å†™ä½œæ ·æœ¬ (Few-shot Examples)

ä»¥ä¸‹æ˜¯ç”¨æˆ·"${username}"å®é™…å‘å¸ƒçš„"${contentType}"ç±»å‹æ¨æ–‡,ä¾›ä½ å‚è€ƒæ¨¡ä»¿:

${exampleTweets.slice(0, 5).map((tweet: string, i: number) => `
ã€æ ·æœ¬${i+1}ã€‘
${tweet}
`).join('\n---\n')}

---

# ç”Ÿæˆä»»åŠ¡

${topic ? `
## æŒ‡å®šè¯é¢˜
${topic}

è¯·å›´ç»•è¿™ä¸ªè¯é¢˜,ä»¥ç”¨æˆ·çš„é£æ ¼ç”Ÿæˆæ¨æ–‡ã€‚
` : `
## è‡ªç”±åˆ›ä½œ
è¯·åŸºäºç”¨æˆ·çš„å¸¸è§è¯é¢˜å’Œé£æ ¼,ç”Ÿæˆç¬¦åˆ"${contentType}"ç±»å‹ç‰¹å¾çš„æ¨æ–‡ã€‚
`}

## ç”Ÿæˆè¦æ±‚

1. **ä¸¥æ ¼æ¨¡ä»¿é£æ ¼**:
   - å¿…é¡»ä½¿ç”¨ç”¨æˆ·çš„å…¸å‹å¼€å¤´æ¨¡å¼ä¹‹ä¸€
   - å¿…é¡»ä½¿ç”¨ç”¨æˆ·çš„é«˜é¢‘å¥å¼æ¨¡æ¿
   - å¿…é¡»ä½“ç°ç”¨æˆ·çš„è¯­è°ƒç‰¹å¾
   - å†…å®¹é•¿åº¦æ¥è¿‘ç”¨æˆ·è¯¥ç±»å‹çš„å¹³å‡é•¿åº¦

2. **ç¬¦åˆç±»å‹å®šä¹‰**:
   - å†…å®¹å¿…é¡»ç¬¦åˆ"${contentType}"çš„ç±»å‹ç‰¹å¾
   - ä½¿ç”¨è¯¥ç±»å‹çš„å…¸å‹ç»“æ„æ¨¡å¼
   - ä½“ç°è¯¥ç±»å‹çš„è¯­æ°”ç‰¹å¾

3. **ä¿æŒå¸å¼•åŠ›**:
   - ä½¿ç”¨ç”¨æˆ·æœ‰æ•ˆçš„é’©å­ç­–ç•¥
   - å¦‚æœé€‚ç”¨,åŒ…å«äº’åŠ¨å…ƒç´ 
   - ç¡®ä¿å†…å®¹æœ‰ä»·å€¼æˆ–æœ‰è¶£

4. **è‡ªç„¶çœŸå®**:
   - ä¸è¦åˆ»æ„å †ç Œç‰¹å¾
   - ä¿æŒå†…å®¹çš„è‡ªç„¶æµç•…
   - åƒç”¨æˆ·æœ¬äººåœ¨å†™ä½œ

## è¾“å‡ºæ ¼å¼

è¯·ç”Ÿæˆ${count}æ¡æ¨æ–‡,ç”¨JSONæ ¼å¼è¿”å›:

\`\`\`json
{
  "tweets": [
    {
      "content": "æ¨æ–‡å†…å®¹",
      "styleAnalysis": {
        "openingPattern": "ä½¿ç”¨çš„å¼€å¤´æ¨¡å¼",
        "sentencePatterns": ["ä½¿ç”¨çš„å¥å¼æ¨¡æ¿1", "ä½¿ç”¨çš„å¥å¼æ¨¡æ¿2"],
        "hooks": ["ä½¿ç”¨çš„é’©å­ç­–ç•¥1"],
        "styleScore": 0.95,
        "explanation": "ä¸ºä»€ä¹ˆè¿™æ¡æ¨æ–‡ç¬¦åˆç”¨æˆ·é£æ ¼çš„ç®€è¦è¯´æ˜"
      }
    }
  ]
}
\`\`\`

ç°åœ¨è¯·å¼€å§‹ç”Ÿæˆ:`;
}
```

### Phase 3: ç”Ÿæˆæ‰§è¡Œ (Generation Execution)

```typescript
async function generateTweets(
  username: string,
  contentType: string,
  options: {
    topic?: string;
    count?: number;
    aiProvider?: string;
    aiModel?: string;
    temperature?: number;
  } = {}
): Promise<TweetGenerationResult[]> {

  const {
    topic,
    count = 3,
    aiProvider = 'openai',
    aiModel = 'gpt-4o',
    temperature = 0.7
  } = options;


  // 1. åˆ›å»ºä»»åŠ¡è®°å½•
  const task = await db.tweetGenerationTask.create({
    data: {
      username,
      contentType,
      topic: topic || null,
      generateCount: count,
      aiProvider,
      aiModel,
      temperature,
      status: 'processing',
      startedAt: new Date()
    }
  });


  try {
    // 2. åŠ è½½é£æ ¼æ•°æ®
    console.log(`[${task.id}] åŠ è½½ç”¨æˆ· ${username} çš„ "${contentType}" é£æ ¼æ•°æ®...`);
    const styleContext = await loadUserStyleData(username, contentType);


    // 3. æ„å»ºç”Ÿæˆprompt
    console.log(`[${task.id}] æ„å»ºç”Ÿæˆprompt...`);
    const prompt = buildGenerationPrompt(styleContext, topic, count);


    // 4. è°ƒç”¨AIç”Ÿæˆ
    console.log(`[${task.id}] è°ƒç”¨ ${aiProvider}/${aiModel} ç”Ÿæˆæ¨æ–‡...`);
    const config = await WritingAssistantConfigLoader.getAnalysisConfig();
    const aiService = AIServiceFactory.createService({
      provider: aiProvider,
      model: aiModel,
      apiKey: config.apiKey,
      baseURL: config.baseURL
    });

    const rawResult = await aiService.generateText(prompt, { temperature });


    // 5. è§£æç»“æœ
    console.log(`[${task.id}] è§£æç”Ÿæˆç»“æœ...`);
    const cleanResult = rawResult.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
    const parsed = JSON.parse(cleanResult);

    if (!parsed.tweets || !Array.isArray(parsed.tweets)) {
      throw new Error('ç”Ÿæˆç»“æœæ ¼å¼é”™è¯¯');
    }


    // 6. ä¿å­˜ç»“æœ
    console.log(`[${task.id}] ä¿å­˜ç”Ÿæˆç»“æœ...`);
    const results = await Promise.all(
      parsed.tweets.map(async (tweet: any) => {
        return await db.tweetGenerationResult.create({
          data: {
            taskId: task.id,
            generatedContent: tweet.content,
            contentLength: tweet.content.length,
            styleScore: tweet.styleAnalysis?.styleScore || null,
            styleAnalysis: JSON.stringify(tweet.styleAnalysis || {}),
            styleDataSnapshot: JSON.stringify({
              username,
              contentType,
              profileSampleCount: styleContext.typeSpecificStyle.sampleCount,
              usedOpeningPattern: tweet.styleAnalysis?.openingPattern,
              usedSentencePatterns: tweet.styleAnalysis?.sentencePatterns,
              usedHooks: tweet.styleAnalysis?.hooks
            }),
            aiProvider,
            aiModel
          }
        });
      })
    );


    // 7. æ›´æ–°ä»»åŠ¡çŠ¶æ€
    await db.tweetGenerationTask.update({
      where: { id: task.id },
      data: {
        status: 'completed',
        completedAt: new Date()
      }
    });

    console.log(`[${task.id}] âœ… æˆåŠŸç”Ÿæˆ ${results.length} æ¡æ¨æ–‡`);
    return results;

  } catch (error) {
    console.error(`[${task.id}] âŒ ç”Ÿæˆå¤±è´¥:`, error);

    await db.tweetGenerationTask.update({
      where: { id: task.id },
      data: {
        status: 'failed',
        errorMessage: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯',
        completedAt: new Date()
      }
    });

    throw error;
  }
}
```

---

## ğŸ¨ å‰ç«¯ç•Œé¢è®¾è®¡

### é¡µé¢ç»“æ„: `/writing-assistant/tweet-generation`

#### é¡µé¢ä¸»è¦å…ƒç´ :

1. **ç”¨æˆ·é€‰æ‹©åŒºåŸŸ**
   - ä¸‹æ‹‰æ¡†é€‰æ‹©username (ä»WritingAnalysisTweetè¡¨è·å–æ‰€æœ‰å”¯ä¸€username)
   - æ˜¾ç¤ºè¯¥ç”¨æˆ·çš„åŸºæœ¬ç»Ÿè®¡: æ€»æ¨æ–‡æ•°ã€å·²åˆ†æç±»å‹æ•°ã€æœ€ååˆ†ææ—¶é—´

2. **å†…å®¹ç±»å‹é€‰æ‹©åŒºåŸŸ**
   - å•é€‰æ¡†æˆ–ä¸‹æ‹‰æ¡†é€‰æ‹©contentType
   - æ˜¾ç¤ºè¯¥ç±»å‹çš„å®šä¹‰ã€ç‰¹å¾ã€æ ·æœ¬æ•°é‡
   - é¢„è§ˆè¯¥ç”¨æˆ·åœ¨è¿™ä¸ªç±»å‹ä¸‹çš„3-5æ¡å†å²æ¨æ–‡æ ·æœ¬

3. **å¯é€‰å‚æ•°åŒºåŸŸ**
   - è¯é¢˜è¾“å…¥æ¡† (å¯é€‰)
   - ç”Ÿæˆæ•°é‡ (1-5æ¡, é»˜è®¤3æ¡)
   - é•¿åº¦åå¥½ (auto/short/medium/long)

4. **é£æ ¼é¢„è§ˆåŒºåŸŸ**
   - æ˜¾ç¤ºè¯¥ç”¨æˆ·åœ¨è¯¥ç±»å‹ä¸‹çš„é£æ ¼ç‰¹å¾æ‘˜è¦:
     * å¸¸ç”¨å¼€å¤´: å‰3ä¸ª
     * å¹³å‡å¥é•¿
     * é«˜é¢‘è¯æ±‡
     * è¯­æ°”ç‰¹å¾

5. **ç”Ÿæˆå†å²åŒºåŸŸ**
   - æ˜¾ç¤ºæœ€è¿‘çš„ç”Ÿæˆä»»åŠ¡
   - æ¯ä¸ªä»»åŠ¡æ˜¾ç¤º: usernameã€ç±»å‹ã€ç”Ÿæˆæ—¶é—´ã€ç”Ÿæˆæ•°é‡
   - ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„æ¨æ–‡å’Œé£æ ¼åˆ†æ

6. **ç”Ÿæˆç»“æœå±•ç¤ºåŒºåŸŸ**
   - ä»¥å¡ç‰‡å½¢å¼å±•ç¤ºæ¯æ¡ç”Ÿæˆçš„æ¨æ–‡
   - æ¯ä¸ªå¡ç‰‡æ˜¾ç¤º:
     * æ¨æ–‡å†…å®¹
     * é£æ ¼åŒ¹é…åº¦è¯„åˆ†
     * ä½¿ç”¨çš„å¼€å¤´æ¨¡å¼
     * ä½¿ç”¨çš„å¥å¼æ¨¡æ¿
     * æ“ä½œæŒ‰é’®: å¤åˆ¶ã€è¯„åˆ†ã€åé¦ˆ

### ç•Œé¢ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨æ–‡ç”Ÿæˆ (Tweet Generation)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  [1] é€‰æ‹©ç”¨æˆ·                                                â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚      â”‚ @testuser â–¼                        â”‚                 â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚      ğŸ“Š å…±1250æ¡æ¨æ–‡ | å·²åˆ†æ12ç§ç±»å‹ | æœ€ååˆ†æ: 2å¤©å‰     â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [2] é€‰æ‹©å†…å®¹ç±»å‹                                            â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚      â”‚ ç§‘æ™®     â”‚ â”‚ æ•™ç¨‹/æŠ€å·§â”‚ â”‚ æ´è§/è§‚ç‚¹â”‚  ...           â”‚
â”‚      â”‚ (245æ¡)  â”‚ â”‚ (183æ¡)  â”‚ â”‚ (327æ¡)  â”‚                â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â”‚      ğŸ’¡ ç±»å‹å®šä¹‰: å†…å®¹å¯¼å‘ç±» - è§£é‡Šæ¦‚å¿µã€é˜è¿°åŸç†            â”‚
â”‚      ğŸ“ å…¸å‹æ¨¡å¼: é—®é¢˜+è§£é‡Šã€æ¦‚å¿µ+é˜è¿°                       â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [3] é£æ ¼é¢„è§ˆ                                                â”‚
â”‚      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“    â”‚
â”‚      â”ƒ å¸¸ç”¨å¼€å¤´: "ä½ çŸ¥é“å—"ã€"å¾ˆå¤šäººä¸çŸ¥é“"ã€"ç§‘æ™®ä¸€ä¸‹"     â”‚
â”‚      â”ƒ å¹³å‡å¥é•¿: 23å­—                                   â”ƒ    â”‚
â”‚      â”ƒ é«˜é¢‘è¯æ±‡: æ•°æ®ã€ç ”ç©¶ã€åˆ†æã€å‘ç°ã€æ˜¾ç¤º                â”ƒ    â”‚
â”‚      â”ƒ è¯­æ°”ç‰¹å¾: å®¢è§‚(72%)ã€ä¸¥è°¨(58%)ã€ä¸“ä¸š(65%)           â”ƒ    â”‚
â”‚      â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›    â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [4] ç”Ÿæˆå‚æ•° (å¯é€‰)                                         â”‚
â”‚      è¯é¢˜: [____________________] (é€‰å¡«)                     â”‚
â”‚      ç”Ÿæˆæ•°é‡: [3 â–¼]    é•¿åº¦: [è‡ªåŠ¨ â–¼]                      â”‚
â”‚                                                              â”‚
â”‚      [ğŸš€ å¼€å§‹ç”Ÿæˆ]                                           â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [5] ç”Ÿæˆç»“æœ                                                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ¨æ–‡ #1                        é£æ ¼åŒ¹é…: 94% â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ ä½ çŸ¥é“å—,AIæ¨¡å‹çš„è®­ç»ƒå…¶å®æ˜¯ä¸€ä¸ª...             â”‚            â”‚
â”‚  â”‚                                               â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ âœ“ å¼€å¤´: "ä½ çŸ¥é“å—" (å¸¸ç”¨æ¨¡å¼1)                â”‚            â”‚
â”‚  â”‚ âœ“ å¥å¼: ç–‘é—®å¼•å…¥+ä¸“ä¸šè§£é‡Š                     â”‚            â”‚
â”‚  â”‚ âœ“ é’©å­: çŸ¥è¯†ç¼ºå£                             â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ [ğŸ“‹ å¤åˆ¶] [â­ è¯„åˆ†] [ğŸ’¬ åé¦ˆ]                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ¨æ–‡ #2                        é£æ ¼åŒ¹é…: 91% â”‚            â”‚
â”‚  â”‚ ...                                          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ APIè·¯ç”±è®¾è®¡

### tRPC Router: `tweetGenerationRouter`

```typescript
export const tweetGenerationRouter = createTRPCRouter({

  // è·å–å¯ç”¨çš„ç”¨æˆ·åˆ—è¡¨
  getAvailableUsers: publicProcedure
    .query(async () => {
      const users = await db.writingAnalysisTweet.groupBy({
        by: ['userUsername'],
        _count: { id: true },
        orderBy: { _count: { id: 'desc' } }
      });

      return users.map(u => ({
        username: u.userUsername,
        tweetCount: u._count.id
      }));
    }),


  // è·å–ç”¨æˆ·åœ¨å„ç±»å‹ä¸‹çš„æ ·æœ¬æ•°é‡
  getUserTypeStats: publicProcedure
    .input(z.object({ username: z.string() }))
    .query(async ({ input }) => {
      const profiles = await db.userStyleProfile.findMany({
        where: { username: input.username },
        select: {
          contentType: true,
          sampleCount: true,
          lastAnalyzedAt: true
        }
      });

      return {
        username: input.username,
        types: profiles.map(p => ({
          contentType: p.contentType,
          sampleCount: p.sampleCount,
          lastAnalyzed: p.lastAnalyzedAt
        }))
      };
    }),


  // é¢„è§ˆç”¨æˆ·åœ¨ç‰¹å®šç±»å‹ä¸‹çš„é£æ ¼ç‰¹å¾
  previewUserStyle: publicProcedure
    .input(z.object({
      username: z.string(),
      contentType: z.string()
    }))
    .query(async ({ input }) => {
      const styleContext = await loadUserStyleData(
        input.username,
        input.contentType
      );

      return {
        username: input.username,
        contentType: input.contentType,
        preview: {
          commonOpenings: styleContext.typeSpecificStyle.commonOpenings.slice(0, 3),
          avgSentenceLength: styleContext.typeSpecificStyle.avgSentenceLength,
          signatureWords: styleContext.typeSpecificStyle.signatureWords.slice(0, 10),
          toneFeatures: styleContext.typeSpecificStyle.toneFeatures,
          sampleCount: styleContext.typeSpecificStyle.sampleCount,
          exampleTweets: styleContext.exampleTweets.slice(0, 3)
        }
      };
    }),


  // åˆ›å»ºç”Ÿæˆä»»åŠ¡
  createGenerationTask: publicProcedure
    .input(z.object({
      username: z.string().min(1),
      contentType: z.string().min(1),
      topic: z.string().optional(),
      generateCount: z.number().int().min(1).max(5).default(3),
      lengthPreference: z.enum(['auto', 'short', 'medium', 'long']).default('auto'),
      aiProvider: z.string().default('openai'),
      aiModel: z.string().default('gpt-4o'),
      temperature: z.number().min(0).max(1).default(0.7)
    }))
    .mutation(async ({ input }) => {
      // å¼‚æ­¥æ‰§è¡Œç”Ÿæˆ
      generateTweets(input.username, input.contentType, {
        topic: input.topic,
        count: input.generateCount,
        aiProvider: input.aiProvider,
        aiModel: input.aiModel,
        temperature: input.temperature
      }).catch(console.error);

      return { success: true, message: 'ç”Ÿæˆä»»åŠ¡å·²åˆ›å»º' };
    }),


  // è·å–ç”Ÿæˆå†å²
  getGenerationHistory: publicProcedure
    .input(z.object({
      username: z.string().optional(),
      limit: z.number().int().min(1).max(50).default(20),
      offset: z.number().int().min(0).default(0)
    }))
    .query(async ({ input }) => {
      const tasks = await db.tweetGenerationTask.findMany({
        where: input.username ? { username: input.username } : undefined,
        include: {
          results: {
            select: {
              id: true,
              generatedContent: true,
              styleScore: true,
              userRating: true
            }
          }
        },
        orderBy: { createdAt: 'desc' },
        take: input.limit,
        skip: input.offset
      });

      return { tasks };
    }),


  // æäº¤ç”¨æˆ·åé¦ˆ
  submitFeedback: publicProcedure
    .input(z.object({
      resultId: z.string(),
      rating: z.number().int().min(1).max(5),
      feedback: z.string().optional()
    }))
    .mutation(async ({ input }) => {
      await db.tweetGenerationResult.update({
        where: { id: input.resultId },
        data: {
          userRating: input.rating,
          userFeedback: input.feedback
        }
      });

      return { success: true };
    })
});
```

---

## âœ… å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥: æ•°æ®åº“è¿ç§»
1. åœ¨`prisma/schema.prisma`ä¸­æ·»åŠ `TweetGenerationTask`å’Œ`TweetGenerationResult`è¡¨å®šä¹‰
2. è¿è¡ŒPrismaè¿ç§»: `npx prisma migrate dev --name add_tweet_generation`
3. éªŒè¯æ•°æ®åº“è¡¨ç»“æ„æ­£ç¡®åˆ›å»º

### ç¬¬äºŒæ­¥: åç«¯æœåŠ¡å®ç°
1. åˆ›å»º`src/server/services/tweet-generation.ts`
   - å®ç°`loadUserStyleData()`å‡½æ•°
   - å®ç°`buildGenerationPrompt()`å‡½æ•°
   - å®ç°`generateTweets()`å‡½æ•°
2. åˆ›å»º`src/server/api/routers/tweet-generation.ts`
   - å®ç°æ‰€æœ‰tRPCè·¯ç”±endpoint
3. åœ¨`src/server/api/root.ts`ä¸­æ³¨å†Œæ–°è·¯ç”±

### ç¬¬ä¸‰æ­¥: å‰ç«¯é¡µé¢å¼€å‘
1. åˆ›å»º`src/app/writing-assistant/tweet-generation/page.tsx`
2. å®ç°ç”¨æˆ·é€‰æ‹©ç»„ä»¶
3. å®ç°å†…å®¹ç±»å‹é€‰æ‹©ç»„ä»¶
4. å®ç°é£æ ¼é¢„è§ˆç»„ä»¶
5. å®ç°ç”Ÿæˆç»“æœå±•ç¤ºç»„ä»¶
6. é›†æˆtRPC APIè°ƒç”¨
7. æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

### ç¬¬å››æ­¥: å¯¼èˆªå’Œé›†æˆ
1. åœ¨`src/components/navigation.tsx`ä¸­æ·»åŠ æ–°é¡µé¢å…¥å£
2. æ›´æ–°APIæ–‡æ¡£é¡µé¢,æ·»åŠ æ–°çš„endpointè¯´æ˜
3. æ·»åŠ ç”¨æˆ·å¼•å¯¼å’Œå¸®åŠ©æ–‡æ¡£

### ç¬¬äº”æ­¥: æµ‹è¯•å’Œä¼˜åŒ–
1. ä½¿ç”¨ç°æœ‰ç”¨æˆ·æ•°æ®è¿›è¡Œç”Ÿæˆæµ‹è¯•
2. è¯„ä¼°ç”Ÿæˆè´¨é‡å’Œé£æ ¼ä¸€è‡´æ€§
3. æ”¶é›†ç”¨æˆ·åé¦ˆå¹¶è®°å½•
4. æ ¹æ®åé¦ˆè°ƒæ•´promptç­–ç•¥
5. ä¼˜åŒ–ç”Ÿæˆé€Ÿåº¦å’ŒæˆåŠŸç‡
6. å®Œå–„UI/UXä½“éªŒ

---

## ğŸ¯ æ–¹æ¡ˆä¼˜åŠ¿

### 1. **é›¶é…ç½®ä¸ªæ€§åŒ–**
ç”¨æˆ·åªéœ€è¾“å…¥usernameå’Œç±»å‹,ç³»ç»Ÿè‡ªåŠ¨åº”ç”¨æ‰€æœ‰å·²åˆ†æçš„é£æ ¼æ•°æ®,æ— éœ€æ‰‹åŠ¨é…ç½®ä»»ä½•å‚æ•°ã€‚

### 2. **å¤šå±‚æ¬¡é£æ ¼èåˆ**
- **UserWritingOverview**æä¾›æ•´ä½“é£æ ¼æ¡†æ¶(äººæ ¼ã€è¯­è°ƒã€ç»“æ„)
- **UserStyleProfile**æä¾›ç±»å‹ç‰¹å®šç»†èŠ‚(è¯æ±‡ã€å¥å¼ã€ä¸“ä¸šåº¦)
- **å†å²æ¨æ–‡æ ·æœ¬**æä¾›Few-shotç¤ºä¾‹
- ä¸‰è€…ç»“åˆç¡®ä¿é«˜åº¦é£æ ¼ä¸€è‡´æ€§

### 3. **å¯è§£é‡Šæ€§å¼º**
æ¯æ¡ç”Ÿæˆçš„æ¨æ–‡éƒ½é™„å¸¦è¯¦ç»†çš„é£æ ¼åˆ†æ:
- ä½¿ç”¨çš„å¼€å¤´æ¨¡å¼
- ä½¿ç”¨çš„å¥å¼æ¨¡æ¿
- ä½¿ç”¨çš„é’©å­ç­–ç•¥
- é£æ ¼åŒ¹é…åº¦è¯„åˆ†(0-1)
- ç”Ÿæˆç†ç”±è¯´æ˜

### 4. **æŒç»­æ”¹è¿›æœºåˆ¶**
- ç”¨æˆ·åé¦ˆæ•°æ®æŒç»­ç§¯ç´¯
- å¯ä»¥åŸºäºåé¦ˆæ•°æ®åˆ†æå¸¸è§é—®é¢˜
- æ”¯æŒpromptç­–ç•¥çš„è¿­ä»£ä¼˜åŒ–
- é£æ ¼åˆ†ææ•°æ®å®šæœŸæ›´æ–°åŒæ­¥

### 5. **ä¸ç°æœ‰ç³»ç»Ÿæ— ç¼é›†æˆ**
- å®Œå…¨åˆ©ç”¨å·²æœ‰çš„åˆ†ææ•°æ®å’Œè¡¨ç»“æ„
- ä¸éœ€è¦é¢å¤–çš„è®­ç»ƒæˆ–æ¨¡å‹å¾®è°ƒ
- éµå¾ªç°æœ‰çš„AIé…ç½®ç®¡ç†ä½“ç³»
- å¤ç”¨ç°æœ‰çš„æœåŠ¡å’Œå·¥å…·å‡½æ•°

### 6. **ç±»å‹ç³»ç»Ÿå®Œæ•´**
- æ”¯æŒTWEET_TYPESä¸­å®šä¹‰çš„æ‰€æœ‰ç±»å‹
- æ¯ä¸ªç±»å‹éƒ½æœ‰æ˜ç¡®çš„ç‰¹å¾å®šä¹‰
- ç±»å‹åŒ–çš„é£æ ¼æ¡£æ¡ˆç¡®ä¿ç”Ÿæˆå‡†ç¡®æ€§

### 7. **çµæ´»çš„æ‰©å±•æ€§**
- å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„ç”Ÿæˆå‚æ•°
- æ”¯æŒè‡ªå®šä¹‰è¯é¢˜å’Œé•¿åº¦åå¥½
- å¯ä»¥è°ƒæ•´AIæ¨¡å‹å’Œæ¸©åº¦å‚æ•°
- ä¾¿äºæœªæ¥æ·»åŠ æ›´å¤šé£æ ¼ç»´åº¦

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### å…¸å‹ä½¿ç”¨åœºæ™¯

```
ç”¨æˆ·æ“ä½œ:
1. é€‰æ‹©ç”¨æˆ·: @testuser
2. é€‰æ‹©ç±»å‹: "ç§‘æ™®"
3. (å¯é€‰) è¾“å…¥è¯é¢˜: "ç¥ç»ç½‘ç»œ"
4. ç‚¹å‡»ç”Ÿæˆ

ç³»ç»Ÿå¤„ç†:
1. åŠ è½½@testuserçš„å†™ä½œæ¦‚è§ˆ
2. åŠ è½½"ç§‘æ™®"ç±»å‹çš„245æ¡æ ·æœ¬åˆ†æ
3. æå–å¸¸ç”¨å¼€å¤´ã€å¥å¼ã€é’©å­ç­–ç•¥
4. ç”Ÿæˆ3æ¡æ¨æ–‡

ç”Ÿæˆç»“æœ:
æ¨æ–‡1: "ä½ çŸ¥é“å—,ç¥ç»ç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹å…¶å®å°±åƒ..." (é£æ ¼åŒ¹é…94%)
æ¨æ–‡2: "ç§‘æ™®ä¸€ä¸‹,ä¸ºä»€ä¹ˆç¥ç»ç½‘ç»œéœ€è¦æ¿€æ´»å‡½æ•°..." (é£æ ¼åŒ¹é…91%)
æ¨æ–‡3: "å¾ˆå¤šäººä¸çŸ¥é“,å…¶å®æ·±åº¦å­¦ä¹ å’Œä¼ ç»Ÿæœºå™¨å­¦ä¹ ..." (é£æ ¼åŒ¹é…93%)
```

### è´¨é‡ä¿è¯

1. **é£æ ¼ä¸€è‡´æ€§**: é€šè¿‡å¤šå±‚æ¬¡é£æ ¼æ•°æ®èåˆ,ç¡®ä¿ç”Ÿæˆå†…å®¹ä¸ç”¨æˆ·å†å²æ¨æ–‡é«˜åº¦ä¸€è‡´
2. **ç±»å‹å‡†ç¡®æ€§**: åŸºäºç±»å‹å®šä¹‰å’Œæ ·æœ¬åˆ†æ,ç¡®ä¿å†…å®¹ç¬¦åˆé€‰å®šç±»å‹çš„ç‰¹å¾
3. **å†…å®¹è´¨é‡**: åˆ©ç”¨ç”¨æˆ·æœ‰æ•ˆçš„å¸å¼•åŠ›æœºåˆ¶å’Œé’©å­ç­–ç•¥,ç¡®ä¿å†…å®¹æœ‰å¸å¼•åŠ›
4. **å¯æ§æ€§**: æ”¯æŒè¯é¢˜æŒ‡å®šå’Œå‚æ•°è°ƒæ•´,æ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚

---

## ğŸš€ æ€»ç»“

è¿™ä¸ªæ–¹æ¡ˆå®ç°äº†çœŸæ­£çš„**"åˆ†æé©±åŠ¨ç”Ÿæˆ"**,é€šè¿‡å……åˆ†åˆ©ç”¨å·²æœ‰çš„å†™ä½œåˆ†ææ•°æ®,è®©æ¯ä¸ªç”¨æˆ·éƒ½èƒ½æ‹¥æœ‰è‡ªå·±ä¸“å±çš„AIå†™ä½œåŠ©æ‰‹ã€‚

æ ¸å¿ƒä»·å€¼:
- âœ… **ä¸ªæ€§åŒ–**: æ¯ä¸ªç”¨æˆ·ç”Ÿæˆçš„å†…å®¹éƒ½ç¬¦åˆå…¶ç‹¬ç‰¹é£æ ¼
- âœ… **ç²¾å‡†æ€§**: åŸºäºå¤§é‡æ ·æœ¬åˆ†æ,ç¡®ä¿é£æ ¼ç‰¹å¾å‡†ç¡®
- âœ… **æ˜“ç”¨æ€§**: åªéœ€ä¸¤ä¸ªå‚æ•°(username + ç±»å‹)å³å¯ç”Ÿæˆ
- âœ… **å¯æ‰©å±•**: éšç€åˆ†ææ•°æ®å¢åŠ ,ç”Ÿæˆè´¨é‡æŒç»­æå‡
- âœ… **å¯æ§æ€§**: æ”¯æŒè¯é¢˜ã€æ•°é‡ã€é•¿åº¦ç­‰å‚æ•°è‡ªå®šä¹‰

ç³»ç»Ÿå·²ç»å®Œæˆäº†æ•°æ®æ”¶é›†å’Œåˆ†æçš„åŸºç¡€å»ºè®¾,ç°åœ¨æ˜¯æ—¶å€™è®©è¿™äº›æ•°æ®çœŸæ­£å‘æŒ¥ä»·å€¼,ä¸ºç”¨æˆ·æä¾›å®ç”¨çš„å†…å®¹ç”ŸæˆæœåŠ¡! ğŸ‰