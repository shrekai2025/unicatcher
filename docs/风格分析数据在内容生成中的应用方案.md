# é£æ ¼åˆ†ææ•°æ®åœ¨å†…å®¹ç”Ÿæˆä¸­çš„åº”ç”¨æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°†ç”¨æˆ·å†™ä½œé£æ ¼åˆ†ææ•°æ®åº”ç”¨åˆ°ä¸ªæ€§åŒ–å†…å®¹ç”Ÿæˆæµç¨‹ä¸­ï¼Œå®ç°çœŸæ­£çš„"ä»¥ç”¨æˆ·é£æ ¼ç”Ÿæˆå†…å®¹"ã€‚

## ğŸ¯ æ ¸å¿ƒæ€è·¯

å½“å‰ç³»ç»Ÿæœ‰ä¸‰ä¸ªå…³é”®ç¯èŠ‚ï¼š
1. **é£æ ¼åˆ†æ** â†’ æå–ç”¨æˆ·å†™ä½œç‰¹å¾
2. **å†…å®¹ç”Ÿæˆ** â†’ åŸºäºä¸»é¢˜ç”Ÿæˆæ–‡ç« 
3. **ä¸ªæ€§åŒ–æ³¨å…¥** â†’ å°†é£æ ¼ç‰¹å¾æ³¨å…¥åˆ°ç”Ÿæˆè¿‡ç¨‹

## ğŸ“Š å¯ç”¨çš„é£æ ¼æ•°æ®åŠå…¶åº”ç”¨åœºæ™¯

### 1. åŸºç¡€é£æ ¼ç‰¹å¾ï¼ˆå·²å®ç°ï¼‰

#### 1.1 è¯æ±‡ç‰¹å¾
```typescript
{
  vocabDiversity: 0.65,        // è¯æ±‡å¤šæ ·æ€§
  wordComplexity: 0.42,        // è¯æ±‡å¤æ‚åº¦
  signatureWords: ["AI", "æŠ€æœ¯", "åˆ›æ–°", ...]  // ç­¾åè¯æ±‡
}
```

**åº”ç”¨æ–¹å¼ï¼š**
```typescript
// åœ¨å¤§çº²ç”Ÿæˆé˜¶æ®µæ³¨å…¥
const outlinePrompt = `
è¯·ç”Ÿæˆå…³äº"${topic}"çš„å¤§çº²ã€‚

ç”¨æˆ·å†™ä½œé£æ ¼ç‰¹å¾ï¼š
- è¯æ±‡å¤šæ ·æ€§ï¼š${profile.vocabDiversity > 0.6 ? 'é«˜' : 'ä¸­ç­‰'}ï¼Œè¯·ä½¿ç”¨${profile.vocabDiversity > 0.6 ? 'ä¸°å¯Œå¤šæ ·çš„' : 'ç®€æ´æ˜äº†çš„'}è¯æ±‡
- è¯æ±‡å¤æ‚åº¦ï¼š${profile.wordComplexity > 0.5 ? 'é«˜' : 'ä½'}ï¼Œè¯·ä½¿ç”¨${profile.wordComplexity > 0.5 ? 'ä¸“ä¸šæœ¯è¯­å’Œé•¿è¯' : 'ç®€å•æ˜“æ‡‚çš„è¯æ±‡'}
- å¸¸ç”¨è¯æ±‡ï¼š${profile.signatureWords.slice(0, 5).join('ã€')}ï¼Œè¯·åœ¨åˆé€‚çš„åœ°æ–¹ä½¿ç”¨è¿™äº›è¯æ±‡

å¤§çº²è¦æ±‚ï¼š
- ç¬¦åˆç”¨æˆ·çš„è¯æ±‡ä½¿ç”¨ä¹ æƒ¯
- ä¿æŒä¸“ä¸šåº¦å’Œå¯è¯»æ€§çš„å¹³è¡¡
`;
```

#### 1.2 å¥å­ç‰¹å¾
```typescript
{
  avgSentenceLength: 25.5,     // å¹³å‡å¥é•¿
  sentenceTypeDist: {          // å¥å‹åˆ†å¸ƒ
    declarative: 0.7,          // é™ˆè¿°å¥70%
    interrogative: 0.15,       // ç–‘é—®å¥15%
    exclamatory: 0.10,        // æ„Ÿå¹å¥10%
    imperative: 0.05          // ç¥ˆä½¿å¥5%
  }
}
```

**åº”ç”¨æ–¹å¼ï¼š**
```typescript
const writingGuidelines = `
å¥å­é£æ ¼è¦æ±‚ï¼š
- å¹³å‡å¥é•¿ï¼š${profile.avgSentenceLength}å­—å·¦å³
- å¥å‹åˆ†å¸ƒï¼š
  * é™ˆè¿°å¥å ${(profile.sentenceTypeDist.declarative * 100).toFixed(0)}%
  * ç–‘é—®å¥å ${(profile.sentenceTypeDist.interrogative * 100).toFixed(0)}%
  * æ„Ÿå¹å¥å ${(profile.sentenceTypeDist.exclamatory * 100).toFixed(0)}%
  ${profile.sentenceTypeDist.interrogative > 0.2 ? '\n  * å¤šä½¿ç”¨ç–‘é—®å¥ä¸è¯»è€…äº’åŠ¨' : ''}
  ${profile.sentenceTypeDist.exclamatory > 0.15 ? '\n  * é€‚å½“ä½¿ç”¨æ„Ÿå¹å¥å¢å¼ºæ„ŸæŸ“åŠ›' : ''}
`;
```

#### 1.3 ä¸“ä¸šåº¦ç‰¹å¾
```typescript
{
  technicalTermUsage: 0.35,           // ä¸“ä¸šæœ¯è¯­ä½¿ç”¨ç‡
  industryKnowledgeLevel: 'expert'    // è¡Œä¸šçŸ¥è¯†æ°´å¹³
}
```

**åº”ç”¨æ–¹å¼ï¼š**
```typescript
const expertiseLevel = profile.industryKnowledgeLevel;
const technicalDensity = profile.technicalTermUsage;

const styleInstruction = `
ä¸“ä¸šåº¦è¦æ±‚ï¼š
- çŸ¥è¯†æ°´å¹³ï¼š${expertiseLevel === 'expert' ? 'ä¸“å®¶çº§ï¼Œå¯ä»¥æ·±å…¥æŠ€æœ¯ç»†èŠ‚' :
              expertiseLevel === 'intermediate' ? 'ä¸­çº§ï¼Œéœ€è¦å¹³è¡¡ä¸“ä¸šæ€§å’Œæ˜“æ‡‚æ€§' :
              'å…¥é—¨çº§ï¼Œä½¿ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€'}
- ä¸“ä¸šæœ¯è¯­å¯†åº¦ï¼š${(technicalDensity * 100).toFixed(0)}%
${technicalDensity > 0.3 ? '- å¯ä»¥ä½¿ç”¨è¾ƒå¤šä¸“ä¸šæœ¯è¯­ï¼Œä½†éœ€è¦é€‚å½“è§£é‡Š' : ''}
${technicalDensity < 0.15 ? '- å°½é‡ä½¿ç”¨é€šä¿—è¯­è¨€ï¼Œå°‘ç”¨ä¸“ä¸šæœ¯è¯­' : ''}
`;
```

#### 1.4 ç±»å‹åŒ–é£æ ¼ï¼ˆæŒ‰æ¨æ–‡ç±»å‹ï¼‰
```typescript
{
  contentType: "ç§‘æ™®",
  commonOpenings: ["ä½ çŸ¥é“å—", "æœ€è¿‘å‘ç°", "å¾ˆå¤šäººä¸çŸ¥é“"],
  commonClosings: ["å¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©", "æ¬¢è¿è®¨è®º"],
  avgContentLength: 280,
  toneFeatures: {
    formal: 0.6,
    casual: 0.4,
    humorous: 0.2
  }
}
```

**åº”ç”¨æ–¹å¼ï¼š**
```typescript
// æ ¹æ®å†…å®¹ç±»å‹åŠ è½½å¯¹åº”é£æ ¼æ¡£æ¡ˆ
const typeProfile = await getStyleProfileByType(username, contentType);

const structureGuide = `
å†…å®¹ç±»å‹ï¼š${contentType}

å¼€å¤´é£æ ¼ï¼ˆä»ç”¨æˆ·å¸¸ç”¨æ¨¡å¼ä¸­é€‰æ‹©ï¼‰ï¼š
${typeProfile.commonOpenings.map((pattern, i) => `${i+1}. ${pattern}`).join('\n')}

ç»“å°¾é£æ ¼ï¼ˆä»ç”¨æˆ·å¸¸ç”¨æ¨¡å¼ä¸­é€‰æ‹©ï¼‰ï¼š
${typeProfile.commonClosings.map((pattern, i) => `${i+1}. ${pattern}`).join('\n')}

è¯­æ°”ç‰¹å¾ï¼š
- æ­£å¼åº¦ï¼š${(typeProfile.toneFeatures.formal * 100).toFixed(0)}%
- éšæ„åº¦ï¼š${(typeProfile.toneFeatures.casual * 100).toFixed(0)}%
- å¹½é»˜åº¦ï¼š${(typeProfile.toneFeatures.humorous * 100).toFixed(0)}%

å†…å®¹é•¿åº¦ï¼šçº¦${typeProfile.avgContentLength}å­—
`;
```

### 2. è¿›é˜¶é£æ ¼ç‰¹å¾ï¼ˆå¾…å®ç°ï¼‰

#### 2.1 å¼€å¤´æ¨¡å¼ï¼ˆå¾…å®ç°ï¼‰
```typescript
{
  questionHook: 0.3,      // 30%ä½¿ç”¨ç–‘é—®å¼€å¤´
  dataHook: 0.25,         // 25%ä½¿ç”¨æ•°æ®å¼€å¤´
  storyHook: 0.2,         // 20%ä½¿ç”¨æ•…äº‹å¼€å¤´
  statementHook: 0.15,    // 15%ä½¿ç”¨é™ˆè¿°å¼€å¤´
  contrastHook: 0.1       // 10%ä½¿ç”¨å¯¹æ¯”å¼€å¤´
}
```

**åº”ç”¨æ–¹å¼ï¼š**
```typescript
// æ ¹æ®ç”¨æˆ·æœ€å¸¸ç”¨çš„å¼€å¤´æ¨¡å¼ç”Ÿæˆ
const openingStyle = getTopOpeningPattern(profile.openingPatterns);

const openingInstruction = `
å¼€å¤´ç­–ç•¥ï¼ˆåŸºäºç”¨æˆ·ä¹ æƒ¯ï¼‰ï¼š
${openingStyle === 'questionHook' ? `
- ä½¿ç”¨ç–‘é—®å¥å¼€å¤´ï¼Œå¼•å‘è¯»è€…æ€è€ƒ
- ç¤ºä¾‹ï¼š"ä½ çŸ¥é“...å—ï¼Ÿ"ã€"ä¸ºä»€ä¹ˆ...ï¼Ÿ"
` : ''}
${openingStyle === 'dataHook' ? `
- ä½¿ç”¨æ•°æ®æˆ–ç ”ç©¶å¼€å¤´ï¼Œå»ºç«‹æƒå¨æ€§
- ç¤ºä¾‹ï¼š"æ•°æ®æ˜¾ç¤º..."ã€"ç ”ç©¶è¡¨æ˜..."
` : ''}
${openingStyle === 'storyHook' ? `
- ä½¿ç”¨ä¸ªäººæ•…äº‹æˆ–æ¡ˆä¾‹å¼€å¤´ï¼Œå¢å¼ºå…±é¸£
- ç¤ºä¾‹ï¼š"æ˜¨å¤©é‡åˆ°..."ã€"æœ€è¿‘å‘ç°..."
` : ''}
`;
```

#### 2.2 å¸å¼•åŠ›å› ç´ ï¼ˆå¾…å®ç°ï¼‰
```typescript
{
  noveltyScore: 0.7,          // æ–°é¢–æ€§
  controversyScore: 0.3,      // äº‰è®®æ€§
  practicalityScore: 0.8,     // å®ç”¨æ€§
  emotionalResonance: 0.6     // æƒ…æ„Ÿå…±é¸£
}
```

**åº”ç”¨æ–¹å¼ï¼š**
```typescript
const attractionGuide = `
å†…å®¹å¸å¼•åŠ›ä¼˜åŒ–æ–¹å‘ï¼ˆåŸºäºç”¨æˆ·æˆåŠŸæ¨¡å¼ï¼‰ï¼š

${profile.noveltyScore > 0.6 ? `
âœ“ æ–°é¢–æ€§ï¼ˆé«˜ï¼‰ï¼š
  - ä»‹ç»æ–°æ¦‚å¿µã€æ–°å‘ç°ã€æ–°æ•°æ®
  - ä½¿ç”¨"é¦–æ¬¡"ã€"æœ€æ–°"ã€"çªç ´"ç­‰è¯æ±‡
` : ''}

${profile.practicalityScore > 0.7 ? `
âœ“ å®ç”¨æ€§ï¼ˆé«˜ï¼‰ï¼š
  - æä¾›å…·ä½“æ–¹æ³•ã€æ­¥éª¤ã€å·¥å…·
  - ä½¿ç”¨"å¦‚ä½•"ã€"æŠ€å·§"ã€"æ”»ç•¥"ç­‰è¯æ±‡
` : ''}

${profile.emotionalResonance > 0.5 ? `
âœ“ æƒ…æ„Ÿå…±é¸£ï¼ˆé«˜ï¼‰ï¼š
  - ä½¿ç”¨ç¬¬ä¸€äººç§°"æˆ‘è§‰å¾—"ã€"æˆ‘å‘ç°"
  - åˆ†äº«ä¸ªäººæ„Ÿå—å’Œä½“ä¼š
` : ''}

${profile.controversyScore > 0.4 ? `
âœ“ äº‰è®®æ€§ï¼ˆä¸­é«˜ï¼‰ï¼š
  - æå‡ºä¸åŒè§‚ç‚¹æˆ–è´¨ç–‘
  - ä½¿ç”¨"ä½†æ˜¯"ã€"ç„¶è€Œ"ã€"è´¨ç–‘"ç­‰è¯æ±‡
` : ''}
`;
```

#### 2.3 æƒ…ç»ªé’©å­ï¼ˆå¾…å®ç°ï¼‰
```typescript
{
  openingHooks: {
    curiosityGap: { effectiveness: 0.8, examples: [...] },
    personalStory: { effectiveness: 0.7, examples: [...] },
    dataShock: { effectiveness: 0.6, examples: [...] }
  },
  closingHooks: {
    callToAction: 0.5,       // "ä½ æ€ä¹ˆçœ‹ï¼Ÿ"
    thoughtProvoking: 0.3    // "è¿™è®©æˆ‘ä»¬æ€è€ƒ..."
  }
}
```

**åº”ç”¨æ–¹å¼ï¼š**
```typescript
// é€‰æ‹©ç”¨æˆ·æœ€æœ‰æ•ˆçš„é’©å­ç±»å‹
const topHook = getTopEffectiveHook(profile.openingHooks);

const hookInstruction = `
æƒ…ç»ªé’©å­è®¾è®¡ï¼ˆåŸºäºç”¨æˆ·é«˜æ•ˆæ¨¡å¼ï¼‰ï¼š

å¼€å¤´é’©å­ï¼šä½¿ç”¨${topHook.type}
ç¤ºä¾‹ï¼š${topHook.examples.slice(0, 3).join('\n')}

ç»“å°¾é’©å­ï¼š
${profile.closingHooks.callToAction > 0.4 ? '- ä»¥è¡ŒåŠ¨å·å¬ç»“å°¾ï¼Œå¦‚"ä½ æ€ä¹ˆçœ‹ï¼Ÿ"' : ''}
${profile.closingHooks.thoughtProvoking > 0.3 ? '- ä»¥å¼•å‘æ€è€ƒç»“å°¾ï¼Œå¦‚"è¿™è®©æˆ‘ä»¬åæ€..."' : ''}
`;
```

## ğŸ—ï¸ å®ç°æ¶æ„

### é˜¶æ®µ1ï¼šæ‰©å±• generateOutline å‡½æ•°

```typescript
async function generateOutline(task: any): Promise<string> {
  // 1. åŠ è½½ç”¨æˆ·é£æ ¼æ¡£æ¡ˆ
  let styleProfile = null;
  let styleInstructions = '';

  if (task.username && task.contentType) {
    styleProfile = await db.userStyleProfile.findUnique({
      where: {
        username_contentType: {
          username: task.username,
          contentType: task.contentType
        }
      }
    });

    if (styleProfile) {
      styleInstructions = buildStyleInstructions(styleProfile);
    }
  }

  // 2. æ„å»ºå¤§çº²ç”Ÿæˆæç¤ºè¯
  const prompt = `
è¯·ä¸ºä»¥ä¸‹ä¸»é¢˜ç”Ÿæˆæ–‡ç« å¤§çº²ï¼š

ä¸»é¢˜ï¼š${task.topic}
å¹³å°ï¼š${task.platform.name}
å†…å®¹ç±»å‹ï¼š${task.contentType || 'é€šç”¨'}

${styleInstructions}

è¦æ±‚ï¼š
1. å¤§çº²åº”åŒ…å«3-5ä¸ªä¸»è¦éƒ¨åˆ†
2. æ¯ä¸ªéƒ¨åˆ†æœ‰æ˜ç¡®çš„å°æ ‡é¢˜å’Œè¦ç‚¹
3. æ•´ä½“é€»è¾‘è¿è´¯ï¼Œç¬¦åˆç”¨æˆ·å†™ä½œé£æ ¼
`;

  // 3. è°ƒç”¨AIç”Ÿæˆ
  const aiService = AIServiceFactory.createService({...});
  const outline = await aiService.generateText(prompt);

  return outline;
}

// æ„å»ºé£æ ¼æŒ‡ä»¤
function buildStyleInstructions(profile: UserStyleProfile): string {
  const instructions: string[] = [];

  // è¯æ±‡ç‰¹å¾
  if (profile.vocabDiversity) {
    instructions.push(`
è¯æ±‡ä½¿ç”¨ï¼š
- è¯æ±‡å¤šæ ·æ€§ï¼š${profile.vocabDiversity > 0.6 ? 'ä¸°å¯Œå¤šæ ·' : 'ç®€æ´æ˜äº†'}
- è¯æ±‡å¤æ‚åº¦ï¼š${profile.wordComplexity > 0.5 ? 'ä½¿ç”¨ä¸“ä¸šæœ¯è¯­' : 'ä½¿ç”¨é€šä¿—è¯­è¨€'}
${profile.signatureWords ? `- å¸¸ç”¨è¯æ±‡ï¼š${JSON.parse(profile.signatureWords).slice(0, 5).join('ã€')}` : ''}
`);
  }

  // å¥å­ç‰¹å¾
  if (profile.avgSentenceLength) {
    instructions.push(`
å¥å­é£æ ¼ï¼š
- å¹³å‡å¥é•¿ï¼š${profile.avgSentenceLength.toFixed(0)}å­—
${profile.sentenceTypeDist ? `- å¥å‹åˆ†å¸ƒï¼š${formatSentenceTypeDist(profile.sentenceTypeDist)}` : ''}
`);
  }

  // ä¸“ä¸šåº¦
  if (profile.technicalTermUsage !== null) {
    instructions.push(`
ä¸“ä¸šåº¦ï¼š
- çŸ¥è¯†æ°´å¹³ï¼š${profile.industryKnowledgeLevel || 'intermediate'}
- ä¸“ä¸šæœ¯è¯­ä½¿ç”¨ç‡ï¼š${(profile.technicalTermUsage * 100).toFixed(0)}%
`);
  }

  // å¼€å¤´ç»“å°¾æ¨¡å¼
  if (profile.commonOpenings) {
    const openings = JSON.parse(profile.commonOpenings);
    instructions.push(`
å¼€å¤´æ¨¡å¼ï¼ˆä»ä¸­é€‰æ‹©ï¼‰ï¼š
${openings.slice(0, 3).map((p: string, i: number) => `${i+1}. ${p}`).join('\n')}
`);
  }

  if (profile.commonClosings) {
    const closings = JSON.parse(profile.commonClosings);
    instructions.push(`
ç»“å°¾æ¨¡å¼ï¼ˆä»ä¸­é€‰æ‹©ï¼‰ï¼š
${closings.slice(0, 3).map((p: string, i: number) => `${i+1}. ${p}`).join('\n')}
`);
  }

  // è¯­æ°”ç‰¹å¾
  if (profile.toneFeatures) {
    const tone = JSON.parse(profile.toneFeatures);
    instructions.push(`
è¯­æ°”ç‰¹å¾ï¼š
${Object.entries(tone).map(([key, value]) =>
  `- ${key}: ${((value as number) * 100).toFixed(0)}%`
).join('\n')}
`);
  }

  return instructions.length > 0
    ? `\nç”¨æˆ·å†™ä½œé£æ ¼ç‰¹å¾ï¼š\n${instructions.join('\n')}`
    : '';
}
```

### é˜¶æ®µ2ï¼šæ‰©å±• generateContent å‡½æ•°

```typescript
async function generateContent(task: any, outline: string): Promise<string> {
  // 1. åŠ è½½ç”¨æˆ·é£æ ¼æ¡£æ¡ˆ
  let styleProfile = null;
  if (task.username && task.contentType) {
    styleProfile = await db.userStyleProfile.findUnique({
      where: {
        username_contentType: {
          username: task.username,
          contentType: task.contentType
        }
      }
    });
  }

  // 2. æ„å»ºè¯¦ç»†çš„é£æ ¼æŒ‡ä»¤
  const styleGuide = styleProfile
    ? buildDetailedStyleGuide(styleProfile)
    : '';

  const prompt = `
åŸºäºä»¥ä¸‹å¤§çº²ï¼Œæ’°å†™å®Œæ•´æ–‡ç« ï¼š

${outline}

${styleGuide}

å†™ä½œè¦æ±‚ï¼š
1. ä¸¥æ ¼æŒ‰ç…§é£æ ¼æŒ‡ä»¤æ’°å†™
2. ä¿æŒå†…å®¹çš„è¿è´¯æ€§å’Œé€»è¾‘æ€§
3. æ¯ä¸ªéƒ¨åˆ†éƒ½è¦å……å®é¥±æ»¡
4. æ•´ä½“ç¬¦åˆç”¨æˆ·çš„å†™ä½œä¹ æƒ¯
`;

  const aiService = AIServiceFactory.createService({...});
  const content = await aiService.generateText(prompt);

  return content;
}

function buildDetailedStyleGuide(profile: UserStyleProfile): string {
  return `
========== ç”¨æˆ·å†™ä½œé£æ ¼æŒ‡å— ==========

ã€è¯æ±‡å±‚é¢ã€‘
${profile.vocabDiversity ? `- è¯æ±‡ä¸°å¯Œåº¦ï¼š${(profile.vocabDiversity * 100).toFixed(0)}%` : ''}
${profile.wordComplexity ? `- è¯æ±‡å¤æ‚åº¦ï¼š${(profile.wordComplexity * 100).toFixed(0)}%` : ''}
${profile.signatureWords ? `- æ ‡å¿—æ€§è¯æ±‡ï¼š${JSON.parse(profile.signatureWords).slice(0, 10).join('ã€')}` : ''}

ã€å¥å­å±‚é¢ã€‘
${profile.avgSentenceLength ? `- å¹³å‡å¥é•¿ï¼š${profile.avgSentenceLength.toFixed(0)}å­—` : ''}
${profile.sentenceTypeDist ? `- å¥å‹åˆ†å¸ƒï¼š${formatSentenceTypeDist(profile.sentenceTypeDist)}` : ''}

ã€å†…å®¹ç»„ç»‡ã€‘
${profile.commonOpenings ? `- å¸¸ç”¨å¼€å¤´ï¼š${JSON.parse(profile.commonOpenings).slice(0, 3).join('ï¼›')}` : ''}
${profile.commonClosings ? `- å¸¸ç”¨ç»“å°¾ï¼š${JSON.parse(profile.commonClosings).slice(0, 3).join('ï¼›')}` : ''}
${profile.avgContentLength ? `- å…¸å‹é•¿åº¦ï¼šçº¦${profile.avgContentLength.toFixed(0)}å­—` : ''}

ã€ä¸“ä¸šåº¦ã€‘
- ä¸“ä¸šæ°´å¹³ï¼š${profile.industryKnowledgeLevel || 'ä¸­çº§'}
${profile.technicalTermUsage ? `- æœ¯è¯­å¯†åº¦ï¼š${(profile.technicalTermUsage * 100).toFixed(0)}%` : ''}

ã€è¯­æ°”é£æ ¼ã€‘
${profile.toneFeatures ? formatToneFeatures(profile.toneFeatures) : ''}

=====================================

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸Šé£æ ¼æŒ‡å—æ’°å†™å†…å®¹ï¼
`;
}
```

### é˜¶æ®µ3ï¼šä¼˜åŒ–å’Œåé¦ˆå¾ªç¯

```typescript
async function refineContent(
  task: any,
  content: string,
  feedback: string
): Promise<string> {
  // è·å–ç”¨æˆ·é£æ ¼æ¡£æ¡ˆ
  const styleProfile = await db.userStyleProfile.findUnique({
    where: {
      username_contentType: {
        username: task.username,
        contentType: task.contentType
      }
    }
  });

  const styleReminder = styleProfile
    ? `\næ³¨æ„ï¼šä¿®æ”¹æ—¶ä»éœ€ä¿æŒç”¨æˆ·çš„å†™ä½œé£æ ¼ï¼š\n${buildStyleInstructions(styleProfile)}`
    : '';

  const prompt = `
åŸæ–‡ï¼š
${content}

åé¦ˆæ„è§ï¼š
${feedback}

${styleReminder}

è¯·æ ¹æ®åé¦ˆæ„è§ä¼˜åŒ–æ–‡ç« ï¼ŒåŒæ—¶ä¿æŒç”¨æˆ·çš„å†™ä½œé£æ ¼ç‰¹å¾ã€‚
`;

  const aiService = AIServiceFactory.createService({...});
  const refinedContent = await aiService.generateText(prompt);

  return refinedContent;
}
```

## ğŸ¨ å‰ç«¯ç•Œé¢å¢å¼º

åœ¨å†…å®¹ç”Ÿæˆé¡µé¢æ·»åŠ ç”¨æˆ·é€‰æ‹©ï¼š

```typescript
// æ·»åŠ ç”¨æˆ·åé€‰æ‹©
const [selectedUsername, setSelectedUsername] = useState<string>('');

// æŸ¥è¯¢å¯ç”¨ç”¨æˆ·åˆ—è¡¨
const { data: availableUsers } = api.styleProfiles.getUsernames.useQuery();

// æ ¹æ®é€‰ä¸­ç”¨æˆ·å’Œå†…å®¹ç±»å‹ï¼Œæ˜¾ç¤ºé£æ ¼é¢„è§ˆ
const { data: stylePreview } = api.styleProfiles.getByUsername.useQuery(
  { username: selectedUsername },
  { enabled: !!selectedUsername }
);

// åœ¨è¡¨å•ä¸­æ·»åŠ 
<select value={selectedUsername} onChange={(e) => setSelectedUsername(e.target.value)}>
  <option value="">ä¸ä½¿ç”¨ä¸ªæ€§åŒ–é£æ ¼</option>
  {availableUsers?.data?.users.map(user => (
    <option key={user.username} value={user.username}>
      @{user.username} ({user.profileCount}ä¸ªé£æ ¼æ¡£æ¡ˆ)
    </option>
  ))}
</select>

// æ˜¾ç¤ºé£æ ¼é¢„è§ˆ
{stylePreview && (
  <div className="é£æ ¼é¢„è§ˆå¡ç‰‡">
    <h3>é£æ ¼ç‰¹å¾é¢„è§ˆ</h3>
    <ul>
      <li>è¯æ±‡å¤šæ ·æ€§ï¼š{(stylePreview.vocabDiversity * 100).toFixed(0)}%</li>
      <li>å¹³å‡å¥é•¿ï¼š{stylePreview.avgSentenceLength}å­—</li>
      <li>ä¸“ä¸šåº¦ï¼š{stylePreview.industryKnowledgeLevel}</li>
      ...
    </ul>
  </div>
)}
```

## ğŸ“ˆ æ•ˆæœé¢„æœŸ

å®æ–½åï¼Œç³»ç»Ÿå°†èƒ½å¤Ÿï¼š

1. âœ… **çœŸæ­£çš„ä¸ªæ€§åŒ–**ï¼šç”Ÿæˆçš„å†…å®¹ä¸ä»…ç¬¦åˆä¸»é¢˜ï¼Œè¿˜ç¬¦åˆç”¨æˆ·çš„å†™ä½œä¹ æƒ¯
2. âœ… **é£æ ¼ä¸€è‡´æ€§**ï¼šå¤šæ¬¡ç”Ÿæˆçš„å†…å®¹ä¿æŒä¸€è‡´çš„é£æ ¼
3. âœ… **å¯æ§æ€§**ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨æˆ–ä¸ä½¿ç”¨ä¸ªæ€§åŒ–é£æ ¼
4. âœ… **å¯æ‰©å±•æ€§**ï¼šéšç€åˆ†æç»´åº¦å¢åŠ ï¼ˆå¼€å¤´æ¨¡å¼ã€é’©å­ç­‰ï¼‰ï¼Œç”Ÿæˆè´¨é‡æŒç»­æå‡

## ğŸš€ å®æ–½æ­¥éª¤

1. **ç¬¬ä¸€æ­¥**ï¼šä¿®æ”¹ `generateOutline` å‡½æ•°ï¼Œæ³¨å…¥åŸºç¡€é£æ ¼æŒ‡ä»¤ï¼ˆè¯æ±‡ã€å¥å­ã€ä¸“ä¸šåº¦ï¼‰
2. **ç¬¬äºŒæ­¥**ï¼šä¿®æ”¹ `generateContent` å‡½æ•°ï¼Œæ³¨å…¥è¯¦ç»†é£æ ¼æŒ‡å—
3. **ç¬¬ä¸‰æ­¥**ï¼šä¿®æ”¹å‰ç«¯ç•Œé¢ï¼Œæ·»åŠ ç”¨æˆ·é€‰æ‹©å’Œé£æ ¼é¢„è§ˆ
4. **ç¬¬å››æ­¥**ï¼šå®æ–½è¿›é˜¶é£æ ¼åˆ†æï¼ˆå¼€å¤´æ¨¡å¼ã€é’©å­ç­‰ï¼‰
5. **ç¬¬äº”æ­¥**ï¼šæŒç»­ä¼˜åŒ–æç¤ºè¯å’Œé£æ ¼æ³¨å…¥ç­–ç•¥

è¦å¼€å§‹å®æ–½å—ï¼Ÿ