(function(g){var window=this;'use strict';var nQ=function(k){this.K=k},NBX=function(k,a,y,q){q=q===void 0?[]:q;
a={offlineOrchestrationContext:pGK(k,a,y,q)};a=PeG(3,a);nUT(JS9(),a,k.rootActionId)},oU0=function(k,a){var y,q,e,f,H,B,Z,z,Y;
return g.Q(function(r){switch(r.K){case 1:return y=a.entityKey,e=(q=g.v(a.actionMetadata,JK))==null?void 0:q.isEnqueuedForExpiredStreamUrlRefetch,g.p8(r,2),f=void 0,g.p(r,um1(k,a),4);case 4:f=r.D;g.p8(r,5);var W=(W=g.v(a.actionMetadata,JK))?{maximumDownloadQuality:W.maximumDownloadQuality}:void 0;return g.p(r,vUK(y,k.B,{isEnqueuedForExpiredStreamUrlRefetch:e,bQ:W,offlineSourceData:f}),7);case 7:H=r.D;g.St(r,6,2);break;case 5:return g.vh(r,2),B=Nw(a)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",u1("PDE handleAdd error"),r.return(vc(a,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",B,"DOWNLOAD_STATE_FAILED"));case 6:return g.p(r,F32(k,H,a),8);case 8:return r.return(vc(a,!0,H.orchestrationActions));case 2:return Z=g.vh(r),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.HG&&Z.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u1("PDE handleAdd error"),r.return(vc(a,!1,void 0,z,Y,"DOWNLOAD_STATE_FAILED"))}})},Ce9=function(k,a){var y,q,e,f,H,B,Z,z,Y;
return g.Q(function(r){if(r.K==1)return y=g.j5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.p(r,Fh(k,y,"musicDownloadsLibraryEntity"),2);(q=r.D)||(q={id:y});e=g.Yx(a).entityType;e==="musicTrack"?(f=q.downloadedTracks)!=null&&f.includes(a)||(q.downloadedTracks=((H=q.downloadedTracks)!=null?H:[]).concat(a)):e==="musicPlaylist"?(B=q.downloadedPlaylists)!=null&&B.includes(a)||(q.downloadedPlaylists=((Z=q.downloadedPlaylists)!=null?Z:[]).concat(a)):e!=="musicAlbumRelease"||(z=q.downloadedAlbumReleases)!=
null&&z.includes(a)||(q.downloadedAlbumReleases=((Y=q.downloadedAlbumReleases)!=null?Y:[]).concat(a));return g.p(r,oS(k,q,"musicDownloadsLibraryEntity"),0)})},CQ=function(k,a,y,q){y=y===void 0?!1:y;
q=q===void 0?!0:q;a=typeof a==="string"?a:a.videoDetails.videoId;if(g.bz(a)===2){var e=hA9(k,a);e&&e.stopVideo();g.uz(a,2);k.j=2;y?MmV(k.K):q&&XG9(k.K)}},cSa=function(){hK.apply(this,arguments)},L39=function(k,a){var y,q;
return g.Q(function(e){if(e.K==1)return g.p(e,g.g2(),2);if(e.K!=3){y=e.D;if(!y)throw g.sQ("wct");return g.p(e,g.Al(y),3)}q=e.D;return g.p(e,g.n8(q,["captions"],{mode:"readwrite",TE:!0},function(f){var H=[];f=f.objectStore("captions");for(var B=0;B<a.length;B++){var Z=g.Jl(f,a[B],k+"|"+a[B].metadata.vss_id);H.push(Z)}return g.NY.all(H)}),0)})},tmG=function(k,a){var y,q;
return g.Q(function(e){switch(e.K){case 1:return y=Nw(a),g.p(e,Fh(k.K,a.entityKey,"transfer"),2);case 2:q=e.D;if(!q||q.transferState!=="TRANSFER_STATE_COMPLETE")return e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.p8(e,3);return g.p(e,IAX(k,a,!0),5);case 5:g.St(e,4);break;case 3:return g.vh(e),e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},EUr=function(){nQ.apply(this,arguments)},K39=function(){hK.apply(this,arguments)},Mw=function(k,a,y,q,e,f){this.status=k;
this.K=a;this.L=y;this.D=q;this.j=e;this.downloadState=f},k_r=function(k,a,y){this.K=k;
this.B=a;this.j=y},aD9=function(k,a,y,q){if(k&&k.streamsProgress){q=k;
a:{a=a.itag+";"+a.xtags;for(var e=k.streamsProgress,f=0;f<e.length;f++){var H=JSON.parse(e[f].formatStreamBytes);if(H.itag+";"+H.xtags===a){e[f]=y;y=e;break a}}e.push(y);y=e}q.streamsProgress=y}else k={key:q,streamsProgress:[y]};return k},ym9=function(){hK.apply(this,arguments)},qST=function(k,a){var y,q,e,f,H,B;
return g.Q(function(Z){switch(Z.K){case 1:y=new Map,q=g.A(a),e=q.next();case 2:if(e.done){Z.X5(4);break}f=e.value;H=y;B=H.set;return g.p(Z,k.D(f),5);case 5:B.call(H,f,Z.D);e=q.next();Z.X5(2);break;case 4:return Z.return(y)}})},ew1=function(){hK.apply(this,arguments)},fDT=function(k){var a;
return g.Q(function(y){if(y.K==1)return g.p(y,g.mw4(k),2);a=y.D;return y.return(a.filter(function(q){return!!q.url}).map(function(q){return q.url}))})},$hX=function(){hK.apply(this,arguments)},HTd=function(){hK.apply(this,arguments)},dhd=function(){hK.apply(this,arguments)},zwG=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l;
return g.Q(function(P){switch(P.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey),e=q.entityId,g.p(P,Fh(k.K,a.entityKey,"mainVideoEntity"),2);case 2:f=P.D;if(!f){H=void 0;P.X5(3);break}return g.p(P,Fh(k.K,f.downloadState,"mainVideoDownloadStateEntity"),4);case 4:H=P.D;case 3:B=H;if(!f||!B)return P.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.p8(P,5);return g.p(P,BkT(k,e,B.addedTimestampMillis,(z=g.v(a.actionMetadata,Xh))==null?void 0:z.offlineVideoData),7);case 7:Y=1;Y=Number(((r=
a.actionMetadata)==null?void 0:r.priority)||0)+1;Z=cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e,"playbackData",Y,ZT9);g.St(P,6);break;case 5:W=g.vh(P);if(!(W instanceof Error&&W.message==="No data")){if(W instanceof Error&&W.message==="Empty response body")u1(W.message);else return m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.HG&&W.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,m,T));P.X5(6);break}return g.p(P,LQ(k.K,e),9);case 9:O=P.D;x=g.v(a.actionMetadata,Xh);if(l=(V=x)==null?void 0:V.playlistId)O.playlistId=l;O.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.p(P,IS(e,k.K,a,k.j,O),6);case 6:return P.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Z?[Z]:void 0))}})},YS2=function(k,a){this.K=k;
this.B=a},rmG=function(){hK.apply(this,arguments)},jsd=function(){nQ.apply(this,arguments)},iT9=function(){hK.apply(this,arguments)},WKT=function(k,a,y){this.K=k;
this.B=a;this.j=y},mhT=function(k){k=(new TextEncoder).encode(k).subarray(0,16);
var a=new Uint8Array(16);a.set(k);return a},TkT=function(){hK.apply(this,arguments)},SSX=function(){this.locks=navigator.locks},Uh0=function(){hK.apply(this,arguments)},IAX=function(k,a,y){y=y===void 0?!1:y;
var q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V;return g.Q(function(l){switch(l.K){case 1:return q=g.v(a.actionMetadata,Dh9),e=g.Yx(a.entityKey).entityId,f=g.j5(e,"downloadStatusEntity"),g.p(l,tK(k.K,{mode:"readonly",TE:!0},function(P){var N=EL(P,f,"downloadStatusEntity");P=EL(P,g.j5(e,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.NY.all([N,P])}),2);
case 2:return H=l.D,B=g.A(H),Z=B.next().value,z=B.next().value,Y=Z,r=z,W="TRANSFER_STATE_TRANSFER_IN_QUEUE",((m=Y)==null?void 0:m.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(W="TRANSFER_STATE_PAUSED_BY_USER"),x={key:a.entityKey,transferState:W,cotn:g.fv(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(T=q)==null?void 0:T.maximumDownloadQuality,preferredAudioTrack:(O=q)==null?void 0:O.preferredAudioTrack,transferRetryCount:0,isRefresh:y,hasLoggedFirstStarted:!1},g.p(l,tK(k.K,
{mode:"readwrite",TE:!0},function(P){var N=[];y&&N.push(KQ(P,g.j5(e,"offlineVideoStreams")));N.push(kM(P,x,"transfer"));return g.NY.all(N)}),3);
case 3:if(!y){l.X5(4);break}return g.p(l,OT2(e),4);case 4:Qsr({videoId:e,yI:x,offlineModeType:(V=r)==null?void 0:V.offlineModeType}),g.wg(l)}})},BkT=function(k,a,y,q,e){var f,H,B,Z,z,Y;
return g.Q(function(r){switch(r.K){case 1:if(f=q){r.X5(2);break}return g.p(r,war([a]),3);case 3:H=r.D,f=H[0];case 2:return g.p(r,xh2(k,f,y,e),4);case 4:B=r.D;Z=B.mainVideoEntity;z=B.channelEntity;g.p8(r,5);var W=aj(Z.thumbnail),m=aj(z.avatar);return g.p(r,yZ(W.concat(m)),7);case 7:g.St(r,0);break;case 5:Y=g.vh(r),Y instanceof Error&&Y.message==="Failed to fetch"&&u1(Y.message),g.wg(r)}})},Rw9=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},G_9=function(){hK.apply(this,arguments)},gP9=function(k,a,y,q){var e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N;
return g.Q(function(F){switch(F.K){case 1:e=Date.now().toString();y||(y=e);f=a.videos;H=a.playlistId;B=[];Z=[];if(f)for(z=g.A(f),Y=z.next();!Y.done;Y=z.next()){r=Y.value;W=r.offlineVideoData;if(!W||!W.videoId)throw u1("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");m=W.videoId;T={videoId:m,playlistId:H};O={id:g.j5(JSON.stringify(T),"mainPlaylistVideoEntity"),video:g.j5(m,"mainVideoEntity")};B.push(O);Z.push(O.id)}V={key:g.j5(H,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:y,lastSyncedTimestampMillis:e};l={key:g.j5(H,"mainPlaylistEntity"),playlistId:H,videos:Z,title:a.title,thumbnailStyleData:lD9(a),visibility:VQd(a),downloadState:V.key};a.channel&&(P=a.channel.offlineChannelData,x=bTT(g.j5(H,"ytMainChannelEntity"),P),l.channelOwner=x.id);((N=l)==null?0:N.entityMetadata)?(l.entityMetadata.offlineLastModifiedTimestampSeconds=a.lastModifiedTimestamp,q&&(l.entityMetadata.nextAutoRefreshIntervalSeconds=String(q))):l&&(l.entityMetadata={nextAutoRefreshIntervalSeconds:q?
String(q):void 0,offlineLastModifiedTimestampSeconds:a.lastModifiedTimestamp});g.p8(F,2);return g.p(F,tK(k.K,{mode:"readwrite",TE:!0},function(t){var M=kM(t,l,"mainPlaylistEntity"),ea=kM(t,V,"mainPlaylistDownloadStateEntity");M=[M,ea];ea=g.A(B);for(var Zl=ea.next();!Zl.done;Zl=ea.next())M.push(kM(t,Zl.value,"mainPlaylistVideoEntity"));x&&M.push(kM(t,x,"ytMainChannelEntity"));return g.NY.all(M)}),4);
case 4:g.St(F,3);break;case 2:throw g.vh(F),u1("PES failure for playlist"),Error("PES failure for playlist");case 3:return F.return({mainPlaylistEntity:l,W8e:x,zWq:B})}})},PO1=function(k,a,y){var q=ssV(a);
return Am1(k,q).then(function(){return paG(k,a,y)})},oP0=function(k,a){var y,q,e,f,H,B;
return g.Q(function(Z){switch(Z.K){case 1:if(k.V)return Z.return();k.V=!0;k.K=a;y=g.Yx(k.K.key);q=y.entityId;e=void 0;if(k.K.transferState==="TRANSFER_STATE_TRANSFERRING")return g.p(Z,qP(k,q),7);if(k.K.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||k.K.transferRetryCount||k.K.hasLoggedFirstStarted){Z.X5(3);break}return g.p(Z,qP(k,q),5);case 5:return e=Z.D,k.K.hasLoggedFirstStarted=!0,g.p(Z,nP9(k),6);case 6:Jm9({videoId:q,yI:k.K,offlineModeType:e},void 0,void 0,!0);Z.X5(3);break;case 7:e=Z.D,
e4({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:q,yI:k.K,offlineModeType:e});case 3:return g.p(Z,Nkr(k),8);case 8:return f=null,g.p8(Z,9),g.p(Z,uwG(k,a),11);case 11:f=Z.D;k.X=f;g.St(Z,10);break;case 9:return H=g.vh(Z),u1("error getting player response",H,a.cotn),g.p(Z,k.B5("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return Z.return();case 10:return B=vP0(k.api.Z(),a.cotn,f),g.p(Z,FKV(k,B),13);case 13:return g.p(Z,fDT(B.videoId),
14);case 14:B.qh=Z.D;var z=k.G,Y=B,r=a.maximumDownloadQuality;Y.getPlayerResponse();g.uz(Y.videoId,2);z.j=2;z.D=!1;var W;(W=z.player)==null||W.dispose();z.player=z.api.aW(Y);Y={};z.player.OF((Y.localmediachange=z.y6,Y.signatureexpired=z.KP,Y.statechange=z.GEs,Y),z);z.W("html5_generate_content_po_token")&&z.player.Vk();r=z.xE(r);z.player.Nx(g.EB(r,r,!0,"m"),!1);z.player.kR(!1);k.L.start(108E5);g.wg(Z)}})},CO0=function(k){var a=new g.Hk("und",new g.ho("Default","und",!0));
a.captionTracks=k.captionTracks;return a},Xar=function(k){return g.Q(function(a){if(a.K==1)a=g.p(a,hwT(),2);
else{var y=k.JG;var q=g.mo();q=Object.keys(q);y=MQT(y,q);a=g.p(a,y,0)}return a})},cm2=function(){hK.apply(this,arguments)},LK9=function(k){if(k==null?0:k.streamsProgress){var a=0;
k=k.streamsProgress;for(var y=0;y<k.length;y++){var q=k[y];isNaN(Number(q.numBytesDownloaded))?u1("stream progress bytes number invalid"):a+=Number(q.numBytesDownloaded)}return a}return 0},IDX=function(){hK.apply(this,arguments)},tQr=function(){hK.apply(this,arguments)},kjG=function(k,a){var y,q,e,f,H,B,Z,z,Y,r;
return g.Q(function(W){switch(W.K){case 1:return y=Nw(a),g.p8(W,2),q=g.Yx(a.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.p(W,EPV(k.K,a,k.j,(Y=a.actionMetadata)==null?void 0:(r=Y.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.p(W,LQ(k.K,q),6);case 6:e=W.D;f=g.v(a.actionMetadata,Xh);if(B=(H=f)==null?void 0:H.playlistId)e.playlistId=B;e.offlineDeleteReason=(Z=a.actionMetadata)==null?void 0:(z=Z.offlineLoggingData)==null?void 0:z.offlineDeleteReason;return g.p(W,IS(q,k.K,a,k.j,e),7);
case 7:if(!k.B.W("woffle_enable_main_downloads_library")){W.X5(5);break}return g.p(W,KK1(k.K,a.entityKey),5);case 5:g.St(W,3);break;case 2:return g.vh(W),W.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},aiG=function(){hK.apply(this,arguments)},yMr=function(){hK.apply(this,
arguments)},q49=function(k){var a=g.mo();
a=Object.assign({},a);k=Object.assign({},k);for(var y in a)k[y]?(a[y]!==4&&(a[y]=k[y]),delete k[y]):a[y]!==2&&(a[y]=4);Object.assign(a,k);g.rsZ(a);JSON.stringify(a);return a},ei1=function(){hK.apply(this,arguments)},fi9=function(){hK.apply(this,arguments)},Hjr=function(k,a,y){if(y.has(a))return g.NY.resolve(void 0);
y.add(a);return $SV(k,a).then(function(q){return k.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(a)).then(function(){return q})}).then(function(q){var e=g.NY.resolve(void 0);
q=g.A(q);for(var f=q.next(),H={};!f.done;H={Tw:void 0},f=q.next())H.Tw=f.value,e=e.then(function(B){return function(){return Hjr(k,B.Tw,y)}}(H));
return e}).then(function(){})},fa=function(k,a){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!=="TRANSFER_STATE_FAILED"){var y=g.Yx(k.key).entityId;
e4({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:y,yI:k,offlineModeType:a})}},ZjX=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V;
return g.Q(function(l){switch(l.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey),e=q.entityId,f=[],g.p8(l,2),g.p(l,dS1(k,e),4);case 4:f=l.D;if((H=f)==null||!H.length){l.X5(5);break}return g.p(l,Ce9(k.K,a.entityKey),5);case 5:g.St(l,3);break;case 2:return B=g.vh(l),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.HG&&B.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Z,z));case 3:return Y=[],g.p(l,BN2(k.K,"musicTrack",f),7);case 7:f=l.D;if(f.length)for(r=g.A(f),W=r.next();!W.done;W=r.next())if(m=W.value,T=m.offlineVideoData,O=void 0,(O=T)==null?0:O.videoId)x=void 0,V=Number(((x=a.actionMetadata)==null?void 0:x.priority)||0)+1,Y.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",V,$M,Hu(a,T,e)));return l.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Y))}})},
ziV=function(){nQ.apply(this,arguments)},Y4V=function(){hK.apply(this,arguments)},zy=function(k,a,y,q,e){var f,H,B;
return g.Q(function(Z){if(Z.K==1)return g.p(Z,dA(),2);f=Z.D;if(!f)return Z.return([]);H=a.map(function(z){var Y=g.j5(z,y);Y={actionType:q,entityKey:Y,actionMetadata:Object.assign({},rMK(),e)};q!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(Y.actionMetadata.priority=0);z=new Bu(y,z,Y);return Zd(z)});
B=jKK(f,H);ijV(k.j);return Z.return(B)})},Wfr=function(){hK.apply(this,arguments)},TNV=function(k,a){var y,q;
return g.Q(function(e){switch(e.K){case 1:return y=Nw(a),g.p8(e,2),q=g.Yx(a.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.p(e,YM(k.K,a,k.j),5):g.p(e,rA(q,k.K,a,k.j),6);case 6:return g.p(e,mS9(k.K,a.entityKey),5);case 5:g.St(e,3);break;case 2:return g.vh(e),e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},ssV=function(k){k=k.key||k.id;
if(!k)throw Error("Entity key is missing");return k},S4V=function(){hK.apply(this,arguments)},USX=function(){hK.apply(this,arguments)},Ri9=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1,p1,oV,b,Yh,Gb,G2,qQ,l9,w,yH,lz,EQ,N9,X8,q9,eA,MY,R,D,G,n,c,B7,X,K,J,lo,S9,d4,ZK,c7,GD,K7,RV,u9,VH,QX,sZ,Pd,V0;
return g.Q(function(Zh){switch(Zh.K){case 1:return y=Nw(a),q=a.entityKey,e=g.Yx(q).entityId,f=[],H=!1,e==="!*$_ALL_ENTITIES_!*$"?(H=!0,g.p(Zh,j4(k.K,"mainPlaylistEntity"),5)):g.p(Zh,Fh(k.K,q,"mainPlaylistEntity"),4);case 4:(B=Zh.D)&&f.push(B);Zh.X5(3);break;case 5:f=Zh.D;case 3:if((Z=f)==null||!Z.length)return Zh.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));z=g.v(a.actionMetadata,DS9);r=(Y=z)==null?void 0:Y.nextAutoRefreshIntervalSeconds;m=(W=z)==null?void 0:W.autoSync;T=[];x=O=
!0;V=!1;if(!H&&m===!1){Zh.X5(6);break}g.p8(Zh,7);return g.p(Zh,Ojr(0,!!m,!0,f),9);case 9:T=Zh.D;g.St(Zh,8);break;case 7:l=g.vh(Zh);if(!(l instanceof Error&&l.message==="No data")){l instanceof Error&&l.message==="Empty response body"&&u1(l.message);Zh.X5(8);break}return e==="!*$_ALL_ENTITIES_!*$"?g.p(Zh,EPV(k.K,a,k.j,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.p(Zh,QK9(e,k.K,a,k.j),8);case 8:if(!T.length||!H&&T[0].playlistId!==e)return Zh.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));case 6:if(H){P=[];N=g.A(T);for(F=N.next();!F.done;F=N.next())t=F.value,t.upToDate||m&&!t.shouldAutoSyncMetadata||!t.playlistId||(M={nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:m},P.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,iR,{mainPlaylistEntityActionMetadata:M})));return Zh.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,P))}T.length&&(ea=T[0],V=!!ea.upToDate,m&&(O=(Zl=ea.shouldAutoSyncMetadata)!=null?Zl:!0,x=(fG=ea.shouldAutoSyncVideos)!=
null?fG:!0,ea.checkInSeconds&&(r=ea.checkInSeconds)));if(V||!O)return Zh.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));r4=[];a3=f[0];if(!a3.downloadState){OZ=void 0;Zh.X5(15);break}return g.p(Zh,Fh(k.K,a3.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:OZ=Zh.D;case 15:return I3=OZ,Ya=((ka=I3)==null?0:ka.addedTimestampMillis)?String(I3.addedTimestampMillis):void 0,g.p8(Zh,17),g.p(Zh,wQ9(k,e,Ya,r),19);case 19:r4=Zh.D;g.St(Zh,18);break;case 17:CG=g.vh(Zh);if(!(CG instanceof
Error&&CG.message==="No data for playlist")){if(CG instanceof Error&&CG.message==="Empty response body for playlist")u1(CG.message);else return AO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K1="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",CG instanceof g.HG&&CG.type==="QUOTA_EXCEEDED"&&(AO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K1="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Zh.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,AO,K1));
Zh.X5(18);break}return g.p(Zh,QK9(e,k.K,a,k.j),18);case 18:if(!x)return Zh.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));p1=[];oV=new Map;if((b=r4)==null?0:b.length)for(Yh=g.A(r4),Gb=Yh.next();!Gb.done;Gb=Yh.next())G2=Gb.value,qQ=G2.offlineVideoData,l9=void 0,((l9=qQ)==null?0:l9.videoId)&&oV.set(qQ.videoId,qQ);w=new Map;yH=[];if((lz=a3)==null?0:(EQ=lz.videos)==null?0:EQ.length)for(N9=g.A(a3.videos),X8=N9.next();!X8.done;X8=N9.next())if(q9=X8.value,eA=JSON.parse(g.Yx(q9).entityId),
MY=eA.videoId)oV.has(MY)?(w.set(MY,oV.get(MY)),oV.delete(MY)):yH.push(MY);D=Number(((R=a.actionMetadata)==null?void 0:R.priority)||0)+1;G=g.A(oV.entries());for(n=G.next();!n.done;n=G.next())c=n.value,B7=g.A(c),X=B7.next().value,K=B7.next().value,J=X,lo=K,p1.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"mainVideoEntity",D,iR,xS9(a,lo,e)));S9=g.A(w.entries());for(d4=S9.next();!d4.done;d4=S9.next())ZK=d4.value,c7=g.A(ZK),GD=c7.next().value,K7=c7.next().value,RV=GD,u9=K7,p1.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
RV,"mainVideoEntity",D,iR,xS9(a,u9,e)));VH=g.A(yH);for(QX=VH.next();!QX.done;QX=VH.next())sZ=QX.value,Pd={playlistId:e},V0={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Pd},p1.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",sZ,"mainVideoEntity",0,iR,V0));return Zh.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,p1))}})},bj9=function(k){var a,y,q,e,f,H,B;
return g.Q(function(Z){if(Z.K==1)return g.p(Z,GjK(k),2);a=Z.D;y=[];q=g.A(a);for(e=q.next();!e.done;e=q.next())f=e.value,H=g.Yx(f.key),B=H.entityId,lid(k.K,B)||y.push(f);return g.p(Z,Vl9(k,y),0)})},AM9=function(k,a,y,q,e){var f;
return g.Q(function(H){if(H.K==1)return f=new Wu(k,a,y,q,e),g.p(H,g89(f),2);sKr(f);return H.return(f)})},pQ0=function(k,a){var y,q,e,f,H,B,Z,z;
return g.Q(function(Y){y=aj(k.avatar);q=g.A(a);for(e=q.next();!e.done;e=q.next())if(f=e.value,f.id!==k.id)for(H=g.A(aj(f.avatar)),B=H.next();!B.done;B=H.next())Z=B.value,z=y.indexOf(Z),z!==-1&&y.splice(z,1);return Y.return(y)})},FKV=function(k,a){var y,q,e;
return g.Q(function(f){switch(f.K){case 1:return g.p8(f,2),(y=!!a.captionTracks.length||!!a.eb)?g.p(f,PAG(a.videoId),4):f.return();case 4:return(q=f.D)?f.return():g.p(f,n8a(k.hG,a),5);case 5:g.St(f,0);break;case 2:e=g.vh(f),u1("Caption downloading error",e,a.cotn),g.wg(f)}})},JMa=function(){hK.apply(this,arguments)},NNT=function(){hK.apply(this,arguments)},v8d=function(k,a,y){a=a===void 0?43200:a;
y=y===void 0?!0:y;var q=q===void 0?!1:q;var e,f,H;return g.Q(function(B){switch(B.K){case 1:if(!k.N.Ca())return B.return([]);e=[];g.p8(B,2);return g.p(B,Ojr(a,y,q),4);case 4:e=B.D;g.St(B,3);break;case 2:f=g.vh(B),f instanceof Error&&f.message==="No data"||f instanceof Error&&f.message==="Empty response body"&&u1(f.message);case 3:return H=uHG(k,e,y,"mainPlaylistEntity"),B.return(H)}})},mS9=function(k,a){var y,q,e,f,H,B,Z;
return g.Q(function(z){if(z.K==1)return y=g.j5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.p(z,Fh(k,y,"musicDownloadsLibraryEntity"),2);q=z.D;if(!q)return z.X5(0);e=g.Yx(a).entityType;e==="musicTrack"?f=q.downloadedTracks:e==="musicPlaylist"&&(f=q.downloadedPlaylists);if((H=f)==null?0:H.length)for(B=0;B<f.length;B++)if(Z=f[B],Z===a){f.splice(B,1);break}return g.p(z,oS(k,q,"musicDownloadsLibraryEntity"),0)})},FfV=function(){this.K=new Map},o89=function(){g.pF.apply(this,arguments);
var k=this;this.events=new g.e9(this);this.B=this.player.Z();this.Sw={XG3:function(){return k.K},
qW:function(){return k.qW()},
Lb:function(a){return k.Lb(a)}}},CA2=function(k){if(k.includes(":"))throw Error("Invalid user cache name: "+k);
return k+":"+g.BG("CacheStorage get")},hi9=function(k,a){return g.y9(k.K.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(a)},function(y){return g.NY.all([y.delete(),
Am1(k,y.cursor.primaryKey)]).then(function(){mv(k,y.cursor.primaryKey,a);return g.Zn(y)})})},Ty=function(k,a){k.api.qE("onOfflineOperationFailure",a);
var y;(y=k.K)==null||y.postMessage(a)},Us=function(k,a){a=a===void 0?!1:a;
var y;return g.Q(function(q){if(q.K==1){if(k.K)throw Error("Already downloading a video");k.Kw=0;k.V=!1;return g.p(q,MlX(k),2)}return q.K!=4?(y=q.D,XQ9(k.tG,!y),y&&k.N.Ca()?a?g.p(q,new Promise(function(e){g.JF(e,1E3)}),4):q.X5(4):(!y&&k.K&&S4(k),q.X5(0))):g.p(q,oP0(k,y),0)})},cMK=function(k){return new Dd("WRONG_DATA_TYPE",{Ft:k})},Os=function(k){g.C.call(this);
this.K=k;this.D=this.K.observe(this.j.bind(this))},Lf9=function(){hK.apply(this,arguments)},Ii2=function(){hK.apply(this,arguments)},E82=function(k,a){var y,q,e,f;
return g.Q(function(H){if(H.K==1){y=a.clientPlaybackNonce;q={cpn:y,offlineSourceVisualElement:g.Kr(a.vz||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};a.D&&(q.videoFmt=Number(a.D.itag));a.L&&(q.audioFmt=Number(a.L.itag));if((e=tlK(a))&&a.videoId){var B=a.videoId;B=e!=="PPSV"?Promise.resolve(!1):k.K.RD(B);H=g.p(H,B,3)}else H=H.X5(2);return H}H.K!=2&&(f=H.D)&&(q.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");k.D=y;g.EW("offlinePlaybackStarted",q);g.wg(H)})},KfG=function(){hK.apply(this,
arguments)},JS9=function(){kg2||(kg2=new FfV);
return kg2},azV=function(){hK.apply(this,arguments)},yy9=function(){hK.apply(this,arguments)},sKr=function(k){var a=k.K.actions[0];
return k.L?((a==null?void 0:a.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&k.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(k.X=!0),Promise.resolve()):qi9(k)},e8T=function(k,a){var y,q,e,f,H,B,Z,z;
return g.Q(function(Y){y=aj(k.thumbnailDetails);q=g.A(a);for(e=q.next();!e.done;e=q.next())if(f=e.value,f.id!==k.id)for(H=g.A(aj(f.thumbnailDetails)),B=H.next();!B.done;B=H.next())Z=B.value,z=y.indexOf(Z),z!==-1&&y.splice(z,1);return Y.return(y)})},xM=function(k,a,y,q){var e;
return g.Q(function(f){if(f.K==1){if(!k.K)return QZ(k,"saveTransferState: "+a),f.return();k.K.transferState=a;k.K.failureReason=q;g.p8(f,2);return g.p(f,nP9(k,function(H){return y?wA(H,"offlineVideoStreams",k.K.offlineVideoStreams).then(function(B){for(var Z=g.A(B),z=Z.next();!z.done;z=Z.next())if((z=z.value)&&z.streamsProgress){z=g.A(z.streamsProgress);for(var Y=z.next();!Y.done;Y=z.next())Y.value.streamState=y}return fzV(H,B.filter(function(r){return!!r}),"offlineVideoStreams")}):g.NY.resolve(void 0)}),
4)}if(f.K!=2)return g.St(f,0);
e=g.vh(f);return e instanceof g.HG&&e.type==="QUOTA_EXCEEDED"?g.p(f,k.B5("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):f.X5(0)})},$WK=function(k){return tK(k,{mode:"readwrite",
TE:!0},function(a){return hi9(a,"videoPlaybackPositionEntity")})},Hc1=function(){hK.apply(this,arguments)},dWG=function(k,a){if(a)for(var y=0;y<k.actions.length;y++)if(a==="!*$_ALL_ENTITIES_!*$"&&k.actions[y].actionId!==a||a!=="!*$_ALL_ENTITIES_!*$"&&k.actions[y].rootActionId===a&&k.actions[y].actionId!==a)k.actions.splice(y,1),y--},Ber=function(){hK.apply(this,arguments)},hK=function(){nQ.apply(this,arguments)},Zc9=function(k){return k instanceof Error?new Dd("UNKNOWN_ENCODE_ERROR",{originalMessage:k.message}):
new Dd("UNKNOWN_ENCODE_ERROR")},MmV=function(k){var a,y,q,e;
g.Q(function(f){switch(f.K){case 1:if(!k.K){QZ(k,"onTransferPausedByUser");f.X5(2);break}a=k.K;k.L.stop();return g.p(f,xM(k,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:q=((y=a)==null?0:y.key)?g.Yx(a.key).entityId:"";if(!q||!k.j){f.X5(4);break}return g.p(f,Rj(q,k.j,k.D,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.p(f,qP(k,q),6);case 6:e=f.D,z8a({videoId:q,yI:a,offlineModeType:e});case 2:S4(k),Us(k),g.wg(f)}})},Yi0=function(){hK.apply(this,arguments)},ic9=function(k,a,y,q){var e=ryV(k.D,1);
return EL(k,a,q).then(function(f){if(f){f=g.P8(f,y);var H={key:a,entityType:q,data:jzd(e,f,a),version:1};return g.NY.all([g.Jl(k.K.objectStore("EntityStore"),H),PO1(k,f,q)])}}).then(function(){mv(k,a,q);
return a})},Gy=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!k.entityKey},kM=function(k,a,y){var q=ssV(a),e=ryV(k.D,1),f=Object.assign({},a);
return k.K.objectStore("EntityStore").get(q).then(function(H){if(H){if(H.entityType!==y)throw Error("Incorrect entity type");f.entityMetadata||(H=WB0(k,H),f.entityMetadata=H.entityMetadata)}}).then(function(){var H={key:q,
entityType:y,data:jzd(e,f,q),version:1};return g.NY.all([g.Jl(k.K.objectStore("EntityStore"),H),PO1(k,f,y)])}).then(function(){mv(k,q,y);
return q})},mW0=function(){hK.apply(this,arguments)},Te2=function(){hK.apply(this,arguments)},gA=function(k,a,y,q,e){var f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1,p1,oV,b,Yh,Gb;
return g.Q(function(G2){switch(G2.K){case 1:return f=g.j5(k,a),H=g.j5("music_downloads_library_id","musicDownloadsLibraryEntity"),g.p(G2,tK(y,{mode:"readonly",TE:!0},function(qQ){return g.NY.all([EL(qQ,f,a),EL(qQ,H,"musicDownloadsLibraryEntity"),wA(qQ,a),wA(qQ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=G2.D;Z=g.A(B);z=Z.next().value;Y=Z.next().value;r=Z.next().value;W=Z.next().value;m=z;T=Y;O=r;x=W;if(!m){G2.X5(3);break}return g.p(G2,e8T(m,O),4);case 4:return V=G2.D,g.p(G2,lR(V),3);case 3:l=[];P=new Map;if(!m){G2.X5(6);break}return g.p(G2,SiX(m,O,T),7);case 7:l=G2.D;N=g.A(l);for(F=N.next();!F.done;F=N.next())t=F.value,M=g.Yx(t).entityId,P.set(M,{videoId:M,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.p(G2,j4(y,"transfer"),8);case 8:for(ea=G2.D,Zl=
g.A(ea),fG=Zl.next();!fG.done;fG=Zl.next())r4=fG.value,a3=g.Yx(r4.key).entityId,(OZ=P.get(a3))&&r4&&(OZ.cotn=r4.cotn);case 6:I3=[];ka=g.A(x);for(Ya=ka.next();!Ya.done;Ya=ka.next())CG=Ya.value,AO=g.Yx(CG.key).entityId,K1=VZ(CG),AO!==k&&K1.rootActionId!==k||bR(q,CG.actionProto)||I3.push(CG.key);p1=g.j5(k,a);return g.p(G2,tK(y,{mode:"readwrite",TE:!0},function(qQ){var l9=I3.map(function(w){return KQ(qQ,w)});
l9.push(KQ(qQ,p1,{eU:!0}));return g.NY.all(l9)}),9);
case 9:if(!m){G2.X5(0);break}l.reverse();if(!l.length){G2.X5(0);break}oV=g.A(l);b=oV.next();case 12:if(b.done){G2.X5(0);break}Yh=b.value;Gb=g.Yx(Yh).entityId;if(!Gb){G2.X5(13);break}return g.p(G2,rA(Gb,y,q,e,P.get(Gb)),13);case 13:b=oV.next(),G2.X5(12)}})},SiX=function(k,a,y){var q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N;
return g.Q(function(F){q=[];e=new Set;if((f=y)==null?0:(H=f.downloadedTracks)==null?0:H.length)for(B=g.A(y.downloadedTracks),Z=B.next();!Z.done;Z=B.next())z=Z.value,e.add(z);if(k.tracks){Y=g.A(k.tracks);for(r=Y.next();!r.done;r=Y.next())W=r.value,e.has(W)||q.push(W);m=g.A(a);for(T=m.next();!T.done;T=m.next())if(O=T.value,O.id!==k.id&&(x=O.tracks))for(V=g.A(x),l=V.next();!l.done;l=V.next())P=l.value,N=q.indexOf(P),N!==-1&&q.splice(N,1)}return F.return(q)})},UWX=function(k){var a,y,q;
return g.Q(function(e){if(e.K==1)return k?g.p(e,Fh(k,g.nw,"mainDownloadsListEntity"),2):e.return([]);a=e.D;return((y=a)==null?0:(q=y.downloads)==null?0:q.length)?e.return(a.downloads.map(function(f){var H;return(H=f.videoItem)!=null?H:""})):e.return([])})},bTT=function(k,a){return{id:k,
channelId:a.channelId,title:a.title,avatar:a.thumbnail}},DW2=function(){hK.apply(this,arguments)},Fh=function(k,a,y){return tK(k,{mode:"readonly",
TE:!0},function(q){return EL(q,a,y)})},Oc2=function(k){return g.KX((0,g.fn0)(),k)},wL9=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V;
return g.Q(function(l){switch(l.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey),e=q.entityId,f=[],g.p8(l,2),g.p(l,QzK(k,e),4);case 4:f=l.D;if((H=f)==null||!H.length){l.X5(5);break}return g.p(l,Ce9(k.K,a.entityKey),5);case 5:g.St(l,3);break;case 2:return B=g.vh(l),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.HG&&B.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Z,z));case 3:return Y=[],g.p(l,BN2(k.K,"musicTrack",f),7);case 7:f=l.D;if(f.length)for(r=g.A(f),W=r.next();!W.done;W=r.next())if(m=W.value,T=m.offlineVideoData,O=void 0,(O=T)==null?0:O.videoId)x=void 0,V=Number(((x=a.actionMetadata)==null?void 0:x.priority)||0)+1,Y.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",V,AG,Hu(a,T,e)));return l.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Y))}})},
xW9=function(){hK.apply(this,arguments)},EL=function(k,a,y){return k.K.objectStore("EntityStore").get(a).then(function(q){if(q){if(y&&q.entityType!==y)throw Error("Incorrect entity type");
return WB0(k,q)}})},R8V=function(k){var a,y;
return g.Q(function(q){if(q.K==1)return g.p(q,g.g2(),2);if(q.K!=3)return(a=q.D)?g.p(q,g.Al(a),3):q.return();y=q.D;return q.return(g.n8(y,["index","media","captions"],{mode:"readwrite",TE:!0},function(e){var f=IDBKeyRange.bound(k+"|",k+"~");e=[e.objectStore("index").delete(f),e.objectStore("media").delete(f),e.objectStore("captions").delete(f)];return g.NY.all(e).then(function(){})}))})},oS=function(k,a,y){return tK(k,{mode:"readwrite",
TE:!0},function(q){return kM(q,a,y)})},GgG=function(k,a){var y,q;
return g.Q(function(e){switch(e.K){case 1:return y=Nw(a),g.p8(e,2),q=g.Yx(a.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.p(e,YM(k.K,a,k.j),5):g.p(e,gA(q,"musicPlaylist",k.K,a,k.j),6);case 6:return g.p(e,mS9(k.K,a.entityKey),5);case 5:g.St(e,3);break;case 2:return g.vh(e),e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},pa=function(k){this.token=k},lz2=function(k){return{context:g.Dn(),
offlinePlaylistSyncChecks:k}},V$0=function(){try{var k=g.ko("ytglobal.locks_");
if(k)return k;var a;if(a=navigator){var y=navigator;a="locks"in y&&!!y.locks}if(a)return g.DP.localStorage&&g.DP.localStorage.getItem("noop"),k=new SSX,g.H7("ytglobal.locks_",k),k}catch(q){}},bcr=function(){hK.apply(this,arguments)},gi1=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!k.entityKey},z8a=function(k){e4({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},k)},szr=function(k){var a=k.videos;
k=[];var y=[];if(a){a=g.A(a);for(var q=a.next();!q.done;q=a.next()){var e=q.value.offlineVideoData.videoId;q=g.j5(e,"musicTrack");e=g.j5(e,"musicTrackDownloadMetadataEntity");k.push(q);y.push(e)}}return{It:k,nU:y}},Rj=function(k,a,y,q,e){e=e===void 0?!1:e;
var f,H,B,Z,z,Y;return g.Q(function(r){if(r.K==1)return f=g.j5(k,a),H=g.j5(k,"downloadStatusEntity"),g.p(r,tK(y,{mode:"readonly",TE:!0},function(W){return g.NY.all([EL(W,f,a),EL(W,H,"downloadStatusEntity")])}),2);
B=r.D;Z=B.length?B[0]:void 0;if(!Z)return r.X5(0);z=Ayd;if(Y=B.length>1?B[1]:void 0){if(Y.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!e)return r.return();Y.downloadState=q}else Y={key:H,downloadState:q};g.jb(Z,z,Y);return g.p(r,tK(y,{mode:"readwrite",TE:!0},function(W){return g.NY.all([kM(W,Z,a),kM(W,Y,"downloadStatusEntity")])}),0)})},pL0=function(k){return{context:g.Dn(),
videoIds:k}},Prr=function(k){return k instanceof Error?new Dd("UNKNOWN_DECODE_ERROR",{originalMessage:k.message}):new Dd("UNKNOWN_DECODE_ERROR")},S4=function(k){k.K=void 0;
k.X=void 0;k.L.stop()},ni1=function(k){return{context:g.Dn(),
playlistIds:k}},Jy9=function(){hK.apply(this,arguments)},Nea=function(){hK.apply(this,arguments)},u39=function(){hK.apply(this,arguments)},Qsr=function(k){e4({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},k)},Pu=function(k){k.G&&k.N&&k.X&&k.visibility.isBackground()?g.rD(k.L,6E4):k.L.stop()},vi9=function(){hK.apply(this,arguments)},FB9=function(){hK.apply(this,arguments)},oi9=function(k,a,y){var q=this;
this.V=k;this.aj=a;this.visibility=y;this.X=this.G=this.N=this.j=this.K=!1;this.L=new g.gD(function(){q.JB()});
this.Sw={n4:function(){return q.D},
JB:function(){q.JB()},
NtZ:function(){return q.L}};
this.visibility.subscribe("visibilitystatechange",function(){q.AV()})},Cr2=function(k,a){var y={offlineOrchestrationContext:pGK(k)};
a=PeG(a,y);nUT(JS9(),a,k.rootActionId)},na=function(k){this.K=k},bR=function(k,a){return k.actionType===a.actionType&&k.entityKey===a.entityKey},wQ9=function(k,a,y,q){var e,f,H,B,Z,z,Y;
return g.Q(function(r){switch(r.K){case 1:return g.p(r,h8G([a]),2);case 2:return e=r.D,g.p(r,gP9(k,e[0],y,q),3);case 3:return f=r.D,H=f.mainPlaylistEntity,B=f.W8e,z=M$d(H,(Z=B)==null?void 0:Z.avatar),g.p8(r,4),g.p(r,yZ(z),6);case 6:g.St(r,5);break;case 4:Y=g.vh(r),Y instanceof Error&&Y.message==="Failed to fetch"&&u1(Y.message);case 5:return r.return(e[0].videos)}})},rMK=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},JG=function(k,a){a=a?" for "+a:"";
if(k===0)throw k="Empty response body"+a,u1(k),Error(k);k="Response with error"+a;u1(k);throw Error(k);},hwT=function(){var k,a;
return g.Q(function(y){if(y.K==1)return g.p(y,g.g2(),2);if(y.K!=3){k=y.D;if(!k)throw g.sQ("rvdfd");return g.p(y,g.Al(k),3)}a=y.D;return y.return(g.n8(a,["index","media"],{mode:"readwrite",TE:!0},function(q){var e={};return g.B1(q.objectStore("index"),{},function(f){var H=f.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),B=g.NY.resolve(void 0);if(H){var Z=H[1];H=H[2];e[Z]=e[Z]||{};var z;e[Z][H]=g.IlH((z=f.getValue())==null?void 0:z.fmts)}else B=f.delete().then(function(){});
return g.NY.all([g.Zn(f),B]).then(function(Y){return g.A(Y).next().value})}).then(function(){for(var f={},H=g.A(Object.keys(e)),B=H.next();!B.done;B=H.next()){B=B.value;
var Z=e[B].v;f[B]=e[B].a&&Z?1:2}var z=q49(f);return g.wY7(q.objectStore("media"),{},function(Y){var r=Y.cursor.key.match(g.eK5);r&&f[r[1]]||q.objectStore("media").delete(Y.cursor.key);return g.OC5(Y)}).then(function(){return z})})}))})},Iz2=function(){return g.Q(function(k){if(k.K==1)return g.p(k,XLr(),2);
if(!k.D)return k.return(void 0);cyd||(cyd=new LB9);return k.return(cyd)})},NP=function(k){var a;
k.offlineDeleteReason=(a=k.offlineDeleteReason)!=null?a:"OFFLINE_DELETE_REASON_UNKNOWN";var y;k.offlineModeType=(y=k.offlineModeType)!=null?y:"OFFLINE_NOW";g.EW("offlineDeleteEvent",k)},PeG=function(k,a){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:k},metadata:a,statusCode:void 0,csn:void 0,can:void 0}},t$2=function(){uR.apply(this,arguments);
this.aj="mainVideoEntity"},xh2=function(k,a,y,q){var e,f,H,B,Z,z,Y,r,W,m,T,O,x;
return g.Q(function(V){switch(V.K){case 1:y||(y=Date.now().toString());f=(e=a.channel)==null?void 0:e.offlineChannelData;H={id:g.j5(a.videoId,"ytMainChannelEntity"),channelId:f.channelId,title:f.title,avatar:f.thumbnail};B={key:g.j5(a.videoId,"mainVideoDownloadStateEntity"),playbackData:g.j5(a.videoId,"playbackData"),addedTimestampMillis:y,videoDownloadContextEntity:g.j5(a.videoId,"videoDownloadContextEntity")};Z={key:g.j5(a.videoId,"videoPlaybackPositionEntity"),videoId:a.videoId,lastPlaybackPositionSeconds:"0"};
k.B.W("html5_offline_playback_position_sync")&&(z={playbackPosition:Z.key});Y=g.j5(a.videoId,"mainVideoEntity");r={key:Y,videoId:a.videoId,title:a.title,thumbnail:a.thumbnail,localizedStrings:{viewCount:a.shortViewCountText},userState:z,lengthSeconds:a.lengthSeconds?Number(a.lengthSeconds):void 0,publishedTimestampMillis:a.publishedTimestamp?(Number(a.publishedTimestamp)*1E3).toString():void 0,formattedDescription:a.description,owner:H.id,downloadState:B.key};if(!k.B.W("woffle_enable_main_downloads_library")||
!q){V.X5(2);break}return g.p(V,Eid(k.K,[Y]),3);case 3:if(T=V.D)W=T.mainDownloadsLibraryEntity,m=T.mainDownloadsListEntity;case 2:return x=Ayd,O={key:g.j5(a.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.jb(B,x,O),g.p(V,tK(k.K,{mode:"readwrite",TE:!0},function(l){var P=kM(l,H,"ytMainChannelEntity"),N=kM(l,B,"mainVideoDownloadStateEntity"),F=kM(l,r,"mainVideoEntity");P=[P,N,F];k.B.W("html5_offline_playback_position_sync")&&(N=kM(l,Z,"videoPlaybackPositionEntity"),
P.push(N));W&&(N=kM(l,W,"mainDownloadsLibraryEntity"),P.push(N));m&&(N=kM(l,m,"mainDownloadsListEntity"),P.push(N));O&&(l=kM(l,O,"downloadStatusEntity"),P.push(l));return g.NY.all(P)}),4);
case 4:return V.return({mainVideoEntity:r,channelEntity:H})}})},h8G=function(k){var a,y,q,e,f,H,B,Z;
return g.Q(function(z){switch(z.K){case 1:return a=g.SQ(),y=ni1(k),q=g.Ok(KBG),g.p8(z,2),f={t5:!0},g.p(z,g.Qe(a,y,q,void 0,f),4);case 4:e=z.D;g.St(z,3);break;case 2:H=g.vh(z);if(H instanceof g.lu)throw B="GetOffline network manager error for playlist: "+H.message,u1(B,H),Error(B);u1("GetOffline fetch request error for playlist",H);throw Error("GetOffline fetch request error for playlist");case 3:Z=vu(e);if(!e)throw u1("Network request failed for playlist"),Error("Network request failed for playlist");
if(Z!==void 0)JG(Z,"playlist");else if(!e.playlists||!e.playlists.length)throw u1("No data for playlist"),Error("No data for playlist");return z.return(e.playlists.map(function(Y){return Y.offlinePlaylistData}))}})},Fg=function(k){g.C.call(this);
var a=this;this.api=k;this.Sw={y5w:function(){return a.K},
cpw:function(){return a.D}};
typeof g.DP.BroadcastChannel!=="undefined"&&(this.K=new g.DP.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.BG()),this.K.onmessage=this.j.bind(this),this.D=new g.DP.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.BG()),this.D.onmessage=this.L.bind(this))},aGK=function(k){return g.KX(kP9(),k)},oj=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!k.entityKey},qJa=function(k){var a;
if((a=k.onResponseReceivedActions)!=null&&a.length){var y;k=(y=g.v(g.v(k.onResponseReceivedActions[0],yEa),g.kS0))==null?void 0:y.actions;if(k!=null&&k.length)return k}},fGr=function(k,a,y){var q,e;
g.Q(function(f){switch(f.K){case 1:if(!k.K)return QZ(k,"onTransferProgress: "+a),f.return();if(k.K.transferState==="TRANSFER_STATE_TRANSFERRING"){f.X5(2);break}return g.p(f,Nkr(k),2);case 2:q=Date.now();if(!(q-k.cz>1E3)){f.X5(4);break}k.cz=q;return g.p(f,e29(k.D,y.videoId,y.D,y.uv,y.bytesDownloaded,y.K),5);case 5:if(k.aj&&!(k.aj&&q-k.Kw>k.ge)){f.X5(4);break}k.Kw=q;return g.p(f,qP(k,a),7);case 7:e=f.D,Jm9({videoId:a,yI:k.K,offlineModeType:e},y.bytesDownloaded,y.K);case 4:k.L.start(108E5),g.wg(f)}})},
$vK=function(){hK.apply(this,arguments)},kP9=function(){if(Ca)return Ca();
var k={};Ca=g.BT("PersistentEntityStoreDb",{u0:(k.EntityStore={Je:1},k.EntityAssociationStore={Je:2},k),shared:!1,upgrade:function(a,y){y(1)&&g.X9(g.DT(a,"EntityStore",{keyPath:"key"}),"entityType","entityType");y(2)&&(a=g.DT(a,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.X9(a,"byParentEntityKey","parentEntityKey"),g.X9(a,"byChildEntityKey","childEntityKey"))},
version:3});return Ca()},HKr=function(){hK.apply(this,arguments)},LQ=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W;
return g.Q(function(m){if(m.K==1)return y=g.j5(a,"transfer"),q=g.j5(a,"videoDownloadContextEntity"),g.p(m,tK(k,{mode:"readonly",TE:!0},function(T){return g.NY.all([EL(T,y,"transfer"),EL(T,q,"videoDownloadContextEntity")])}),2);
e=m.D;f=g.A(e);H=f.next().value;B=f.next().value;Z=H;z=B;W={videoId:a,cotn:(Y=Z)==null?void 0:Y.cotn,offlineModeType:(r=z)==null?void 0:r.offlineModeType};return m.return(W)})},IS=function(k,a,y,q,e){var f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1;
return g.Q(function(p1){switch(p1.K){case 1:return f=g.j5(k,"mainVideoEntity"),H=g.j5(k,"ytMainChannelEntity"),B=g.j5(k,"transfer"),Z=g.j5(k,"videoDownloadContextEntity"),g.p(p1,tK(a,{mode:"readonly",TE:!0},function(oV){return g.NY.all([EL(oV,f,"mainVideoEntity"),EL(oV,H,"ytMainChannelEntity"),EL(oV,B,"transfer"),EL(oV,Z,"videoDownloadContextEntity"),wA(oV,"ytMainChannelEntity"),wA(oV,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:z=p1.D;Y=g.A(z);r=Y.next().value;W=Y.next().value;m=Y.next().value;T=Y.next().value;O=Y.next().value;x=Y.next().value;V=r;l=W;P=m;N=T;F=O;t=x;if(!V&&!l){p1.X5(3);break}M=V?aj(V.thumbnail):[];if(!l){ea=[];p1.X5(4);break}return g.p(p1,pQ0(l,F),5);case 5:ea=p1.D;case 4:return Zl=ea,g.p(p1,lR(M.concat(Zl)),3);case 3:fG=[];r4=g.j5(k,"downloadStatusEntity");a3=g.A(t);for(OZ=a3.next();!OZ.done;OZ=a3.next())I3=OZ.value,ka=g.Yx(I3.key).entityId,Ya=VZ(I3),CG=g.Yx(Ya.action.entityKey).entityId,ka!==k&&
CG!==k||bR(y,I3.actionProto)||fG.push(I3.key);return g.p(p1,tK(a,{mode:"readwrite",TE:!0},function(oV){var b=fG.map(function(Yh){return KQ(oV,Yh)});
b.push(KQ(oV,f,{eU:!0}));b.push(KQ(oV,r4,{eU:!0}));return g.NY.all(b)}),7);
case 7:K1=(AO=N)==null?void 0:AO.offlineModeType,e&&(NP(e),e.offlineModeType&&(K1=e.offlineModeType)),fa(P,K1),Ty(q,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.wg(p1)}})},dv9=function(){hK.apply(this,arguments)},Bo1=function(){hK.apply(this,arguments)},ZKd=function(){hK.apply(this,arguments)},z2G=function(){hK.apply(this,arguments)},YJ2=function(){hK.apply(this,arguments)},u1=function(k,a,y){g.vn(new g.s_("Woffle: "+k,y?{cotn:y}:""));
a instanceof Error&&g.vn(a)},rEr=function(){this.K={};
this.K[0]=new hG;if(!g.$L("aes_pes_encoder_killswitch")){var k=this.K;try{var a=g.BG();var y=mhT(a);var q=new na(new g.F9(y),new g.QH(y))}catch(e){throw k=e instanceof Error?new Dd("KEY_CREATION_FAILED",{originalMessage:e.message}):new Dd("KEY_CREATION_FAILED"),g.kh(k),k;}k[1]=q}},j59=function(){hK.apply(this,arguments)},Wy0=function(k,a){a=a===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":a;
var y,q,e,f;return g.Q(function(H){if(H.K==1)return k.K||QZ(k,"setTransferToFailed: "+a),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a==="TRANSFER_FAILURE_REASON_NETWORK"?y="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":a==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.p(H,xM(k,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",a),2);if(H.K!=3)return Ty(k.vz,{entityKey:(q=k.K)==null?void 0:q.key,failureReason:y}),
e=k.K?g.Yx(k.K.key).entityId:"",g.p(H,qP(k,e),3);f=H.D;var B={videoId:e,yI:k.K,offlineModeType:f},Z=a,z={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};Z&&(z.transferFailureReason=Z,z.failureReason=iK9(Z));e4(z,B);g.wg(H)})},mv0=function(k){var a=(k.K.transferRetryCount||0)<3;
a&&(k=k.K,k.transferRetryCount=(k.transferRetryCount||0)+1);return a},Nw=function(k){var a,y,q;
return((q=(a=k.actionMetadata)==null?void 0:(y=a.retryScheduleIntervalsInSeconds)==null?void 0:y.length)!=null?q:0)>0},Tor=function(k,a,y){var q,e,f,H,B,Z,z,Y,r,W,m,T,O,x;
return g.Q(function(V){if(V.K==1){q=a.additionalMetadadatas;e=void 0;if(q&&q.length>0)for(f=g.A(q),H=f.next();!H.done;H=f.next())if(B=H.value,B.offlineMusicPlaylistData){e=B.offlineMusicPlaylistData;break}Z=a.playlistId;z=szr(a);Y=z.It;r=z.nU;W=y?(Number(y)*1E3).toString():Date.now().toString();m=a.lastModifiedTimestamp?(Number(a.lastModifiedTimestamp)*1E3).toString():"0";T={id:g.j5(Z,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:r,lastModifiedTimestampMillis:m,addedTimestampMillis:W,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};O={id:g.j5(Z,"musicAlbumRelease"),title:a.title,audioPlaylistId:Z,trackCount:a.totalVideoCount,tracks:Y,downloadMetadata:T.id};e&&(O.thumbnailDetails=(x=e.albumHqThumbnail)!=null?x:e.albumArtistThumbnail,O.artistDisplayName=e.albumArtistDisplayName,O.releaseDate=e.albumReleaseDate,O.contentRating={explicitType:e.albumReleaseExplicitType},O.releaseType=e.albumReleaseType);return g.p(V,tK(k.K,{mode:"readwrite",TE:!0},function(l){var P=kM(l,O,"musicAlbumRelease");
l=kM(l,T,"musicAlbumReleaseDownloadMetadataEntity");return g.NY.all([P,l])}),2)}return V.return(O)})},SJd=function(){hK.apply(this,arguments)},Uva=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T;
return g.Q(function(O){switch(O.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey),e=q.entityId,f=g.v(a.actionMetadata,Xh),B=!((H=f)==null?0:H.playlistId),g.p8(O,2),g.p(O,BkT(k,e,void 0,(Z=f)==null?void 0:Z.offlineVideoData,B),4);case 4:g.St(O,3);break;case 2:return z=g.vh(O),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.HG&&z.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Y,r));case 3:W=1;W=Number(((m=a.actionMetadata)==null?void 0:m.priority)||0)+1;var x=(x=g.v(a.actionMetadata,Xh))?{playbackDataActionMetadata:{maximumDownloadQuality:x.maximumDownloadQuality}}:void 0;T=cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"playbackData",W,ZT9,x);return O.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,[T]))}})},dA=function(){Dvr||(Dvr=OK1());
return Dvr},Q59=function(k){e4({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},k)},R2T=function(k,a,y,q,e){var f,H,B,Z,z,Y;
return g.Q(function(r){switch(r.K){case 1:if(f=q){r.X5(2);break}return g.p(r,war([a]),3);case 3:H=r.D,B=H[0],f=wYd(B);case 2:return g.p(r,xv9(k,f,a,e,y),4);case 4:Z=r.D;z=Z.musicTrackEntity;Y=Z.VZ;var W=aj(z.thumbnailDetails),m=[];Y&&(m=aj(Y.thumbnailDetails));return g.p(r,yZ(W.concat(m)),0)}})},Zd=function(k){return{key:g.j5(k.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:k.action,parentActionId:k.parentActionId,rootActionId:k.rootActionId,childActionIds:k.childActionIds,prereqActionId:k.prereqActionId,postreqActionIds:k.postreqActionIds,retryScheduleIndex:k.retryScheduleIndex,hasChildActionFailed:k.hasChildActionFailed,enqueueTimeSec:(k.K/1E3).toFixed()}},vP0=function(k,a,y){return new g.Mu(k,{cotn:a,
raw_player_response:y,download_media:!0,start:Infinity,disable_watch_next:!0})},GPG=function(){hK.apply(this,arguments)},VDG=function(k){var a;
return g.Q(function(y){return y.K==1?g.p(y,dA(),2):(a=y.D)?g.p(y,tK(a,"readwrite",function(q){for(var e={},f=g.A(k),H=f.next(),B={};!H.done;B={Ax:void 0,SP:void 0},H=f.next())B.Ax=H.value,B.Ax.entityKey&&lGT(B.Ax)&&(B.SP=g.c6(B.Ax.payload),H=void 0,B.Ax.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(H=function(Z){return function(){return kM(q,Z.Ax.payload[Z.SP],Z.SP)}}(B)),B.Ax.type==="ENTITY_MUTATION_TYPE_DELETE"&&(H=function(Z){return function(){return KQ(q,Z.Ax.entityKey)}}(B)),B.Ax.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(H=function(Z){return function(){return ic9(q,Z.Ax.entityKey,Z.Ax.payload[Z.SP],Z.SP)}}(B)),H&&(e[B.Ax.entityKey]=e[B.Ax.entityKey]?e[B.Ax.entityKey].then(H):H()));
return g.NY.all(Object.values(e))}),0):y.return()})},bKd=function(){hK.apply(this,arguments)},gyK=function(){hK.apply(this,arguments)},s59=function(){hK.apply(this,arguments)},j4=function(k,a,y){return tK(k,{mode:"readonly",
TE:!0},function(q){return wA(q,a,y)})},AE9=function(k,a){k=g.A(k.observers);
for(var y=k.next();!y.done;y=k.next())y=y.value,y(a)},pYd=function(k){var a,y,q;
return g.Q(function(e){if(e.K==1)return a=IDBKeyRange.bound(k+"|",k+"~"),g.p(e,g.g2(),2);if(e.K!=3){y=e.D;if(!y)throw g.sQ("gactfv");return g.p(e,g.Al(y),3)}q=e.D;return e.return(q.getAll("captions",a))})},PXT=function(){hK.apply(this,arguments)},wYd=function(k){for(var a,y=g.A(k.additionalMetadatas),q=y.next();!q.done;q=y.next())q=q.value,q.offlineMusicVideoData&&(a=q.offlineMusicVideoData);
var e,f,H,B,Z;return{id:g.j5(k.videoId,"musicTrack"),videoId:k.videoId,title:k.title,thumbnailDetails:k.thumbnail,lengthMs:String(Number(k.lengthSeconds)*1E3),albumTitle:(e=a)==null?void 0:e.releaseTitle,musicVideoType:(f=a)==null?void 0:f.musicVideoType,contentRating:{explicitType:(H=a)==null?void 0:H.explicitType},artistNames:((B=a)==null?void 0:B.byline)||((Z=a)==null?void 0:Z.channelName),downloadMetadata:g.j5(k.videoId,"musicTrackDownloadMetadataEntity")}},nyT=function(){hK.apply(this,arguments)},
ryV=function(k,a){a=a===void 0?0:a;
k=k.K[a];if(!k)throw a=new Dd("INVALID_ENCODER_VERSION",{Ft:a}),g.kh(a),a;return k},JE2=function(k,a){var y,q,e,f;
return g.Q(function(H){switch(H.K){case 1:return y=Nw(a),g.p8(H,2),q=g.Yx(a.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.p(H,EPV(k.K,a,k.j,(e=a.actionMetadata)==null?void 0:(f=e.offlineLoggingData)==null?void 0:f.offlineDeleteReason),5):g.p(H,QK9(q,k.K,a,k.j),6);case 6:if(!k.B.W("woffle_enable_main_downloads_library")){H.X5(5);break}return g.p(H,KK1(k.K,a.entityKey),5);case 5:g.St(H,3);break;case 2:return g.vh(H),H.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},NoV=function(k,a){var y,q;
return g.Q(function(e){switch(e.K){case 1:return y=Nw(a),g.p8(e,2),q=g.Yx(a.entityKey).entityId,q==="!*$_ALL_ENTITIES_!*$"?g.p(e,YM(k.K,a,k.j),5):g.p(e,gA(q,"musicAlbumRelease",k.K,a,k.j),6);case 6:return g.p(e,mS9(k.K,a.entityKey),5);case 5:g.St(e,3);break;case 2:return g.vh(e),e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},ukX=function(){hK.apply(this,arguments)},iK9=function(k){switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
XQ9=function(k,a){k.K&&(k.G=a,Pu(k))},vyG=function(k,a){this.K=k;
this.j=a},FyX=function(k,a){this.K=k;
this.j=a},h2r=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m;
return g.Q(function(T){switch(T.K){case 1:return y=Nw(a),g.p(T,j4(k.K,"videoPlaybackPositionEntity"),2);case 2:q=T.D;if(q.length===0)return T.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.p8(T,3);return g.p(T,pa.getInstance(),5);case 5:e=T.D;if(!e)throw Error("prefStorage is undefined");return g.p(T,e.get("psi"),6);case 6:return f=T.D,Z=(B=(H=f)==null?void 0:H.Df)!=null?B:"0",g.p(T,oyX(q,Z),7);case 7:return z=T.D,Y={isPaused:z.watchHistoryPaused,Df:z.syncTimestampUsec},g.p(T,e.set("psi",
Y),8);case 8:if(Y.isPaused){T.X5(9);break}r=g.v(z.frameworkUpdates,MP);if(!z.frameworkUpdates||!r){T.X5(9);break}return g.p(T,CXX(r),9);case 9:g.St(T,4);break;case 3:return W=g.vh(T),m="PPE handleRefresh error: "+(W instanceof Error?W.message:"unknown error"),u1(m),T.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},MD0=function(){hK.apply(this,arguments)},XYX=function(k,a,y,q){var e,f,H,B,Z,z,Y,r,W;
return g.Q(function(m){return m.K==1?(e=a.playlistId,f=szr(a),H=f.It,B=f.nU,Z=y?(Number(y)*1E3).toString():Date.now().toString(),z=a.lastModifiedTimestamp?(Number(a.lastModifiedTimestamp)*1E3).toString():"0",Y={id:g.j5(e,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:B,lastModifiedTimestampMillis:z,addedTimestampMillis:Z,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},r={id:g.j5(e,"musicPlaylist"),title:a.title,playlistId:e,thumbnailDetails:a.thumbnail,visibility:Rw9(a),trackCount:a.totalVideoCount,
tracks:H,downloadMetadata:Y.id},q&&(((W=r)==null?0:W.entityMetadata)?r.entityMetadata.nextAutoRefreshIntervalSeconds=String(q):r&&(r.entityMetadata={nextAutoRefreshIntervalSeconds:String(q)})),g.p(m,tK(k.K,{mode:"readwrite",TE:!0},function(T){var O=kM(T,r,"musicPlaylist");T=kM(T,Y,"musicPlaylistDownloadMetadataEntity");return g.NY.all([O,T])}),2)):m.return(r)})},cE9=function(){hK.apply(this,arguments)},WB0=function(k,a){a:{k=ryV(k.D,a.version);
try{var y=k.D(a.data,a.key);break a}catch(q){Lyr(q,Prr)}y=void 0}return y},OT2=function(k){return g.Q(function(a){return a.return(IGT(k))})},tDG=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1,p1,oV,b,Yh,Gb,G2,qQ,l9,w,yH,lz,EQ,N9,X8,q9,eA,MY,R,D,G,n,c,B7,X,K;
return g.Q(function(J){switch(J.K){case 1:return y=Nw(a),q=a.entityKey,e=g.Yx(q).entityId,f=[],H=!1,e==="!*$_ALL_ENTITIES_!*$"?(H=!0,g.p(J,j4(k.K,"musicAlbumRelease"),5)):g.p(J,Fh(k.K,q,"musicAlbumRelease"),4);case 4:(B=J.D)&&f.push(B);J.X5(3);break;case 5:f=J.D;case 3:if((Z=f)==null||!Z.length)return J.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));if(H){z=[];Y=g.A(f);for(r=Y.next();!r.done;r=Y.next())W=r.value,m=g.Yx(W.id).entityId,z.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
m,"musicAlbumRelease",0,$M));return J.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,z))}T=[];O=f[0];x=void 0;if(!O.downloadMetadata){J.X5(6);break}return g.p(J,Fh(k.K,O.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:V=J.D,x=Number((P=(l=V)==null?void 0:l.addedTimestampMillis)!=null?P:"0")/1E3;case 6:return g.p8(J,8),g.p(J,dS1(k,e,(N=x)==null?void 0:N.toString()),10);case 10:T=J.D;g.St(J,9);break;case 8:F=g.vh(J);if(!(F instanceof Error&&F.message==="No data")){if(F instanceof
Error&&F.message==="Empty response body")u1(F.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.HG&&F.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),J.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,t,M));J.X5(9);break}return g.p(J,gA(e,"musicAlbumRelease",k.K,a,k.j),9);case 9:ea=[];Zl=new Map;
if((fG=T)==null?0:fG.length)for(r4=g.A(T),a3=r4.next();!a3.done;a3=r4.next())OZ=a3.value,I3=OZ.offlineVideoData,ka=void 0,((ka=I3)==null?0:ka.videoId)&&Zl.set(I3.videoId,I3);Ya=new Map;CG=[];if((AO=O)==null?0:(K1=AO.tracks)==null?0:K1.length)for(p1=g.A(O.tracks),oV=p1.next();!oV.done;oV=p1.next())if(b=oV.value,Yh=g.Yx(b).entityId)Zl.has(Yh)?(Ya.set(Yh,Zl.get(Yh)),Zl.delete(Yh)):CG.push(Yh);G2=Number(((Gb=a.actionMetadata)==null?void 0:Gb.priority)||0)+1;qQ=g.A(Zl.entries());for(l9=qQ.next();!l9.done;l9=
qQ.next())w=l9.value,yH=g.A(w),lz=yH.next().value,EQ=yH.next().value,N9=lz,X8=EQ,ea.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N9,"musicTrack",G2,$M,Hu(a,X8)));q9=g.A(Ya.entries());for(eA=q9.next();!eA.done;eA=q9.next())MY=eA.value,R=g.A(MY),D=R.next().value,G=R.next().value,n=D,c=G,ea.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n,"musicTrack",G2,$M,Hu(a,c)));B7=g.A(CG);for(X=B7.next();!X.done;X=B7.next())K=X.value,ea.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",K,"musicTrack",
0,$M));return J.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,ea))}})},Dd=function(k,a){a=a===void 0?{}:a;
g.s_.call(this,g.$VG[k],Object.assign({},{name:"PESEncoderError",type:k},a));this.type=k;this.level="WARNING";Object.setPrototypeOf(this,Dd.prototype)},Eya=function(){hK.apply(this,arguments)},Eid=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P;
return g.Q(function(N){if(N.K==1)return y=g.j5("main_downloads_library_id","mainDownloadsLibraryEntity"),q=g.j5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.p(N,tK(k,{mode:"readonly",TE:!0},function(F){return g.NY.all([EL(F,y,"mainDownloadsLibraryEntity"),EL(F,q,"mainDownloadsListEntity")])}),2);
e=N.D;f=g.A(e);H=f.next().value;B=f.next().value;Z=H;z=B;Z||(Z={id:y});Y=g.A(a);for(r=Y.next();!r.done;r=Y.next())if(W=r.value,W===g.nw){if(Z.smartDownloadsList)return N.return();Z.smartDownloadsList=W}else if(m=g.Yx(W).entityType,T={},m==="mainPlaylistEntity"?T.playlistItem=W:m==="mainVideoEntity"&&(T.videoItem=W),!g.SV(T)){O=void 0;if((O=z)==null?0:O.downloads){x=!1;V=g.A(z.downloads);for(l=V.next();!l.done;l=V.next())if(P=l.value,P.playlistItem===W||P.videoItem===W){x=!0;break}x||z.downloads.push(T)}else z=
{id:q,downloads:[T]};Z.downloadsList=q}return N.return({mainDownloadsLibraryEntity:Z,mainDownloadsListEntity:z})})},tK=function(k,a,y){var q,e,f,H;
return g.Q(function(B){if(B.K==1)return g.p(B,aGK(k.token),2);if(B.K!=3)return q=B.D,g.p(B,g.n8(q,["EntityStore","EntityAssociationStore"],a,function(Z){e=new Ky9(Z,k.K);return y(e)}),3);
f=B.D;e&&(H=e.j,Object.keys(H).length>0&&(k.channel.postMessage(H),AE9(k,H)));return B.return(f)})},kY0=function(){hK.apply(this,arguments)},ao9=function(){hK.apply(this,arguments)},y22=function(){hK.apply(this,arguments)},CXX=function(k){var a;
return g.Q(function(y){if(y.K==1){a=k.mutations;if(!a||a.length<=0)return y.return();if(g.we){var q={type:"ENTITY_LOADED"};a!==void 0&&(q.payload=a);g.we.dispatch(q)}return g.p(y,VDG(a),2)}a.length=0;g.wg(y)})},qpV=function(k){var a;
return g.Q(function(y){a=g.v(k.frameworkUpdates,MP);return k.frameworkUpdates&&a?g.p(y,CXX(a),0):y.return()})},Ht9=function(k,a,y){var q,e,f,H,B,Z,z,Y,r,W,m,T;
return g.Q(function(O){switch(O.K){case 1:q=a.retryScheduleIndex+2===3;if(y.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){O.X5(2);break}if(y.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){O.X5(0);break}NBX(a,y,q);if(y.K&&a.retryScheduleIndex+1<3)return g.p(O,ev1(k,[a]),0);f=((e=y)==null?0:e.D)?y.D:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";H={entityKey:a.action.entityKey,failureReason:f};B=void 0;g.ry(k.B)?B="mainVideoDownloadStateEntity":g.mi(k.B)&&(B="musicTrackDownloadMetadataEntity");
if(!B||!y.downloadState){O.X5(7);break}Z=g.Yx(a.action.entityKey).entityId;return g.p(O,Rj(Z,B,k.D,y.downloadState),7);case 7:Ty(k.G,H);if(y.downloadState==="DOWNLOAD_STATE_FAILED"&&k.B.W("html5_auto_retry_failed_pde_actions")){O.X5(0);break}u1("Orchestration result is not retryable, deleting action");return g.p(O,$jd(k.D,Zd(a).key),0);case 2:z=void 0;try{z=(Y=y.L)==null?void 0:Y.map(function(x){return k.createAction(x,a)})}catch(x){return NBX(a,y,q),r={entityKey:a.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Ty(k.G,r),u1("Orchestration subactions creation error",x),O.return()}NBX(a,y,q,z);if(!z){O.X5(12);break}W=z.map(function(x){return Zd(x)});
m=0;case 13:if(!(m<z.length)||k.X){O.X5(15);break}return g.p(O,tK(k.D,{mode:"readwrite",TE:!0},function(x){var V=[];V.push(fzV(x,W.slice(m,m+10),"offlineOrchestrationActionWrapperEntity"));return g.NY.all(V)}),16);
case 16:m+=10;O.X5(13);break;case 15:if(k.X)return k.X=!1,O.return();case 12:return T=Zd(a),g.p(O,$jd(k.D,T.key),17);case 17:Cr2(a,4),g.wg(O)}})},dj9=function(k,a,y){var q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl;
return g.Q(function(fG){q=[];e=new Set;if(y.length)for(f=g.A(y),H=f.next();!H.done;H=f.next())if(B=H.value,Z=void 0,(Z=B.downloads)==null?0:Z.length)for(z=g.A(B.downloads),Y=z.next();!Y.done;Y=z.next())r=Y.value,r.videoItem&&(W=g.Yx(r.videoItem).entityId,e.add(W));if(k.videos){m=g.A(k.videos);for(T=m.next();!T.done;T=m.next())O=T.value,x=JSON.parse(g.Yx(O).entityId),x.videoId&&!e.has(x.videoId)&&q.push(x.videoId);V=g.A(a);for(l=V.next();!l.done;l=V.next())if(P=l.value,P.key!==k.key&&(N=P.videos))for(F=
g.A(N),t=F.next();!t.done;t=F.next())M=t.value,ea=JSON.parse(g.Yx(M).entityId),ea.videoId&&(Zl=q.indexOf(ea.videoId),Zl!==-1&&q.splice(Zl,1))}return fG.return(q)})},rA=function(k,a,y,q,e){var f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea;
return g.Q(function(Zl){switch(Zl.K){case 1:return f=g.j5(k,"musicTrack"),H=g.j5(k,"transfer"),g.p(Zl,tK(a,{mode:"readonly",TE:!0},function(fG){return g.NY.all([EL(fG,f,"musicTrack"),EL(fG,H,"transfer"),wA(fG,"musicTrack"),wA(fG,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=Zl.D;Z=g.A(B);z=Z.next().value;Y=Z.next().value;r=Z.next().value;W=Z.next().value;m=z;T=Y;O=r;x=W;if(!m){Zl.X5(3);break}return g.p(Zl,e8T(m,O),4);case 4:return V=Zl.D,g.p(Zl,lR(V),3);case 3:l=[];P=g.A(x);for(N=P.next();!N.done;N=P.next())F=N.value,t=g.Yx(F.key).entityId,M=VZ(F),ea=g.Yx(M.action.entityKey).entityId,t!==k&&ea!==k||bR(y,F.actionProto)||l.push(F.key);return g.p(Zl,tK(a,{mode:"readwrite",TE:!0},function(fG){var r4=l.map(function(a3){return KQ(fG,a3)});
r4.push(KQ(fG,f,{eU:!0}));return g.NY.all(r4)}),6);
case 6:fa(T),e&&NP(e),Ty(q,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.wg(Zl)}})},oyX=function(k,a){var y,q,e,f,H,B,Z,z;
return g.Q(function(Y){switch(Y.K){case 1:return y=g.SQ(),q={context:g.Dn(),videoPlaybackPositionEntities:k,lastSyncTimestampUsec:a},e=g.Ok(Byr),g.p8(Y,2),H={t5:!0},g.p(Y,g.Qe(y,q,e,void 0,H),4);case 4:f=Y.D;g.St(Y,3);break;case 2:B=g.vh(Y);if(B instanceof g.lu)throw Z="VPPS network manager error: "+B.message,u1(Z,B),Error(Z);u1("VPPS fetch request error",B);throw Error("VPPS fetch request error");case 3:z=vu(f);if(f)z!==void 0&&JG(z,"position sync");else throw u1("Network request failed for position sync"),
Error("Network request failed for position sync");return Y.return(f)}})},Ztd=function(){hK.apply(this,arguments)},zva=function(){hK.apply(this,arguments)},YpT=function(k,a){var y,q,e;
return g.Q(function(f){switch(f.K){case 1:y=Nw(a);g.p8(f,2);q=g.Yx(a.entityKey).entityId;if(q==="!*$_ALL_ENTITIES_!*$")return g.p(f,$WK(k.K),5);e=g.j5(q,"videoPlaybackPositionEntity");return g.p(f,$jd(k.K,e),5);case 5:g.St(f,3);break;case 2:return g.vh(f),f.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},EPV=function(k,a,y,q){var e,f,H,B,Z,z,Y,r,W;
return g.Q(function(m){if(m.K==1)return e=g.j5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),f=new Map,g.p(m,tK(k,{mode:"readwrite",TE:!0},function(T){var O=wA(T,"transfer"),x=wA(T,"offlineOrchestrationActionWrapperEntity"),V=wA(T,"videoDownloadContextEntity"),l=EL(T,e,"mainDownloadsListEntity");return g.NY.all([O,x,V,l]).then(function(P){P=g.A(P);var N=P.next().value;var F=P.next().value;var t=P.next().value;var M=P.next().value;P=r29.map(function(Zl){return hi9(T,Zl)});
F=g.A(F);for(var ea=F.next();!ea.done;ea=F.next())ea=ea.value,bR(a,ea.actionProto)||P.push(KQ(T,ea.key,{eU:!0}));M&&(M.downloads=[],P.push(kM(T,M,"mainDownloadsListEntity")));if(t)for(t=g.A(t),M=t.next();!M.done;M=t.next())M=M.value,F=g.Yx(M.key).entityId,F=g.j5(F,"transfer"),f.set(F,M.offlineModeType);return g.NY.all(P).then(function(){return N})})}),2);
H=m.D;B=g.A(H);for(Z=B.next();!Z.done;Z=B.next())z=Z.value,fa(z,f.get(z.key)),Y=g.Yx(z.key).entityId,r={videoId:Y,offlineDeleteReason:q,cotn:z.cotn,offlineModeType:f.get(z.key)},NP(r),W=g.j5(Y,"mainVideoEntity"),Ty(y,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.p(m,jw0(),0)})},vc=function(k,a,y,q,e,f){return new Mw(a?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Nw(k),y,q,e,f)},Xg=function(k){this.K=k},MQT=function(k,
a){var y,q,e,f,H,B,Z;
return g.Q(function(z){switch(z.K){case 1:if(a.length===0)return z.return([]);y=a.map(function(Y){return g.j5(Y,"transfer")});
return g.p(z,j4(k.K,"transfer",y),2);case 2:q=z.D;e=q.filter(it9).map(function(Y){return g.Yx(Y.key).entityId});
f=a.filter(function(Y){return e.indexOf(Y)===-1});
if(f.length===0)return z.return([]);H=g.A(f);B=H.next();case 3:if(B.done){z.X5(5);break}Z=B.value;return g.p(z,OT2(Z),4);case 4:B=H.next();z.X5(3);break;case 5:return z.return(f)}})},Wq9=function(){hK.apply(this,arguments)},cu=function(k,a){var y=g.bz(a);
if(y===1||y===0)return Promise.resolve();(y=hA9(k,a))&&y.stopVideo();k.j=0;return OT2(a)},Sp0=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x;
return g.Q(function(V){switch(V.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey),e=q.entityId,g.p(V,Fh(k.K,a.entityKey,"musicTrack"),2);case 2:f=V.D;if(!f){H=void 0;V.X5(3);break}return g.p(V,Fh(k.K,f.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:H=V.D;case 3:B=H;if(!f||!B)return V.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));z=g.v(a.actionMetadata,mj1);g.p8(V,5);return g.p(V,R2T(k,e,B.addedTimestampMillis,(Y=z)==null?void 0:Y.track,(r=z)==null?void 0:r.albumRelease),
7);case 7:m=Number(((W=a.actionMetadata)==null?void 0:W.priority)||0)+1;Z=cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e,"playbackData",m,TyT);g.St(V,6);break;case 5:T=g.vh(V);if(!(T instanceof Error&&T.message==="No data")){if(T instanceof Error&&T.message==="Empty response body")u1(T.message);else return O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.HG&&T.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,O,x));V.X5(6);break}return g.p(V,rA(e,k.K,a,k.j),6);case 6:return V.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Z?[Z]:void 0))}})},Dja=function(k,a){a.length!==0&&a.forEach(function(y){y=VZ(y);
y.retryScheduleIndex<3&&UjT(k.K,[y])})},uwG=function(k,a){var y,q,e,f,H;
return g.Q(function(B){if(B.K==1)return y=g.Yx(a.key),q=y.entityId,e=g.j5(q,"playbackData"),g.p(B,Fh(k.D,e,"playbackData"),2);f=B.D;if((H=f)==null?0:H.playerResponseJson)return B.return(JSON.parse(f.playerResponseJson));throw Error("No PlayerResponse found");})},Ot9=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W;
return g.Q(function(m){if(m.K==1)return y=[],g.p(m,tK(k.K,{mode:"readonly",TE:!0},function(T){var O=[],x=a.offlineVideoStreams;if(x){x=g.A(x);for(var V=x.next();!V.done;V=x.next())O.push(EL(T,V.value,"offlineVideoStreams"))}return g.NY.all(O)}),2);
if(q=m.D)for(e=g.A(q),f=e.next();!f.done;f=e.next())if(H=f.value,B=void 0,(B=H)==null?0:B.streamsProgress)for(Z=H.streamsProgress,z=0;z<Z.length;z++)Y=Z[z],r=JSON.parse(Y.formatStreamBytes),W={itag:r.itag,lmt:r.lastModified,xtags:r.xtags},y.push(W);return m.return(y)})},$SV=function(k,a){var y=k.K.objectStore("EntityAssociationStore");
return y.index("byParentEntityKey").getAll(IDBKeyRange.only(a)).then(function(q){var e=[];q=g.A(q);for(var f=q.next();!f.done;f=q.next())f=f.value,e.push(y.index("byChildEntityKey").getAll(f.childEntityKey));return g.NY.all(e)}).then(function(q){var e=[];
q=g.A(q);for(var f=q.next();!f.done;f=q.next())f=f.value,f.length===1&&e.push(f[0].childEntityKey);return e})},Qw9=function(){this.actions=[]},wUG=function(){hK.apply(this,arguments)},lGT=function(k){var a;
k=(a=k.options)==null?void 0:a.persistenceOption;return k==="ENTITY_PERSISTENCE_OPTION_PERSIST"||k==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},xj0=function(k,a){this.api=k;
this.K=a;this.logger=new g.ci("woffle");this.D=!1;this.Sw={xE:this.xE}},Rvd=function(k){return g.Q(function(a){k.api.qE("onOrchestrationBecameLeader");
return g.p(a,k.LB(),0)})},btr=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3;
return g.Q(function(OZ){switch(OZ.K){case 1:return y=Nw(a),q=[],g.p(OZ,pa.getInstance(),2);case 2:e=OZ.D;if(!e){OZ.X5(3);break}return g.p(OZ,e.get("sdois"),4);case 4:return f=OZ.D,g.p(OZ,(B=e)==null?void 0:B.get("lmqf"),5);case 5:H=OZ.D;case 3:g.p8(OZ,6);if(f===void 0)throw Error("prefStorage or opt-in state is undefined");Z=[];if(f){OZ.X5(8);break}return g.p(OZ,UWX(k.K),9);case 9:Z=OZ.D,Z.reverse();case 8:if(!Z.length){OZ.X5(10);break}z=g.A(Z);Y=z.next();case 11:if(Y.done){OZ.X5(10);break}r=Y.value;
if(!r){OZ.X5(12);break}W=g.Yx(r).entityId;return g.p(OZ,LQ(k.K,W),14);case 14:return m=OZ.D,m.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.p(OZ,IS(W,k.K,{entityKey:r,actionType:a.actionType},k.j,m),12);case 12:Y=z.next();OZ.X5(11);break;case 10:return g.p(OZ,GYK(f,(T=H)!=null?T:"SD"),16);case 16:return O=OZ.D,g.p(OZ,qpV(O),17);case 17:x=qJa(O);if(!k.B.W("woffle_enable_main_downloads_library")){OZ.X5(18);break}if(f){OZ.X5(19);break}return g.p(OZ,KK1(k.K,g.nw),19);case 19:return g.p(OZ,
lo0(k.K,[g.nw]),18);case 18:if((V=x)==null?0:V.length)for(l=g.A(x),P=l.next();!P.done;P=l.next())if(F=N=P.value,t=F.actionType,M=F.entityKey,ea=F.actionMetadata,t&&M&&ea&&!g.v(ea,VI0)){t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(ea.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Zl=g.v(N.actionMetadata,Xh))Zl.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",N.actionMetadata=Object.assign({},N.actionMetadata,{mainVideoEntityActionMetadata:Zl});q.push(N)}g.St(OZ,
7);break;case 6:return fG=g.vh(OZ),r4="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a3="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",fG instanceof g.HG&&fG.type==="QUOTA_EXCEEDED"&&(r4="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a3="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),OZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,r4,a3));case 7:return OZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,q))}})},um1=function(k,a){var y,
q,e,f;
return g.Q(function(H){if(H.K==1)return y=g.Yx(a.entityKey).entityId,q=g.j5(y,"videoDownloadContextEntity"),g.p(H,Fh(k.K,q,"videoDownloadContextEntity"),2);e=H.D;return(f=e)!=null&&f.offlineModeType?H.return({offlineModeType:e.offlineModeType}):H.return(void 0)})},sw9=function(k,a){var y=gjK[k.transferState],q=gjK[a.transferState];
return y!==q?y-q:Number(k.enqueuedTimestampMs)-Number(a.enqueuedTimestampMs)},PN9=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1,p1,oV,b,Yh,Gb,G2,qQ,l9,w,yH,lz,EQ,N9,X8,q9,eA,MY,R,D,G,n,c,B7,X,K,J,lo,S9,d4,ZK,c7,GD,K7,RV,u9,VH,QX;
return g.Q(function(sZ){switch(sZ.K){case 1:return y=Nw(a),q=a.entityKey,e=g.Yx(q).entityId,f=[],H=!1,e==="!*$_ALL_ENTITIES_!*$"?(H=!0,g.p(sZ,j4(k.K,"musicPlaylist"),5)):g.p(sZ,Fh(k.K,q,"musicPlaylist"),4);case 4:(B=sZ.D)&&f.push(B);sZ.X5(3);break;case 5:f=sZ.D;case 3:if((Z=f)==null||!Z.length)return sZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));z=g.v(a.actionMetadata,A29);r=(Y=z)==null?void 0:Y.autoSync;W=[];T=m=!0;O=!1;x=void 0;if(!H&&r===!1){sZ.X5(6);break}g.p8(sZ,7);return g.p(sZ,
pU0(0,!!r,!0,f),9);case 9:W=sZ.D;g.St(sZ,8);break;case 7:V=g.vh(sZ);if(!(V instanceof Error&&V.message==="No data")){V instanceof Error&&V.message==="Empty response body"&&u1(V.message);sZ.X5(8);break}return e==="!*$_ALL_ENTITIES_!*$"?g.p(sZ,YM(k.K,a,k.j),8):g.p(sZ,gA(e,"musicPlaylist",k.K,a,k.j),8);case 8:if(!W.length||!H&&W[0].playlistId!==e)return sZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));case 6:if(H){l=[];P=g.A(W);for(N=P.next();!N.done;N=P.next())F=N.value,F.upToDate||
r&&!F.shouldAutoSyncMetadata||!F.playlistId||(t={autoSync:r},l.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",F.playlistId,"musicPlaylist",0,AG,{musicPlaylistEntityActionMetadata:t})));return sZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,l))}W.length&&(M=W[0],O=!!M.upToDate,r&&(m=(ea=M.shouldAutoSyncMetadata)!=null?ea:!0,T=(Zl=M.shouldAutoSyncVideos)!=null?Zl:!0,M.checkInSeconds&&(x=M.checkInSeconds)));if(O||!m)return sZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));fG=[];r4=f[0];a3=void 0;if(!r4.downloadMetadata){sZ.X5(15);break}return g.p(sZ,Fh(k.K,r4.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:OZ=sZ.D,a3=Number((ka=(I3=OZ)==null?void 0:I3.addedTimestampMillis)!=null?ka:"0")/1E3;case 15:return g.p8(sZ,17),g.p(sZ,QzK(k,e,(Ya=a3)==null?void 0:Ya.toString(),x),19);case 19:fG=sZ.D;g.St(sZ,18);break;case 17:CG=g.vh(sZ);if(!(CG instanceof Error&&CG.message==="No data")){if(CG instanceof Error&&CG.message==="Empty response body")u1(CG.message);
else return AO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K1="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",CG instanceof g.HG&&CG.type==="QUOTA_EXCEEDED"&&(AO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K1="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,AO,K1));sZ.X5(18);break}return g.p(sZ,gA(e,"musicPlaylist",k.K,a,k.j),18);case 18:if(!T)return sZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));p1=[];oV=new Map;if((b=fG)==null?0:b.length)for(Yh=g.A(fG),Gb=Yh.next();!Gb.done;Gb=Yh.next())G2=Gb.value,qQ=G2.offlineVideoData,l9=void 0,((l9=qQ)==null?0:l9.videoId)&&oV.set(qQ.videoId,qQ);w=new Map;yH=[];if((lz=r4)==null?0:(EQ=lz.tracks)==null?0:EQ.length)for(N9=g.A(r4.tracks),X8=N9.next();!X8.done;X8=N9.next())if(q9=X8.value,eA=g.Yx(q9).entityId)oV.has(eA)?(w.set(eA,oV.get(eA)),oV.delete(eA)):yH.push(eA);R=Number(((MY=a.actionMetadata)==null?void 0:MY.priority)||0)+1;D=g.A(oV.entries());for(G=
D.next();!G.done;G=D.next())n=G.value,c=g.A(n),B7=c.next().value,X=c.next().value,K=B7,J=X,p1.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K,"musicTrack",R,AG,Hu(a,J)));lo=g.A(w.entries());for(S9=lo.next();!S9.done;S9=lo.next())d4=S9.value,ZK=g.A(d4),c7=ZK.next().value,GD=ZK.next().value,K7=c7,RV=GD,p1.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K7,"musicTrack",R,AG,Hu(a,RV)));u9=g.A(yH);for(VH=u9.next();!VH.done;VH=u9.next())QX=VH.value,p1.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
QX,"musicTrack",0,AG));return sZ.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,p1))}})},ijV=function(k){if(!k.j&&!k.K){var a=V$0();
if(a){k.j=!0;var y=g.BG("OfflineLockManager");a.request("woffle_orchestration_leader:"+y,{},function(){var q,e;return g.Q(function(f){switch(f.K){case 1:return g.p8(f,2),k.D=new g.hu,k.K=!0,k.j=!1,g.p(f,k.V(),4);case 4:return g.p(f,k.D.promise,5);case 5:g.St(f,0);break;case 2:q=g.vh(f),k.JB(),q instanceof Error&&(e=q,e.args=[{name:"WoLockManagerError",hg:q.name}],g.kh(e)),g.wg(f)}})})}}},njK=function(){hK.apply(this,arguments)},J2T=function(k){return gjK[k.transferState]!==void 0},NyK=function(k,
a){var y;
return g.Q(function(q){return a.length?(y=rMK(),g.jb(y,JK,{isEnqueuedForExpiredStreamUrlRefetch:!0}),k.api.lj("qrd",{v:a.length}),q.return(zy(k,a,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y))):q.return([])})},La=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!k.entityKey},VQd=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},lid=function(k,a){k=g.A(k.actions);
for(var y=k.next();!y.done;y=k.next())if(y.value.actionId===a)return!0;return!1},xv9=function(k,a,y,q,e){var f;
return g.Q(function(H){return H.K==1?(e||(e=Date.now().toString()),f={id:g.j5(y,"musicTrackDownloadMetadataEntity"),playbackData:g.j5(y,"playbackData"),addedTimestampMillis:e,videoDownloadContextEntity:g.j5(y,"videoDownloadContextEntity")},q&&(a.albumRelease=q.id),g.p(H,tK(k.K,{mode:"readwrite",TE:!0},function(B){var Z=[],z=kM(B,f,"musicTrackDownloadMetadataEntity");Z.push(z);z=kM(B,a,"musicTrack");Z.push(z);q&&(B=kM(B,q,"musicAlbumRelease"),Z.push(B));return g.NY.all(Z)}),2)):H.K!=3?g.p(H,Rj(y,"musicTrackDownloadMetadataEntity",
k.K,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):H.return({musicTrackEntity:a,
VZ:q})})},GYK=function(k,a){var y,q,e,f,H,B,Z,z,Y,r;
return g.Q(function(W){switch(W.K){case 1:return y=g.SQ(),g.p(W,dA(),2);case 2:q=W.D;if(!q){W.X5(3);break}return g.p(W,usr(q),4);case 4:e=W.D;case 3:var m=e;f={context:g.Dn(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:k},offlineClientState:m,clientStateRequestData:{preferredFormatType:a}}}};H=g.Ok(vjT);g.p8(W,5);Z={t5:!0};return g.p(W,g.Qe(y,f,H,void 0,Z),7);case 7:B=W.D;g.St(W,6);break;case 5:z=g.vh(W);if(z instanceof g.lu)throw Y=
"DPS network manager error for smart downloads: "+z.message,u1(Y,z),Error(Y);u1("DPS fetch request error for smart downloads",z);throw Error("DPS fetch request error for smart downloads");case 6:r=vu(B);if(B)r!==void 0&&JG(r,"smart downloads");else throw u1("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return W.return(B)}})},qP=function(k,a){var y,q,e;
return g.Q(function(f){if(f.K==1)return g.p(f,Fh(k.D,g.j5(a,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);y=f.D;return f.return((e=(q=y)==null?void 0:q.offlineModeType)!=null?e:void 0)})},lD9=function(k){var a=[],y=k.videos;
y&&y.length>0&&a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:y[0].offlineVideoData.thumbnail}}});if((k=k.additionalMetadadatas)&&k.length>0)for(k=g.A(k),y=k.next();!y.done;y=k.next()){var q=y.value.offlineBundleItemPlaylistData,e=void 0;y=(e=q)==null?void 0:e.style;e=void 0;q={collageThumbnail:{coverThumbnail:(e=q)==null?void 0:e.coverThumbnail}};switch(y){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:q});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:q})}}return a},ojT=function(k,a){var y,q,e,f,H,B,Z,z;
return g.Q(function(Y){switch(Y.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey).entityId,g.p8(Y,2),g.p(Y,pa.getInstance(),4);case 4:e=Y.D;if(!e)throw Error("prefStorage is undefined");return g.p(Y,e.get("psi"),5);case 5:f=Y.D;H=g.v(a.actionMetadata,FqG);if(((B=f)==null?void 0:B.isPaused)!==!1||(Z=H)==null||!Z.lastPlaybackPositionSeconds){Y.X5(6);break}z={key:g.j5(q,"videoPlaybackPositionEntity"),videoId:q,lastPlaybackPositionSeconds:H.lastPlaybackPositionSeconds};return g.p(Y,oS(k.K,z,"videoPlaybackPositionEntity"),
6);case 6:g.St(Y,3);break;case 2:return g.vh(Y),Y.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},YM=function(k,a,y){var q,e,f,H,B,Z,z;
return g.Q(function(Y){if(Y.K==1)return g.p(Y,tK(k,{mode:"readwrite",TE:!0},function(r){var W=wA(r,"transfer"),m=wA(r,"offlineOrchestrationActionWrapperEntity");return g.NY.all([W,m]).then(function(T){T=g.A(T);var O=T.next().value;var x=T.next().value;T=CN9.map(function(N){return hi9(r,N)});
x=g.A(x);for(var V=x.next();!V.done;V=x.next()){V=V.value;var l=g.Yx(V.actionProto.entityKey).entityType==="musicTrack",P=V.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";bR(a,V.actionProto)||l&&(!l||P)||T.push(KQ(r,V.key,{eU:!0}))}return g.NY.all(T).then(function(){return O})})}),2);
q=Y.D;e=g.A(q);for(f=e.next();!f.done;f=e.next())H=f.value,fa(H),B=g.Yx(H.key).entityId,Z={videoId:B,offlineDeleteReason:void 0,cotn:H.cotn},NP(Z),z=g.j5(B,"musicTrack"),Ty(y,{entityKey:z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.p(Y,jw0(),0)})},ev1=function(k,a){var y,q,e;
return g.Q(function(f){y=g.A(a);for(q=y.next();!q.done;q=y.next()){e=q.value;var H=void 0,B=void 0,Z=((B=e.action)==null?void 0:(H=B.actionMetadata)==null?void 0:H.retryScheduleIntervalsInSeconds)||[1,2,4];H=1;e.retryScheduleIndex<Z.length&&(H=Z[e.retryScheduleIndex]);e.K=H*1E3+Date.now();e.retryScheduleIndex++}return g.p(f,hv9(k,a),0)})},MI9=function(){},vu=function(k){var a;
return(a=k.errorMetadata)==null?void 0:a.status},XUr=function(k,a,y){a=vP0(k.B,y.cotn,a);
y=g.s3(a);return g.Odl(a,y,k.B)},c29=function(){hK.apply(this,arguments)},Vl9=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m;
return g.Q(function(T){y=[];q=Infinity;e=4E3;f=g.A(a);for(H=f.next();!H.done;H=f.next())B=H.value,Z=Number(B.enqueueTimeSec),z=LqV(Z),Y=B.retryScheduleIndex,r=Y!=null&&Y>0,z>0&&r?(q=Math.min(q,Z),e=Math.min(z,e)):y.push(B);isFinite(q)&&(!k.j.isActive()||q<k.V)&&(k.V=q,k.j.start(e));k.N.Ca()||(W=y.length,y=y.filter(function(O){var x;O=((x=O.actionProto)==null?void 0:x.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Io2.includes(O)}),m=y.length<W,!k.j.isActive()&&m&&k.j.start(1));
y.length>0&&Dja(k,y);return g.p(T,sKr(k),0)})},Bu=function(k,a,y,q,e,f,H,B,Z,z,Y){this.entityType=k;
this.actionId=a;this.action=y;this.parentActionId=q;this.rootActionId=e===void 0?a:e;this.childActionIds=f;this.prereqActionId=H;this.postreqActionIds=B;this.hasChildActionFailed=z;this.retryScheduleIndex=0;this.K=Y||Date.now();this.retryScheduleIndex=Z||0},tI1=function(k,a){this.K=k;
this.B=a},Ejd=function(){hK.apply(this,arguments)},Kq9=function(){hK.apply(this,arguments)},Lyr=function(k,a){k=k instanceof Dd?k:a(k);
g.kh(k);throw k;},kVX=function(){hK.apply(this,arguments)},Ij=function(){},yhr=function(k){var a=aZ9[k];
if(a)return a;g.vn(new g.s_("Entity model not found.",{entityType:k}))},lR=function(k){var a,y;
return g.Q(function(q){if(q.K==1)return g.p(q,Iz2(),2);if(q.K!=3){a=q.D;if(!a)throw Error("Cache API not supported");return k.length?g.p(q,a.open("yt-player-local-img"),3):q.return()}y=q.D;return g.p(q,Promise.all(k.map(function(e){return y.delete(e)})),0)})},qe9=function(k,a){k.K&&(k.N=a,Pu(k))},efr=function(k,a){return k!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||a?k==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&a?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
k:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},$39=function(k){var a,y,q,e,f,H,B,Z;
return g.Q(function(z){switch(z.K){case 1:return a=g.SQ(),y=lz2(k),q=g.Ok(fZ2),g.p8(z,2),f={t5:!0},g.p(z,g.Qe(a,y,q,void 0,f),4);case 4:e=z.D;g.St(z,3);break;case 2:H=g.vh(z);if(H instanceof g.lu)throw B="offlinePlaylistSyncCheck network manager error: "+H.message,u1(B,H),Error(B);u1("offlinePlaylistSyncCheck fetch request error",H);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:Z=vu(e);if(!e)throw u1("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(Z!==void 0)JG(Z,"playlist sync");else if(!e.offlinePlaylistSyncCheckDatas||!e.offlinePlaylistSyncCheckDatas.length)throw u1("No data for playlist sync"),Error("No data for playlist sync");return z.return(e.offlinePlaylistSyncCheckDatas.map(function(Y){return Y.offlinePlaylistSyncCheckData}))}})},aj=function(k){if(!k||!k.thumbnails)return[];
var a=[];k=g.A(k.thumbnails);for(var y=k.next();!y.done;y=k.next())y=y.value,y.url&&a.push(y.url);return a},HvK=function(){nQ.apply(this,arguments)},d30=function(k,a){var y,q,e;
return g.Q(function(f){switch(f.K){case 1:return g.p8(f,2),g.p(f,GYK(k,a),4);case 4:return q=f.D,g.p(f,qpV(q),5);case 5:y=qJa(q);g.St(f,3);break;case 2:e=g.vh(f),u1("getAndProcessSmartDownloadsResponse request or processing error",e);case 3:return f.return(y)}})},Am1=function(k,a){return k.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(a))},MlX=function(k){var a,y;
return g.Q(function(q){if(q.K==1)return g.p(q,j4(k.D,"transfer"),2);a=q.D;y=a.filter(J2T).sort(sw9);return y.length===0?q.return():q.return(y[0])})},BcK=function(){hK.apply(this,arguments)},qi9=function(k){var a,y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V;
return g.Q(function(l){switch(l.K){case 1:if(k.L)throw Error("Already processing an action");if(k.xs())return l.return();a=k.K.actions.shift();qe9(k.Kw,!a);if(a===void 0)return l.return();a.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&a.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&dWG(k.K,a.actionId);y="";a.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&a.rootActionId===a.actionId&&(y=a.actionId);q=[a];k.L=q;if(e=k.Lw[a.entityType]){l.X5(2);break}k.L=
void 0;return g.p(l,qi9(k),3);case 3:return l.return();case 2:f=g.A(q);for(H=f.next();!H.done;H=f.next())B=H.value,Cr2(B,2);g.p8(l,4,5);return g.p(l,qST(e,q.map(function(P){return P.action})),7);
case 7:Z=l.D,z=g.A(q),Y=z.next();case 8:if(Y.done){l.X5(10);break}r=Y.value;W=Z.get(r.action);return g.p(l,Ht9(k,r,W),9);case 9:Y=z.next();l.X5(8);break;case 10:dWG(k.K,y);case 5:g.k8(l);k.L=void 0;g.aK(l,6);break;case 4:return m=g.vh(l),u1("Orchestration error",m),g.p8(l,12),g.p(l,ev1(k,q),14);case 14:g.St(l,5);break;case 12:T=g.vh(l);u1("Orchestration retry error",T);O=g.A(q);for(x=O.next();!x.done;x=O.next())V=x.value,V.retryScheduleIndex<3&&UjT(k.K,[V]);l.X5(5);break;case 6:return g.p(l,qi9(k),
0)}})},ZvX=function(k){return new g.Y8(function(a,y){var q=k.length,e=[];
if(q)for(var f=function(z){y(z)},H=function(z,Y){q--;
e[z]=Y;q==0&&a(e)},B,Z=0;Z<k.length;Z++)B=k[Z],g.esH(B,g.Iw(H,Z),f);
else a(e)})},fzV=function(k,a,y){a=a.map(function(q){return kM(k,q,y)});
return g.NY.all(a)},OK1=function(){var k,a,y;
return g.Q(function(q){if(q.K==1)return g.p8(q,2),g.p(q,g.g2(),4);if(q.K!=2){k=q.D;if(!k||!g.$U()||typeof g.DP.BroadcastChannel==="undefined")return q.return();a=new rEr;return q.return(new tG(k,a))}y=g.vh(q);y instanceof Error&&g.kh(y);return q.return()})},Jm9=function(k,a,y,q){q={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!q};a&&y&&(a=Math.floor(a/1024).toFixed(),y=Math.floor(y/1024).toFixed(),q.alreadyDownloadedKbytes=a,q.totalFetchedKbytes=a,q.totalContentKbytes=y);e4(q,k)},g89=function(k){var a;
return g.Q(function(y){if(y.K==1)return g.p(y,j4(k.D,"offlineOrchestrationActionWrapperEntity"),2);a=y.D;return g.p(y,Vl9(k,a),0)})},zfr=function(k,a){var y,q,e,f,H,B,Z,z,Y,r;
return g.Q(function(W){switch(W.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey).entityId,g.p(W,tK(k.K,{mode:"readonly",TE:!0},function(m){var T=EL(m,a.entityKey,"transfer");m=EL(m,g.j5(q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.NY.all([T,m])}),2);
case 2:e=W.D;f=g.A(e);H=f.next().value;B=f.next().value;Z=H;z=B;if(!Z||Z.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return W.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.p8(W,3);Z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.p(W,oS(k.K,Z,"transfer"),5);case 5:Y=g.Yx(Z.key).entityId;Q59({videoId:Y,yI:Z,offlineModeType:(r=z)==null?void 0:r.offlineModeType});g.St(W,4);break;case 3:return g.vh(W),W.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return W.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},Yer=function(k){k.K&&(k.X=!0,Pu(k))},Ky9=function(k,a){this.K=k;
this.D=a;this.j={}},e4=function(k,a){var y=a.videoId;
var q=a.yI;a=a.offlineModeType;k.encryptedVideoId=y;k.cotn=q==null?void 0:q.cotn;k.offlineabilityFormatType=q==null?void 0:q.maximumDownloadQuality;var e;k.isRefresh=(e=q==null?void 0:q.isRefresh)!=null?e:!1;var f;k.softErrorCount=(f=q==null?void 0:q.transferRetryCount)!=null?f:0;k.offlineModeType=a!=null?a:"OFFLINE_NOW";(k.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&k.statusType==="UNKNOWN_STATUS_TYPE"||!k.transferStatusType&&!k.statusType)&&g.vn(Error("Woffle unknown transfer status"));
g.EW("offlineTransferStatusChanged",k)},rhG=function(){hK.apply(this,arguments)},jgX=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l;
return g.Q(function(P){switch(P.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey),e=q.entityId,f=[],g.p8(P,2),g.p(P,wQ9(k,e),4);case 4:f=P.D;if(!(k.B.W("woffle_enable_main_downloads_library")&&((H=f)==null?0:H.length))){P.X5(5);break}return g.p(P,lo0(k.K,[a.entityKey]),5);case 5:g.St(P,3);break;case 2:return B=g.vh(P),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.HG&&B.type==="QUOTA_EXCEEDED"?(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):u1("Playlist add error"),P.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Z,z));case 3:Y=[];if(!k.B.W("html5_offline_prevent_redownload_downloaded_video")){P.X5(7);break}return g.p(P,BN2(k.K,"mainVideoEntity",f),8);case 8:f=P.D;case 7:if((r=f)==null?0:r.length)for(W=g.A(f),m=W.next();!m.done;m=W.next())if(T=m.value,O=T.offlineVideoData,x=void 0,(x=O)==null?0:x.videoId)V=void 0,l=Number(((V=a.actionMetadata)==null?void 0:V.priority)||
0)+1,Y.push(cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O.videoId,"mainVideoEntity",l,iR,xS9(a,O,e)));return P.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Y))}})},ivK=function(){hK.apply(this,arguments)},m3T=function(k){var a,y,q,e,f;
g.Q(function(H){switch(H.K){case 1:if(!k.K)return QZ(k,"onTransferComplete"),H.return();a=k.K;k.L.stop();if(!a||!k.X){H.X5(2);break}y=vP0(k.api.Z(),a.cotn,k.X);return g.p(H,FKV(k,y),2);case 2:return g.p(H,xM(k,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:e=((q=a)==null?0:q.key)?g.Yx(a.key).entityId:"";if(!e||!k.j){H.X5(5);break}return g.p(H,Rj(e,k.j,k.D,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.p(H,WN9(k.D,e),7);case 7:return g.p(H,qP(k,e),8);case 8:f=H.D,e4({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:e,yI:a,offlineModeType:f}),S4(k),Us(k),g.wg(H)}})},UjT=function(k,a){a=g.A(a);
for(var y=a.next();!y.done;y=a.next())y=y.value,Cr2(y,1),k.actions.push(y);k.actions.sort(k.K)},SeK=function(k,a,y,q){q=q===void 0?!1:q;
var e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l;return g.Q(function(P){switch(P.K){case 1:return e=[],g.p(P,Tcr(),2);case 2:return(f=P.D)||q?g.p(P,d30(a,y),3):P.return([]);case 3:H=P.D;if((B=H)==null||!B.length)return P.return([]);Z={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};z=g.A(H);Y=z.next();case 4:if(Y.done){P.X5(6);break}W=r=Y.value;m=W.actionType;T=W.entityKey;O=W.actionMetadata;if(!(m&&T&&O)||g.v(O,VI0)){P.X5(5);break}m==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(O.offlineLoggingData=
Z);x=g.Yx(T);V=x.entityId;return g.p(P,zy(k,[V],"mainVideoEntity",m,O),8);case 8:l=P.D,e=e.concat(l);case 5:Y=z.next();P.X5(4);break;case 6:return P.return(e)}})},U31=function(){hK.apply(this,arguments)},$jd=function(k,a){return tK(k,{mode:"readwrite",
TE:!0},function(y){return KQ(y,a)})},BN2=function(k,a,y){y=y===void 0?[]:y;
var q,e,f,H,B,Z,z,Y,r,W,m,T,O;return g.Q(function(x){if(x.K==1)return y.length?g.p(x,j4(k,a),2):x.return([]);q=x.D;e=new Set;f=g.A(q);for(H=f.next();!H.done;H=f.next())if(B=H.value,Z=B.id||B.key)z=g.Yx(Z).entityId,e.add(z);Y=[];r=g.A(y);for(W=r.next();!W.done;W=r.next())m=W.value,T=m.offlineVideoData,O=void 0,((O=T)==null?0:O.videoId)&&!e.has(T.videoId)&&Y.push(m);return x.return(Y)})},Hu=function(k,a,y){a={track:wYd(a)};
y&&(a.playlistId=y);if(k=g.v(k.actionMetadata,A29))a.maximumDownloadQuality=k.maximumDownloadQuality;return{musicTrackEntityActionMetadata:a}},D3K=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl;
return g.Q(function(fG){switch(fG.K){case 1:return y=a.entityKey,q=g.Yx(y).entityId,g.p(fG,tK(k.K,{mode:"readonly",TE:!0},function(r4){var a3=EL(r4,y,"playbackData"),OZ=EL(r4,g.j5(q,"offlineVideoPolicy"),"offlineVideoPolicy");r4=EL(r4,g.j5(q,"transfer"),"transfer");return g.NY.all([a3,OZ,r4])}),2);
case 2:e=fG.D;f=g.A(e);H=f.next().value;B=f.next().value;Z=f.next().value;z=H;Y=B;r=Z;if(!z||!Y)return fG.return(vc(a,!0));W=[];O=((T=z)==null?0:T.playerResponseJson)?JSON.parse(z.playerResponseJson):null;if(!(r&&O&&k.B.W("html5_refresh_deprecated_downloads"))){fG.X5(3);break}m=XUr(k,O,r);return g.p(fG,Ot9(k,r),4);case 4:W=fG.D;case 3:x={lastPlayerResponseTimestampSeconds:z.playerResponseTimestamp,offlineToken:Y.offlineToken,formatIds:W};V={};if((l=r)==null?0:l.maximumDownloadQuality)V.maximumDownloadQuality=
r.maximumDownloadQuality;g.p8(fG,5);P=void 0;return g.p(fG,um1(k,a),7);case 7:return P=fG.D,g.p8(fG,8),g.p(fG,vUK(y,k.B,{refreshData:x,bQ:V,offlineSourceData:P,mediaCapabilities:m}),10);case 10:N=fG.D;g.St(fG,9,5);break;case 8:return g.vh(fG,5),F=Nw(a)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",u1("PDE handleRefresh error"),fG.return(vc(a,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",F,"DOWNLOAD_STATE_FAILED"));
case 9:return g.p(fG,F32(k,N,a),11);case 11:return fG.return(vc(a,!0,N.orchestrationActions));case 5:return t=g.vh(fG),M="PDE handleRefresh error",t instanceof Error&&(M="PDE handleRefresh error: "+t.message),ea="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Zl="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.HG&&t.type==="QUOTA_EXCEEDED"&&(ea="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Zl="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u1(M),fG.return(vc(a,
!1,void 0,ea,Zl,"DOWNLOAD_STATE_FAILED"))}})},Ov0=function(){hK.apply(this,arguments)},QZ=function(k,a){k.api.lj("woffle",{mcte:a});
u1("missing current transfer entity.")},jw0=function(){var k;
return g.Q(function(a){return a.K==1?g.p(a,Iz2(),2):(k=a.D)?a.return(k.delete("yt-player-local-img")):a.return(!0)})},Qg9=function(){var k,a,y,q,e,f;
return g.Q(function(H){switch(H.K){case 1:return g.p(H,dA(),2);case 2:k=H.D;if(!k)return H.return([]);a=Date.now()/1E3;return g.p(H,j4(k,"offlineVideoPolicy"),3);case 3:y=H.D,q=g.A(y),e=q.next();case 4:if(e.done){H.X5(6);break}f=e.value;if(!(f.expirationTimestamp&&Number(f.expirationTimestamp)<a)){H.X5(5);break}f.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";f.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.p(H,oS(k,f,"offlineVideoPolicy"),5);
case 5:e=q.next();H.X5(4);break;case 6:return H.return(y.map(function(B){return B.key}))}})},uHG=function(k,a,y,q){var e,f,H,B,Z,z,Y,r;
return g.Q(function(W){switch(W.K){case 1:e=[],f=g.A(a),H=f.next();case 2:if(H.done){W.X5(4);break}B=H.value;if(B.upToDate||y&&!B.shouldAutoSyncMetadata||!B.playlistId){W.X5(3);break}Z={};switch(q){case "mainPlaylistEntity":z={nextAutoRefreshIntervalSeconds:B.checkInSeconds,autoSync:y};Z={mainPlaylistEntityActionMetadata:z};break;case "musicPlaylist":Y={autoSync:y},Z={musicPlaylistEntityActionMetadata:Y}}return g.p(W,zy(k,[B.playlistId],q,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z),6);case 6:(r=
W.D)&&e.push.apply(e,g.ls(r));case 3:H=f.next();W.X5(2);break;case 4:return W.return(e)}})},xS9=function(k,a,y){a={offlineVideoData:a,
playlistId:y};if(k=g.v(k.actionMetadata,DS9))a.maximumDownloadQuality=k.maximumDownloadQuality;return{mainVideoEntityActionMetadata:a}},IGT=function(k){return g.Q(function(a){g.uz(k,0);
return a.return(R8V(k))})},M$d=function(k,a){var y=[];
if(k.thumbnailStyleData){k=g.A(k.thumbnailStyleData);for(var q=k.next();!q.done;q=k.next()){var e=void 0,f=void 0,H=void 0;y=y.concat(aj((e=q.value)==null?void 0:(f=e.value)==null?void 0:(H=f.collageThumbnail)==null?void 0:H.coverThumbnail))}}a=aj(a);return y.concat(a)},n8a=function(k,a){var y,q,e,f;
return g.Q(function(H){y=a.videoId;q=!0;if(a.captionTracks.length)e=CO0(a),k.K=new g.ZC(k.Rj,a,e);else if(a.eb)f=g.mZD(a),k.K=new g.u4(k.Rj,a.eb,y,f,a.a7,a.eventId),q=a.a7;else return H.return();return H.return(new Promise(function(B){var Z;(Z=k.K)==null||Z.W5({YH:function(){return g.Q(function(z){if(z.K==1)return g.p(z,k.YH(y,q),2);B();g.wg(z)})},
h0:function(){}})}))})},x32=function(k,a,y,q){g.C.call(this);
var e=this;this.D=k;this.api=a;this.tG=y;this.vz=q;this.N=new g.Q_;this.L=new g.gD(function(){e.K&&e.K.transferState==="TRANSFER_STATE_TRANSFERRING"&&e.N.Ca()&&((e.K.transferRetryCount||0)<3?CQ(e.G,e.X,!1,!1):cu(e.G,e.X.videoDetails.videoId),e.B5("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Kw=this.cz=0;this.aj=this.V=!1;this.ge=g.Ht(this.api.Z().experiments,"html5_transfer_processing_logs_interval");this.sY=new g.e9(this);this.Sw={hDq:function(){return e.L},
wGq:function(){return e.vz},
Wn:function(){return e.N}};
this.Lw=this.D.observe(this.Am.bind(this));this.G=new xj0(a,this);this.hG=new wXG(a);this.JG=new Os(this.D);this.Ij=this.N.listen("publicytnetworkstatus-online",this.Dw.bind(this));this.NE=this.N.listen("publicytnetworkstatus-offline",this.wlZ.bind(this));this.aj=this.api.Z().W("html5_less_transfer_processing_logs");g.U(this,this.sY);this.sY.Y(a,"offlinetransferpause",this.CpZ);if(g.ry(this.api.Z()))this.j="mainVideoDownloadStateEntity";else if(g.mi(this.api.Z())||g.Tn(this.api.Z()))this.j="musicTrackDownloadMetadataEntity"},
Tcr=function(){var k,a,y,q,e;
return g.Q(function(f){if(f.K==1)return g.p(f,dA(),2);if(f.K!=3)return(k=f.D)?g.p(f,j4(k,"refresh"),3):f.return(!1);a=f.D;if((y=a[0])==null||!y.refreshTime)return f.return(!1);q=Number(a[0].refreshTime);e=Date.now()/1E3;return f.return(isFinite(q)&&e>=q)})},XG9=function(k){var a,y,q;
g.Q(function(e){if(e.K==1){if(!k.K)return QZ(k,"onTransferPausedByNetwork"),e.return();k.L.stop();return g.p(e,xM(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(e.K!=3)return a=k.K,(q=((y=a)==null?0:y.key)?g.Yx(a.key).entityId:"")&&k.j?g.p(e,Rj(q,k.j,k.D,"DOWNLOAD_STATE_PAUSED"),3):e.X5(3);S4(k);g.wg(e)})},RfV=function(){hK.apply(this,arguments)},vUK=function(k,a,y){var q,e,f,H,B,Z,z,Y;
return g.Q(function(r){switch(r.K){case 1:q=g.SQ();var W=y.refreshData,m=y.isEnqueuedForExpiredStreamUrlRefetch,T=y.bQ,O=y.offlineSourceData,x=y.mediaCapabilities,V={entityKey:k};W&&(V.refreshData=W);m&&(V.isExpiredStreamUrlRefetch=m);T&&(V.downloadParameters=T);O&&(V.offlineSourceData=O);W={context:g.hF(a),signatureTimestamp:20352,videos:[V]};x&&(W.mediaCapabilities=x);e=W;f=g.Ok(GV9);g.p8(r,2);B={t5:!0};return g.p(r,g.Qe(q,e,f,void 0,B),4);case 4:H=r.D;g.St(r,3);break;case 2:Z=g.vh(r);if(Z instanceof
g.lu)throw z="GetPDE network manager error: "+Z.message,u1(z,Z),Error(z);u1("GetPDE fetch request error",Z);throw Error("GetPDE fetch request error");case 3:Y=vu(H);if(H)Y!==void 0&&JG(Y,"PDE");else throw u1("Network request failed for PDE"),Error("Network request failed for PDE");return r.return(H)}})},lZr=function(){nQ.apply(this,arguments)},bv0=function(k){var a,y;
return g.Q(function(q){if(q.K==1)return g.p(q,dA(),2);if(q.K!=3){a=q.D;if(!a)return u1("PES is undefined"),q.return();k.D=new x32(a,k.api,k.j,k.K);y=k.RW(a);return g.p(q,AM9(a,y,k.j,k.K,k.B),3)}k.G=q.D;return g.p(q,VVX(k),0)})},hv9=function(k,a){if(a.length===0)return Promise.resolve([]);
a=a.map(function(y){return Zd(y)});
return jKK(k.D,a)},PAG=function(k){var a;
return g.Q(function(y){if(y.K==1)return g.p(y,pYd(k),2);a=y.D;return y.return(!!a&&a.length>0)})},gST=function(){hK.apply(this,arguments)},VZ=function(k){if(!k.key)throw Error("Entity key is required.");
if(!k.actionProto)throw Error("OfflineOrchestrationAction is required.");var a=g.Yx(k.key),y=g.Yx(k.actionProto.entityKey);return new Bu(y.entityType,a.entityId,k.actionProto,k.parentActionId,k.rootActionId,k.childActionIds,k.prereqActionId,k.postreqActionIds,k.retryScheduleIndex,k.hasChildActionFailed,Number(k.enqueueTimeSec)*1E3)},hA9=function(k,a){var y;
return((y=k.player)==null?void 0:y.getVideoData().videoId)===a?k.player:null},sgT=function(){hK.apply(this,arguments)},Ah0=function(k,a,y){this.K=k;
this.B=a;this.j=y},tG=function(k,a){g.C.call(this);
this.token=k;this.K=a;this.observers=[];k=new g.DP.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.BG());k.onmessage=this.D.bind(this);this.channel=k},pX9=function(){hK.apply(this,arguments)},F32=function(k,a,y){var q,e,f,H,B;
return g.Q(function(Z){if(Z.K==1){if(!a.frameworkUpdates||!g.v(a.frameworkUpdates,MP))return Z.return();if(!(g.v(a.frameworkUpdates,MP).mutations&&g.v(a.frameworkUpdates,MP).mutations.length>0&&g.v(a.frameworkUpdates,MP).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return Z.X5(2);q=g.Yx(g.v(a.frameworkUpdates,MP).mutations[0].entityKey).entityId;return g.p(Z,LQ(k.K,q),3)}if(Z.K!=2){e=Z.D;f=g.v(y.actionMetadata,JK);if(B=(H=f)==null?void 0:H.playlistId)e.playlistId=B;e.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ry(k.B)?g.p(Z,IS(q,k.K,y,k.j,e),2):g.mi(k.B)?g.p(Z,rA(q,k.K,y,k.j),2):Z.X5(2)}return g.p(Z,CXX(g.v(a.frameworkUpdates,MP)),0)})},P_r=function(){hK.apply(this,arguments)},nS9=function(){hK.apply(this,arguments)},Jh9=function(){hK.apply(this,arguments)},LqV=function(k){k=k*1E3-Date.now();
return k>4E3?4E3:k},NcG=function(){hK.apply(this,arguments)},Wu=function(k,a,y,q,e){g.C.call(this);
var f=this;this.D=k;this.Lw=a;this.Kw=y;this.G=q;this.B=e;this.K=new Qw9;this.N=new g.Q_;this.j=new g.gD(function(){f.retry()});
this.V=NaN;this.X=!1;this.Sw={I8h:function(){return f.K},
Wn:function(){return f.N},
xhF:function(){return f.j},
retry:function(){return f.retry()}};
g.U(this,this.j);this.aj=this.D.observe(this.vz.bind(this))},paG=function(k,a,y){var q=ssV(a);
y=yhr(y);if(!y)return g.NY.resolve([]);y=new y(a);k=k.K.objectStore("EntityAssociationStore");a=[];y=g.A(y.D());for(var e=y.next();!e.done;e=y.next())a.push(g.Jl(k,{parentEntityKey:q,childEntityKey:e.value}));return g.NY.all(a).then(function(f){return f.map(function(H){return H[1]})})},QK9=function(k,a,y,q){var e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1,p1,oV,b,Yh,Gb,G2,qQ,l9,w,yH,lz,EQ,N9,X8,q9,eA,MY,R;
return g.Q(function(D){switch(D.K){case 1:return e=g.j5(k,"mainPlaylistEntity"),f=g.j5(k,"ytMainChannelEntity"),g.p(D,tK(a,{mode:"readonly",TE:!0},function(G){return g.NY.all([EL(G,e,"mainPlaylistEntity"),EL(G,f,"ytMainChannelEntity"),wA(G,"mainPlaylistEntity"),wA(G,"mainDownloadsListEntity"),wA(G,"ytMainChannelEntity"),wA(G,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=D.D;B=g.A(H);Z=B.next().value;z=B.next().value;Y=B.next().value;r=B.next().value;W=B.next().value;m=B.next().value;T=Z;O=z;x=Y;V=r;l=W;P=m;if(!T&&!O){D.X5(3);break}N=T?M$d(T):[];if(!O){F=[];D.X5(4);break}return g.p(D,pQ0(O,l),5);case 5:F=D.D;case 4:return t=F,g.p(D,lR(N.concat(t)),3);case 3:M=[];ea=new Map;if(!T){D.X5(7);break}return g.p(D,dj9(T,x,V),8);case 8:M=D.D;Zl=g.A(M);for(fG=Zl.next();!fG.done;fG=Zl.next())r4=fG.value,ea.set(r4,{videoId:r4,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.p(D,tK(a,{mode:"readonly",TE:!0},function(G){return g.NY.all([wA(G,"transfer"),wA(G,"videoDownloadContextEntity")])}),9);
case 9:a3=D.D;OZ=g.A(a3);I3=OZ.next().value;ka=OZ.next().value;Ya=I3;CG=ka;AO=g.A(Ya);for(K1=AO.next();!K1.done;K1=AO.next())p1=K1.value,oV=g.Yx(p1.key).entityId,(b=ea.get(oV))&&p1&&(b.cotn=p1.cotn);Yh=g.A(CG);for(Gb=Yh.next();!Gb.done;Gb=Yh.next())G2=Gb.value,qQ=g.Yx(G2.key).entityId,(l9=ea.get(qQ))&&G2&&(l9.offlineModeType=G2.offlineModeType);case 7:w=[];yH=g.A(P);for(lz=yH.next();!lz.done;lz=yH.next())EQ=lz.value,N9=g.Yx(EQ.key).entityId,X8=VZ(EQ),N9!==k&&X8.rootActionId!==k||bR(y,EQ.actionProto)||
w.push(EQ.key);q9=g.j5(k,"mainPlaylistEntity");return g.p(D,tK(a,{mode:"readwrite",TE:!0},function(G){var n=w.map(function(c){return KQ(G,c)});
n.push(KQ(G,q9,{eU:!0}));return g.NY.all(n)}),10);
case 10:if(!T){D.X5(0);break}M.reverse();if(!M){D.X5(0);break}eA=g.A(M);MY=eA.next();case 13:if(MY.done){D.X5(0);break}R=MY.value;return g.p(D,IS(R,a,y,q,ea.get(R)),14);case 14:MY=eA.next(),D.X5(13)}})},GjK=function(k,a){var y;
return g.Q(function(q){if(q.K==1)return g.p(q,j4(k.D,"offlineOrchestrationActionWrapperEntity",a),2);y=q.D;return q.return(y.filter(it9))})},tlK=function(k){var a;
k=g.v((a=k.getWatchNextResponse())==null?void 0:a.currentVideoEndpoint,g.GW);if(k==null?0:k.playlistId)var y=k.playlistId;return y},uR9=function(k){var a;
return g.Q(function(y){if(y.K==1)return g.p(y,usr(k),2);a=y.D;g.EW("offlineStateSnapshot",a);g.wg(y)})},yZ=function(k){var a,y;
return g.Q(function(q){if(q.K==1)return g.p(q,Iz2(),2);if(q.K!=3){a=q.D;if(!a)throw Error("Cache API not supported");return k.length?g.p(q,a.open("yt-player-local-img"),3):q.return()}y=q.D;return g.p(q,y.addAll(k),0)})},lo0=function(k,a){var y;
return g.Q(function(q){return q.K==1?g.p(q,Eid(k,a),2):(y=q.D)?g.p(q,tK(k,{mode:"readwrite",TE:!0},function(e){var f=[kM(e,y.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];y.mainDownloadsListEntity&&f.push(kM(e,y.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.NY.all(f)}),0):q.X5(0)})},pGK=function(k,a,y,q){if(!k.action.entityKey)throw Error("entityKey is missing.");
var e=g.Yx(k.action.entityKey);e={entityType:e.Me,entityId:e.entityId,offlineOrchestrationActionType:k.action.actionType,orchestrationAction:{orchestrationActionId:k.actionId}};a&&(e.offlineOrchestrationActionResult=a.status,e.isRetryable=y?!1:a.K,a.j&&(e.offlineOrchestrationFailureReason=efr(a.j,e.isRetryable)));var f,H;if((f=k.action.actionMetadata)==null?0:(H=f.offlineLoggingData)==null?0:H.offlineModeType)e.offlineModeType=k.action.actionMetadata.offlineLoggingData.offlineModeType;q&&(e.additionalOrchestrationActions=
q.map(function(B){return{orchestrationActionId:B.actionId}}));
return e},vS1=function(){hK.apply(this,arguments)},cc=function(k,a,y,q,e,f){a=g.j5(a,y);
q=Object.assign({},f,{priority:q,retryScheduleIntervalsInSeconds:e});return{actionType:k,entityKey:a,actionMetadata:q}},Ojr=function(k,a,y,q){var e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG;
return g.Q(function(AO){switch(AO.K){case 1:return g.p(AO,dA(),2);case 2:e=AO.D;if(!e)return AO.return([]);f=[];if((H=q)==null?0:H.length){f=q;AO.X5(3);break}return g.p(AO,j4(e,"mainPlaylistEntity"),4);case 4:f=AO.D;case 3:if(!f.length)return AO.return([]);B=[];Z=Date.now()/1E3;z=g.A(f);Y=z.next();case 5:if(Y.done)return B.length?g.p(AO,$39(B),10):AO.return([]);r=Y.value;if(!r.downloadState){W=void 0;AO.X5(8);break}return g.p(AO,Fh(e,r.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:W=
AO.D;case 8:m=W;T=void 0;x=(O=(T=r)==null?void 0:T.entityMetadata)&&O.nextAutoRefreshIntervalSeconds?Number(O.nextAutoRefreshIntervalSeconds):NaN;V=Number.isNaN(x)?k:x;P=l=void 0;N=((l=m)==null?0:l.lastSyncedTimestampMillis)?Number((P=m)==null?void 0:P.lastSyncedTimestampMillis)/1E3:0;t=F=void 0;M=((F=m)==null?0:F.addedTimestampMillis)?Number((t=m)==null?void 0:t.addedTimestampMillis)/1E3:0;if(y||!O||N+V<=Z){ea=[];Zl=void 0;if((Zl=r.videos)==null?0:Zl.length)for(fG=g.A(r.videos),r4=fG.next();!r4.done;r4=
fG.next())a3=r4.value,OZ=JSON.parse(g.Yx(a3).entityId),OZ.videoId&&ea.push(OZ.videoId);I3="0";O&&(ka=void 0,I3=String(Number((ka=O.offlineLastModifiedTimestampSeconds)!=null?ka:0).toFixed()));Ya={playlistId:r.playlistId,videoIds:ea,offlineLastModifiedTimestamp:I3,autoSync:a,offlineDateAddedTimestamp:String(M.toFixed())};B.push(Ya)}Y=z.next();AO.X5(5);break;case 10:return CG=AO.D,AO.return(CG)}})},nUT=function(k,a,y){if(!y){var q=q===void 0?!1:q;
y=k.K.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!y||q)y=g.fv(16),k.K.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",y)}k={flowNonce:y,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:a.eventType};a.metadata&&(k.flowMetadata=a.metadata);a.statusCode!==void 0&&(k.flowEventStatus=a.statusCode);a.csn&&(k.csn=a.csn);a.can&&(k.can=a.can);g.EW("flowEvent",k,void 0)},VVX=function(k){var a;
return g.Q(function(y){switch(y.K){case 1:if(!k.D)return u1("transferManager is undefined"),y.return();if(k.D.K){y.X5(2);break}return g.p(y,Us(k.D),2);case 2:if(!k.B.W("woffle_enable_main_downloads_library")){y.X5(4);break}return g.p(y,k.Ig(),4);case 4:if(!k.B.W("html5_offline_playback_position_sync")){y.X5(6);break}return g.p(y,k.Vb(),7);case 7:return g.p(y,k.BL(864E5),6);case 6:return g.p(y,k.refreshAllStaleEntities(43200,!0),9);case 9:return g.p(y,k.vH(),10);case 10:if(!k.B.W("html5_retry_downloads_for_expiration")){y.X5(11);
break}return g.p(y,k.Ju(),11);case 11:return k.V=g.qx(function(){k.refreshAllStaleEntities(43200,!0);k.vH()},9E5),g.NL(g.uC(),function(){return k.W8()}),g.p(y,dA(),13);
case 13:return a=y.D,g.p(y,uR9(a),14);case 14:Yer(k.j),g.wg(y)}})},FN9=function(){hK.apply(this,arguments)},oSX=function(){hK.apply(this,arguments)},mv=function(k,a,y){var q=k.j[y];
q||(q=new Set,k.j[y]=q);q.add(a)},e29=function(k,a,y,q,e,f){var H,B,Z;
return g.Q(function(z){H="STREAM_TYPE_UNKNOWN";y.video&&y.audio?(H="STREAM_TYPE_AUDIO_AND_VIDEO",u1("unexpected stream type")):y.video&&!y.audio?H="STREAM_TYPE_VIDEO":!y.video&&y.audio&&(H="STREAM_TYPE_AUDIO");B=g.j5(a,"offlineVideoStreams");Z={numBytesDownloaded:e.toFixed(),numTotalBytes:f.toFixed(),streamType:H,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(q),itag:H==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(y.itag):void 0};return g.p(z,tK(k,{mode:"readwrite",TE:!0},
function(Y){var r=EL(Y,B,"offlineVideoStreams"),W=EL(Y,g.j5(a,"transfer"),"transfer");return g.NY.all([r,W]).then(function(m){m=g.A(m);var T=m.next().value;m=m.next().value;if(!m)return KQ(Y,B).then(function(){});
var O=LK9(T);T=aD9(T,q,Z,B);var x=kM(Y,T,"offlineVideoStreams");LK9(T)>O&&(m.lastProgressTimeMs=Date.now().toString());O=[x];m.offlineVideoStreams||(m.offlineVideoStreams=[]);m.offlineVideoStreams.indexOf(B)===-1&&(m.offlineVideoStreams.push(B),O.push(kM(Y,m,"transfer")));return g.NY.all(O)})}),0)})},it9=function(k){return k!==void 0},QzK=function(k,a,y,q){var e,f,H;
return g.Q(function(B){switch(B.K){case 1:return g.p(B,h8G([a]),2);case 2:return e=B.D,g.p(B,XYX(k,e[0],y,q),3);case 3:return f=B.D,H=aj(f.thumbnailDetails),g.p(B,yZ(H),4);case 4:return B.return(e[0].videos)}})},jzd=function(k,a,y){try{return k.j(a,y)}catch(q){Lyr(q,Zc9)}},C_K=function(){nQ.apply(this,arguments)},dS1=function(k,a,y){var q,e,f;
return g.Q(function(H){switch(H.K){case 1:return g.p(H,h8G([a]),2);case 2:return q=H.D,g.p(H,Tor(k,q[0],y),3);case 3:return e=H.D,f=aj(e.thumbnailDetails),g.p(H,yZ(f),4);case 4:return H.return(q[0].videos)}})},wXG=function(k){this.Rj=k;
this.K=void 0},LB9=function(){},hfV=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T;
return g.Q(function(O){switch(O.K){case 1:return y=Nw(a),q=g.Yx(a.entityKey),e=q.entityId,f=g.v(a.actionMetadata,mj1),g.p8(O,2),g.p(O,R2T(k,e,void 0,(H=f)==null?void 0:H.track,(B=f)==null?void 0:B.albumRelease),4);case 4:if((Z=f)==null?0:Z.playlistId){O.X5(5);break}return g.p(O,Ce9(k.K,a.entityKey),5);case 5:g.St(O,3);break;case 2:return z=g.vh(O),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.HG&&z.type==="QUOTA_EXCEEDED"&&
(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),O.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Y,r));case 3:m=Number(((W=a.actionMetadata)==null?void 0:W.priority)||0)+1;var x=(x=g.v(a.actionMetadata,mj1))?{playbackDataActionMetadata:{maximumDownloadQuality:x.maximumDownloadQuality}}:void 0;T=cc("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"playbackData",m,TyT,x);return O.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y,[T]))}})},Nkr=function(k){var a,y,q;
return g.Q(function(e){if(e.K==1){if(!k.K)return QZ(k,"onTransferStart"),e.return();k.L.start(108E5);return g.p(e,xM(k,"TRANSFER_STATE_TRANSFERRING"),2)}a=k.K;return(q=((y=a)==null?0:y.key)?g.Yx(a.key).entityId:"")&&k.j?g.p(e,Rj(q,k.j,k.D,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):e.X5(0)})},KK1=function(k,a){var y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x;
return g.Q(function(V){if(V.K==1)return y=g.j5("main_downloads_library_id","mainDownloadsLibraryEntity"),q=g.j5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.p(V,tK(k,{mode:"readonly",TE:!0},function(l){return g.NY.all([EL(l,y,"mainDownloadsLibraryEntity"),EL(l,q,"mainDownloadsListEntity"),EL(l,g.nw,"mainDownloadsListEntity")])}),2);
e=V.D;f=g.A(e);H=f.next().value;B=f.next().value;Z=f.next().value;z=H;Y=B;r=Z;if(!z)return V.X5(0);if(a===g.nw&&((W=r)==null?0:W.downloads))r.downloads=[];else if((m=Y)==null?0:m.downloads)for(T=g.Yx(a).entityType,O=0;O<Y.downloads.length;O++)if(x=Y.downloads[O],T==="mainVideoEntity"&&x.videoItem===a){Y.downloads.splice(O,1);break}else if(T==="mainPlaylistEntity"&&x.playlistItem===a){Y.downloads.splice(O,1);break}return g.p(V,tK(k,{mode:"readwrite",TE:!0},function(l){var P=[kM(l,z,"mainDownloadsLibraryEntity")];
Y&&P.push(kM(l,Y,"mainDownloadsListEntity"));r&&P.push(kM(l,r,"mainDownloadsListEntity"));return g.NY.all(P)}),0)})},MVX=function(k,a,y){this.K=k;
this.B=a;this.j=y},jKK=function(k,a){return tK(k,{mode:"readwrite",
TE:!0},function(y){return fzV(y,a,"offlineOrchestrationActionWrapperEntity")})},usr=function(k){var a,y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1,p1,oV,b,Yh,Gb;
return g.Q(function(G2){if(G2.K==1)return g.p(G2,tK(k,{mode:"readonly",TE:!0},function(qQ){return wA(qQ,"playbackData").then(function(l9){var w=l9.map(function(N9){return N9.transfer}).filter(function(N9){return!!N9}),yH=l9.map(function(N9){return N9.offlineVideoPolicy}).filter(function(N9){return!!N9}),lz=l9.filter(function(N9){return!!N9.key}).map(function(N9){return g.j5(g.Yx(N9.key).entityId,"downloadStatusEntity")});
w=wA(qQ,"transfer",w);yH=wA(qQ,"offlineVideoPolicy",yH);lz=wA(qQ,"downloadStatusEntity",lz);var EQ=w.then(function(N9){N9=N9.reduce(function(X8,q9){(q9==null?0:q9.offlineVideoStreams)&&X8.push.apply(X8,g.ls(q9.offlineVideoStreams));return X8},[]).filter(function(X8){return!!X8});
return wA(qQ,"offlineVideoStreams",N9)});
return g.NY.all([w,yH,EQ,lz]).then(function(N9){var X8=g.A(N9);N9=X8.next().value;var q9=X8.next().value;var eA=X8.next().value;X8=X8.next().value;return[l9,N9,q9,eA,X8]})})}),2);
if(G2.K!=3)return a=G2.D,g.p(G2,tK(k,{mode:"readonly",TE:!0},function(qQ){return wA(qQ,"mainDownloadsListEntity").then(function(l9){var w,yH;return(yH=(w=l9[0])==null?void 0:w.downloads)!=null?yH:[]})}),3);
y=G2.D;q=g.A(a);e=q.next().value;f=q.next().value;H=q.next().value;B=q.next().value;Z=q.next().value;z=e;Y=f;r=H;W=B;m=Z;T={};O={};x={};V={};l={};P=[];N=g.A(Y);for(F=N.next();!F.done;F=N.next())(t=F.value)&&(T[t.key]=t);M=g.A(r);for(ea=M.next();!ea.done;ea=M.next())(Zl=ea.value)&&(O[Zl.key]=Zl);fG=g.A(m);for(r4=fG.next();!r4.done;r4=fG.next())(a3=r4.value)&&(x[a3.key]=a3);OZ=g.A(W);for(I3=OZ.next();!I3.done;I3=OZ.next())(ka=I3.value)&&(V[ka.key]=ka);Ya=g.A(y);for(CG=Ya.next();!CG.done;CG=Ya.next())AO=
CG.value,K1=void 0,l[(K1=AO.videoItem)!=null?K1:""]=!0,AO.videoItem&&(oV=p1=void 0,b=(oV=(p1=g.Yx(AO.videoItem))==null?void 0:p1.entityId)!=null?oV:"",P.push({externalVideoId:b}));Yh=z.filter(function(qQ){if(!qQ||!qQ.key||!qQ.offlineVideoPolicy)return!1;qQ=g.Yx(qQ.key).entityId;qQ=g.j5(qQ,"downloadStatusEntity");var l9;return!(qQ&&((l9=x[qQ])==null?void 0:l9.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Gb=Yh.map(function(qQ){var l9=T[qQ.transfer],w=[];if(l9==null?0:l9.offlineVideoStreams)for(var yH=g.A(l9.offlineVideoStreams),lz=yH.next();!lz.done;lz=yH.next())(lz=V[lz.value])&&w.push(lz);yH=O[qQ.offlineVideoPolicy];lz=l;var EQ=qQ==null?void 0:qQ.playerResponseTimestamp,N9=g.Yx(yH.key).entityId;qQ=g.j5(N9,"mainVideoEntity");if(yH.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var X8="OFFLINE_VIDEO_STATE_DISABLED";yH.expirationTimestamp&&Number(yH.expirationTimestamp)<Date.now()/1E3&&(X8="OFFLINE_VIDEO_STATE_EXPIRED")}else if(yH.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")X8="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(l9==null?void 0:l9.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":X8="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":X8="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":X8="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":X8="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":X8="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":X8="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:X8="OFFLINE_VIDEO_STATE_UNKNOWN"}if(X8==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(l9==null?void 0:l9.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":X8="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":X8="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":X8=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}N9={id:N9,videoState:X8};if(l9==null?0:l9.cotn)N9.cotn=l9.cotn;if(l9==null?0:l9.maximumDownloadQuality)N9.selectedVideoQuality=l9==null?void 0:l9.maximumDownloadQuality;if(l9==null?0:l9.lastProgressTimeMs)N9.lastProgressTimeMs=l9.lastProgressTimeMs;EQ&&(N9.playerResponseSavedTimeMs=String(Number(EQ)*1E3));l9=String;EQ=0;w=g.A(w);for(X8=w.next();!X8.done;X8=w.next())if(X8=X8.value,X8.streamsProgress){X8=g.A(X8.streamsProgress);for(var q9=X8.next();!q9.done;q9=X8.next()){var eA=
void 0;EQ+=Number((eA=q9.value.numBytesDownloaded)!=null?eA:0)}}N9.downloadedBytes=l9(EQ);N9.selectedOfflineMode=lz[qQ]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";yH.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(N9.offlinePlaybackDisabledReason=yH.offlinePlaybackDisabledReason);return N9});
return G2.return({offlineVideos:Gb,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:P}}})})},XLr=function(){return g.Q(function(k){if(Es!==void 0)return k.return(Es);
Es=new Promise(function(a){var y;return g.Q(function(q){switch(q.K){case 1:return g.p8(q,2),g.p(q,Ka.open("test-only"),4);case 4:return g.p(q,Ka.delete("test-only"),5);case 5:g.St(q,3);break;case 2:if(y=g.vh(q),y instanceof Error&&y.name==="SecurityError")return a(!1),q.return();case 3:a("caches"in window),g.wg(q)}})});
return k.return(Es)})},war=function(k){var a,y,q,e,f,H,B,Z;
return g.Q(function(z){switch(z.K){case 1:return a=g.SQ(),y=pL0(k),q=g.Ok(KBG),g.p8(z,2),f={t5:!0},g.p(z,g.Qe(a,y,q,void 0,f),4);case 4:e=z.D;g.St(z,3);break;case 2:H=g.vh(z);if(H instanceof g.lu)throw B="GetOffline network manager error: "+H.message,u1(B,H),Error(B);u1("GetOffline fetch request error",H);throw Error("GetOffline fetch request error");case 3:Z=vu(e);if(!e)throw u1("Network request failed"),Error("Network request failed");if(Z!==void 0)JG(Z);else if(!e.videos||!e.videos.length)throw u1("No data"),
Error("No data");return z.return(e.videos.map(function(Y){return Y.offlineVideoData}))}})},XXX=function(k){return g.Q(function(a){if(a.K==1)return k.X?g.p(a,cu(k.G,k.X.videoDetails.videoId),3):a.X5(0);
S4(k);g.wg(a)})},KQ=function(k,a,y){if(y==null?0:y.eU){var q=new Set;
return Hjr(k,a,q).then(function(){for(var f=[],H=g.A(q),B=H.next();!B.done;B=H.next())f.push(KQ(k,B.value));return g.NY.all(f).then(function(){})})}var e=g.Yx(a).entityType;
return g.NY.all([k.K.objectStore("EntityStore").delete(a),Am1(k,a)]).then(function(){mv(k,a,e)})},kr=function(){uR.apply(this,arguments);
this.aj="musicTrack"},chr=function(k,a){var y,q;
return g.Q(function(e){switch(e.K){case 1:return y=Nw(a),g.p(e,Fh(k.K,a.entityKey,"transfer"),2);case 2:if(q=e.D)return e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.p8(e,3);return g.p(e,IAX(k,a),5);case 5:g.St(e,4);break;case 3:return g.vh(e),e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return e.return(new Mw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},WN9=function(k,a){var y,q,e,f,H;
return g.Q(function(B){if(B.K==1)return y=g.j5(a,"offlineVideoStreams"),g.p(B,Fh(k,y,"offlineVideoStreams"),2);q=B.D;if(!q||!q.streamsProgress)return B.return();e=g.A(q.streamsProgress);for(f=e.next();!f.done;f=e.next())H=f.value,H.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",H.numTotalBytes!==H.numBytesDownloaded&&(H.numBytesDownloaded=H.numTotalBytes);return g.p(B,oS(k,q,"offlineVideoStreams"),0)})},LNV=function(k,a){this.K=k;
this.j=a},wA=function(k,a,y){return y?(y=y.map(function(q){return EL(k,q,a)}),g.NY.all(y)):k.K.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(a)).then(function(q){return q.map(function(e){return WB0(k,e)})})},IZ2=function(){hK.apply(this,arguments)},hG=function(){},pU0=function(k,a,y,q){var e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG;
return g.Q(function(AO){switch(AO.K){case 1:return g.p(AO,dA(),2);case 2:e=AO.D;if(!e)return AO.return([]);f=[];if((H=q)==null?0:H.length){f=q;AO.X5(3);break}return g.p(AO,j4(e,"musicPlaylist"),4);case 4:f=AO.D;case 3:if(!f.length)return AO.return([]);B=[];Z=Date.now()/1E3;z=g.A(f);Y=z.next();case 5:if(Y.done)return B.length?g.p(AO,$39(B),10):AO.return([]);r=Y.value;W=void 0;T=(m=(W=r)==null?void 0:W.entityMetadata)&&m.nextAutoRefreshIntervalSeconds?Number(m.nextAutoRefreshIntervalSeconds):NaN;O=
Number.isNaN(T)?k:T;V=x=0;l="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!r.downloadMetadata){AO.X5(8);break}return g.p(AO,Fh(e,r.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:P=AO.D,F=N=void 0,x=Number((F=(N=P)==null?void 0:N.addedTimestampMillis)!=null?F:"0")/1E3,M=t=void 0,V=Number((M=(t=P)==null?void 0:t.lastModifiedTimestampMillis)!=null?M:"0")/1E3,Zl=ea=void 0,l=(Zl=(ea=P)==null?void 0:ea.syncState)!=null?Zl:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:fG=void 0;if(y||l!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!m||Number((fG=m.lastSyncedTimestampSeconds)!=null?fG:0)+O<=Z){r4=[];a3=void 0;if((a3=r.tracks)==null?0:a3.length)for(OZ=g.A(r.tracks),I3=OZ.next();!I3.done;I3=OZ.next())ka=I3.value,r4.push(g.Yx(ka).entityId);Ya={playlistId:r.playlistId,videoIds:r4,offlineLastModifiedTimestamp:String(V.toFixed()),autoSync:a,offlineDateAddedTimestamp:String(x.toFixed())};B.push(Ya)}Y=z.next();AO.X5(5);break;case 10:return CG=AO.D,AO.return(CG)}})},nP9=function(k,a){var y;
return g.Q(function(q){if(!k.K)return q.return();y=k.K;return g.p(q,tK(k.D,{mode:"readwrite",TE:!0},function(e){var f=[kM(e,y,"transfer")];a&&f.push(a(e));return g.NY.all(f)}),0)})},tVG=function(k,a,y){a=a===void 0?43200:a;
y=y===void 0?!0:y;var q=q===void 0?!1:q;var e,f;return g.Q(function(H){switch(H.K){case 1:if(!k.N.Ca())return H.return([]);e=[];g.p8(H,2);return g.p(H,pU0(a,y,q),4);case 4:e=H.D;g.St(H,3);break;case 2:g.vh(H);case 3:return f=uHG(k,e,y,"musicPlaylist"),H.return(f)}})},uR=function(k,a){var y=this;
this.B=k;this.api=a;this.N=new g.Q_;this.X=new g.hu;this.Sw={n4:function(){return y.j.Sw.n4()},
Wn:function(){return y.N},
C0j:function(){return y.j},
Hy:function(){return y.Hy()},
LB:function(){return y.LB()},
Xa:function(){return y.Xa()},
W8:function(){return y.W8()},
Ju:function(){return y.Ju()},
BL:function(q){return y.BL(q)}};
this.j=new oi9(function(){return Rvd(y)},function(){y.Xa()},this.api.Rn(),this.api.W.bind(this.api));
this.K=new Fg(this.api);ijV(this.j)};
g.vg.prototype.aW=g.$g(45,function(k){return this.app.aW(k)});
g.cg.prototype.aW=g.$g(44,function(k){return g.PHH(this,9,k)});
g.I(hK,nQ);g.Cm.Object.defineProperties(hK.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.K.entityMetadata},
set:function(k){this.K.entityMetadata=k}}});
g.I(Bo1,hK);Bo1.prototype.D=function(){return[]};
g.I(yMr,hK);yMr.prototype.D=function(){return[]};
g.I(Nea,hK);Nea.prototype.D=function(){return[]};
g.I(HTd,hK);HTd.prototype.D=function(){return[]};
g.I(dv9,hK);dv9.prototype.D=function(){return[]};
g.I(aiG,hK);aiG.prototype.D=function(){var k=[];this.K.alternateChannel&&k.push(this.K.alternateChannel);this.K.alternateChannelList&&k.push.apply(k,g.ls(this.K.alternateChannelList));this.K.oneofChannelEntity&&k.push(this.K.oneofChannelEntity);return[].concat(g.ls(new Set(k)))};
g.I(wUG,hK);wUG.prototype.D=function(){var k=[];this.K.entryCollection&&k.push(this.K.entryCollection);return[].concat(g.ls(new Set(k)))};
g.I(lZr,nQ);lZr.prototype.D=function(){var k=[];this.K.video&&k.push(this.K.video);return[].concat(g.ls(new Set(k)))};
g.I(ew1,hK);ew1.prototype.D=function(){var k=[];this.K.parentPlaylist&&k.push(this.K.parentPlaylist);if(this.K.entries)for(var a=g.A(this.K.entries),y=a.next();!y.done;y=a.next())k.push.apply(k,g.ls((new lZr(y.value)).D()));return[].concat(g.ls(new Set(k)))};
g.I(nS9,hK);nS9.prototype.D=function(){var k=[];this.K.descriptionEntity&&k.push(this.K.descriptionEntity);this.K.creators&&k.push.apply(k,g.ls(this.K.creators));this.K.theBiggestFan&&k.push(this.K.theBiggestFan);return[].concat(g.ls(new Set(k)))};
g.I(KfG,hK);KfG.prototype.D=function(){return[]};
g.I(yy9,hK);yy9.prototype.D=function(){return[]};
g.I($vK,hK);$vK.prototype.D=function(){return[]};
g.I(njK,hK);njK.prototype.D=function(){return[]};
g.I(j59,hK);j59.prototype.D=function(){return[]};
g.I(NNT,hK);NNT.prototype.D=function(){return[]};
g.I(ym9,hK);ym9.prototype.D=function(){return[]};
g.I(ei1,hK);ei1.prototype.D=function(){return[]};
g.I(K39,hK);K39.prototype.D=function(){return[]};
g.I(rmG,hK);rmG.prototype.D=function(){var k=[];this.K.downloadsList&&k.push(this.K.downloadsList);this.K.smartDownloadsList&&k.push(this.K.smartDownloadsList);this.K.recommendedDownloadsList&&k.push(this.K.recommendedDownloadsList);this.K.refresh&&k.push(this.K.refresh);return[].concat(g.ls(new Set(k)))};
g.I(C_K,nQ);C_K.prototype.D=function(){var k=[];this.K.video&&k.push(this.K.video);this.K.playlist&&k.push(this.K.playlist);this.K.videoItem&&k.push(this.K.videoItem);this.K.playlistItem&&k.push(this.K.playlistItem);return[].concat(g.ls(new Set(k)))};
g.I(pX9,hK);pX9.prototype.D=function(){var k=[];this.K.refresh&&k.push(this.K.refresh);if(this.K.downloads)for(var a=g.A(this.K.downloads),y=a.next();!y.done;y=a.next())k.push.apply(k,g.ls((new C_K(y.value)).D()));return[].concat(g.ls(new Set(k)))};
g.I(Jy9,hK);Jy9.prototype.D=function(){var k=[];this.K.localImageEntities&&k.push.apply(k,g.ls(this.K.localImageEntities));return[].concat(g.ls(new Set(k)))};
g.I(ZKd,hK);ZKd.prototype.D=function(){var k=[];this.K.playbackData&&k.push(this.K.playbackData);this.K.localImageEntities&&k.push.apply(k,g.ls(this.K.localImageEntities));this.K.videoDownloadContextEntity&&k.push(this.K.videoDownloadContextEntity);return[].concat(g.ls(new Set(k)))};
g.I(SJd,hK);SJd.prototype.D=function(){return[]};
g.I(BcK,hK);BcK.prototype.D=function(){var k=[];this.K.fakeChildren&&k.push.apply(k,g.ls(this.K.fakeChildren));return[].concat(g.ls(new Set(k)))};
g.I(Yi0,hK);Yi0.prototype.D=function(){var k=[];this.K.video&&k.push(this.K.video);this.K.playbackData&&k.push(this.K.playbackData);this.K.offlineVideoPolicy&&k.push(this.K.offlineVideoPolicy);return[].concat(g.ls(new Set(k)))};
g.I(rhG,hK);rhG.prototype.D=function(){return[]};
g.I(dhd,hK);dhd.prototype.D=function(){var k=[];this.K.channelOwner&&k.push(this.K.channelOwner);this.K.videos&&k.push.apply(k,g.ls(this.K.videos));this.K.collaboratorChannels&&k.push.apply(k,g.ls(this.K.collaboratorChannels));this.K.downloadState&&k.push(this.K.downloadState);this.K.refresh&&k.push(this.K.refresh);return[].concat(g.ls(new Set(k)))};
g.I(mW0,hK);mW0.prototype.D=function(){var k=[];this.K.video&&k.push(this.K.video);this.K.channelContributor&&k.push(this.K.channelContributor);return[].concat(g.ls(new Set(k)))};
g.I(jsd,nQ);jsd.prototype.D=function(){var k=[];this.K.localImageEntities&&k.push.apply(k,g.ls(this.K.localImageEntities));this.K.videoDownloadContextEntity&&k.push(this.K.videoDownloadContextEntity);return[].concat(g.ls(new Set(k)))};
g.I(EUr,nQ);EUr.prototype.D=function(){var k=[];this.K.recommendedVideoMetadata&&k.push.apply(k,g.ls((new jsd(this.K.recommendedVideoMetadata)).D()));return[].concat(g.ls(new Set(k)))};
g.I(ziV,nQ);ziV.prototype.D=function(){var k=[];this.K.playbackPosition&&k.push(this.K.playbackPosition);return[].concat(g.ls(new Set(k)))};
g.I(Te2,hK);Te2.prototype.D=function(){var k=[];this.K.owner&&k.push(this.K.owner);this.K.downloadState&&k.push(this.K.downloadState);this.K.userState&&k.push.apply(k,g.ls((new ziV(this.K.userState)).D()));this.K.additionalMetadata&&k.push.apply(k,g.ls((new EUr(this.K.additionalMetadata)).D()));return[].concat(g.ls(new Set(k)))};
g.I(c29,hK);c29.prototype.D=function(){var k=[];this.K.userChannelDetails&&k.push(this.K.userChannelDetails);return[].concat(g.ls(new Set(k)))};
g.I(u39,hK);u39.prototype.D=function(){var k=[];this.K.channelOwner&&k.push(this.K.channelOwner);this.K.playbackPosition&&k.push(this.K.playbackPosition);this.K.localImageEntities&&k.push.apply(k,g.ls(this.K.localImageEntities));this.K.downloadStatus&&k.push(this.K.downloadStatus);return[].concat(g.ls(new Set(k)))};
g.I(nyT,hK);nyT.prototype.D=function(){return[]};
g.I(vi9,hK);vi9.prototype.D=function(){return[]};
g.I(cSa,hK);cSa.prototype.D=function(){return[]};
g.I(sgT,hK);sgT.prototype.D=function(){return[]};
g.I(G_9,hK);G_9.prototype.D=function(){return[]};
g.I(iT9,hK);iT9.prototype.D=function(){return[]};
g.I(YJ2,hK);YJ2.prototype.D=function(){return[]};
g.I(cE9,hK);cE9.prototype.D=function(){return[]};
g.I(U31,hK);U31.prototype.D=function(){return[]};
g.I(z2G,hK);z2G.prototype.D=function(){return[]};
g.I(IZ2,hK);IZ2.prototype.D=function(){return[]};
g.I(Jh9,hK);Jh9.prototype.D=function(){return[]};
g.I(oSX,hK);oSX.prototype.D=function(){return[]};
g.I(bKd,hK);bKd.prototype.D=function(){var k=[];this.K.compositeSourceKeys&&k.push.apply(k,g.ls(this.K.compositeSourceKeys));return[].concat(g.ls(new Set(k)))};
g.I(TkT,hK);TkT.prototype.D=function(){var k=[];this.K.trackDownloadMetadatas&&k.push.apply(k,g.ls(this.K.trackDownloadMetadatas));return[].concat(g.ls(new Set(k)))};
g.I(FB9,hK);
FB9.prototype.D=function(){var k=[];this.K.downloadedTracks&&k.push.apply(k,g.ls(this.K.downloadedTracks));this.K.smartDownloadedTracks&&k.push.apply(k,g.ls(this.K.smartDownloadedTracks));this.K.downloadedEpisodes&&k.push.apply(k,g.ls(this.K.downloadedEpisodes));this.K.downloadedAlbumReleases&&k.push.apply(k,g.ls(this.K.downloadedAlbumReleases));this.K.smartDownloadedAlbumReleases&&k.push.apply(k,g.ls(this.K.smartDownloadedAlbumReleases));this.K.downloadedPlaylists&&k.push.apply(k,g.ls(this.K.downloadedPlaylists));this.K.smartDownloadedPlaylists&&
k.push.apply(k,g.ls(this.K.smartDownloadedPlaylists));this.K.metadataOnlyTracks&&k.push.apply(k,g.ls(this.K.metadataOnlyTracks));return[].concat(g.ls(new Set(k)))};
g.I(IDX,hK);IDX.prototype.D=function(){var k=[];this.K.trackDownloadMetadatas&&k.push.apply(k,g.ls(this.K.trackDownloadMetadatas));return[].concat(g.ls(new Set(k)))};
g.I(Ber,hK);Ber.prototype.D=function(){var k=[];this.K.playbackData&&k.push(this.K.playbackData);this.K.localImageEntities&&k.push.apply(k,g.ls(this.K.localImageEntities));this.K.videoDownloadContextEntity&&k.push(this.K.videoDownloadContextEntity);return[].concat(g.ls(new Set(k)))};
g.I(xW9,hK);xW9.prototype.D=function(){var k=[];this.K.musicLibraryStatusEntity&&k.push(this.K.musicLibraryStatusEntity);this.K.primaryArtists&&k.push.apply(k,g.ls(this.K.primaryArtists));this.K.details&&k.push(this.K.details);this.K.userDetails&&k.push(this.K.userDetails);this.K.tracks&&k.push.apply(k,g.ls(this.K.tracks));this.K.share&&k.push(this.K.share);this.K.downloadMetadata&&k.push(this.K.downloadMetadata);this.K.refresh&&k.push(this.K.refresh);return[].concat(g.ls(new Set(k)))};
g.I(Ii2,hK);Ii2.prototype.D=function(){var k=[];this.K.albumRelease&&k.push(this.K.albumRelease);this.K.tracks&&k.push.apply(k,g.ls(this.K.tracks));return[].concat(g.ls(new Set(k)))};
g.I(USX,hK);USX.prototype.D=function(){var k=[];this.K.albumRelease&&k.push(this.K.albumRelease);return[].concat(g.ls(new Set(k)))};
g.I(s59,hK);s59.prototype.D=function(){var k=[];this.K.details&&k.push(this.K.details);this.K.userDetails&&k.push(this.K.userDetails);return[].concat(g.ls(new Set(k)))};
g.I(Y4V,hK);Y4V.prototype.D=function(){var k=[];this.K.parentArtist&&k.push(this.K.parentArtist);return[].concat(g.ls(new Set(k)))};
g.I(Uh0,hK);Uh0.prototype.D=function(){var k=[];this.K.parentArtist&&k.push(this.K.parentArtist);return[].concat(g.ls(new Set(k)))};
g.I($hX,hK);$hX.prototype.D=function(){return[]};
g.I(ao9,hK);ao9.prototype.D=function(){return[]};
g.I(HvK,nQ);HvK.prototype.D=function(){var k=[];this.K.creatorEntity&&k.push(this.K.creatorEntity);return[].concat(g.ls(new Set(k)))};
g.I(ukX,hK);
ukX.prototype.D=function(){var k=[];this.K.tracks&&k.push.apply(k,g.ls(this.K.tracks));this.K.refresh&&k.push(this.K.refresh);this.K.musicLibraryStatusEntity&&k.push(this.K.musicLibraryStatusEntity);this.K.details&&k.push(this.K.details);this.K.downloadMetadata&&k.push(this.K.downloadMetadata);this.K.sideloadMetadata&&k.push(this.K.sideloadMetadata);this.K.userDetails&&k.push(this.K.userDetails);this.K.entryCollection&&k.push(this.K.entryCollection);this.K.share&&k.push(this.K.share);this.K.podcastShowAdditionalMetadata&&
k.push.apply(k,g.ls((new HvK(this.K.podcastShowAdditionalMetadata)).D()));return[].concat(g.ls(new Set(k)))};
g.I(FN9,hK);FN9.prototype.D=function(){return[]};
g.I(azV,hK);
azV.prototype.D=function(){var k=[];this.K.musicLibraryStatusEntity&&k.push(this.K.musicLibraryStatusEntity);this.K.artists&&k.push.apply(k,g.ls(this.K.artists));this.K.audioModeVersion&&k.push(this.K.audioModeVersion);this.K.videoModeVersion&&k.push(this.K.videoModeVersion);this.K.userDetails&&k.push(this.K.userDetails);this.K.details&&k.push(this.K.details);this.K.albumRelease&&k.push(this.K.albumRelease);this.K.share&&k.push(this.K.share);this.K.libraryEdit&&k.push(this.K.libraryEdit);this.K.downloadMetadata&&
k.push(this.K.downloadMetadata);this.K.playbackPosition&&k.push(this.K.playbackPosition);this.K.lyrics&&k.push(this.K.lyrics);return[].concat(g.ls(new Set(k)))};
g.I(PXT,hK);PXT.prototype.D=function(){var k=[];this.K.parentTrack&&k.push(this.K.parentTrack);return[].concat(g.ls(new Set(k)))};
g.I(gST,hK);gST.prototype.D=function(){var k=[];this.K.parentTrack&&k.push(this.K.parentTrack);return[].concat(g.ls(new Set(k)))};
g.I(Ztd,hK);Ztd.prototype.D=function(){return[]};
g.I(NcG,hK);NcG.prototype.D=function(){return[]};
g.I(vS1,hK);vS1.prototype.D=function(){return[]};
g.I(Wfr,hK);Wfr.prototype.D=function(){return[]};
g.I(ivK,hK);ivK.prototype.D=function(){var k=[];this.K.transfer&&k.push(this.K.transfer);this.K.adsPlaybackData&&k.push.apply(k,g.ls(this.K.adsPlaybackData));this.K.drmLicense&&k.push(this.K.drmLicense);this.K.offlineVideoPolicy&&k.push(this.K.offlineVideoPolicy);this.K.videoDownloadContextEntity&&k.push(this.K.videoDownloadContextEntity);return[].concat(g.ls(new Set(k)))};
g.I(cm2,hK);cm2.prototype.D=function(){return[]};
g.I(Ov0,hK);Ov0.prototype.D=function(){var k=[];this.K.offlineVideoStreams&&k.push.apply(k,g.ls(this.K.offlineVideoStreams));this.K.captionTrack&&k.push.apply(k,g.ls(this.K.captionTrack));return[].concat(g.ls(new Set(k)))};
g.I(Hc1,hK);Hc1.prototype.D=function(){return[]};
g.I(Kq9,hK);Kq9.prototype.D=function(){return[]};
g.I(JMa,hK);JMa.prototype.D=function(){return[]};
g.I(P_r,hK);P_r.prototype.D=function(){return[]};
g.I(Ejd,hK);Ejd.prototype.D=function(){return[]};
g.I(kY0,hK);kY0.prototype.D=function(){return[]};
g.I(Wq9,hK);Wq9.prototype.D=function(){return[]};
g.I(tQr,hK);tQr.prototype.D=function(){return[]};
g.I(bcr,hK);bcr.prototype.D=function(){return[]};
g.I(fi9,hK);fi9.prototype.D=function(){return[]};
g.I(kVX,hK);kVX.prototype.D=function(){return[]};
g.I(GPG,hK);GPG.prototype.D=function(){return[]};
g.I(HKr,hK);HKr.prototype.D=function(){return[]};
g.I(y22,hK);y22.prototype.D=function(){return[]};
g.I(RfV,hK);RfV.prototype.D=function(){return[]};
g.I(MD0,hK);MD0.prototype.D=function(){return[]};
g.I(S4V,hK);S4V.prototype.D=function(){return[]};
g.I(zva,hK);zva.prototype.D=function(){return[]};
g.I(DW2,hK);DW2.prototype.D=function(){return[]};
g.I(Lf9,hK);Lf9.prototype.D=function(){return[]};
g.I(Eya,hK);Eya.prototype.D=function(){return[]};
g.I(gyK,hK);gyK.prototype.D=function(){return[]};
var vjT=["browse","music/browse","unplugged/browse"],fZ2=["offline/playlist_sync_check"],KBG=["offline"],Byr=["offline/offline_video_playback_position_sync"],GV9=["offline/get_playback_data_entity"],Ca;pa.getInstance=function(){return g.Q(function(k){return k.return(new Promise(function(a){g.g2().then(function(y){y?(pa.instance||(pa.instance=new pa(y)),a(pa.instance)):a(void 0)})}))})};
pa.prototype.get=function(k){var a=this,y,q,e;return g.Q(function(f){if(f.K==1)return g.p(f,Oc2(a.token),2);if(f.K!=3)return y=f.D,g.p(f,y.get("prefs",k),3);q=f.D;if(!q)return f.return();e=(0,g.Bi)();return q.expirationTimestampMs<=e?f.return():f.return(q.value)})};
pa.prototype.set=function(k,a,y){y=y===void 0?31536E3:y;var q=this,e,f,H;return g.Q(function(B){if(B.K==1)return e=(0,g.Bi)(),f={key:k,value:a,expirationTimestampMs:e+y*1E3},g.p(B,Oc2(q.token),2);H=B.D;return g.p(B,g.Ji(H,"prefs",f),0)})};
pa.prototype.remove=function(k){var a=this,y;return g.Q(function(q){if(q.K==1)return g.p(q,Oc2(a.token),2);y=q.D;return g.p(q,y.delete("prefs",k),0)})};
g.I(Dd,g.s_);g.I(na,MI9);na.prototype.j=function(k,a){a=mhT(a);k=(new TextEncoder).encode(JSON.stringify(k));return this.K.encrypt(k,a)};
na.prototype.D=function(k,a){if(!(k instanceof Uint8Array))throw cMK(1);var y=new TextDecoder;a=mhT(a);k=this.K.decrypt(k,a);return JSON.parse(y.decode(k))};
var aZ9={accountLinkStatusEntity:$vK,booleanEntity:HTd,buttonEntity:RfV,captionTrack:Ztd,channelHandle:Bo1,chipEntity:Wq9,commerceAcquisitionClientPayloadEntity:S4V,commerceCartListEntity:zva,compositeSourceEntity:oSX,multiviewStagingEntity:bKd,contextNoteFeedEntityPayload:yMr,contextNoteUserRatingEntityPayload:Nea,continuationTokenEntity:rhG,downloadQualityPickerEntity:ym9,downloadsPageRefreshTokenEntity:K39,downloadsPageViewConfigurationEntity:nyT,downloadStatusEntity:ei1,dismissState:tQr,sfvAudioItemCurrentlyPlayingEntity:P_r,
emojiFountainDataEntity:HKr,emojiCustomizationSetEntity:GPG,fakeChannel:aiG,fakePlaylist:wUG,fakePlaylistEntryCollection:ew1,fakeVideo:nS9,fakeVideoDescription:KfG,featuredProductsEntity:z2G,flowStateEntity:yy9,iconBadgeEntity:DW2,interstitialInteractionStateEntity:j59,likeButtonAnimationEntity:vi9,liveChatPollStateEntity:NNT,dataFreshnessEntity:kVX,liveViewerLeaderboardChatEntryPointStateEntity:Kq9,liveViewerLeaderboardPointsEntity:JMa,liveReactionsDataEntity:y22,logoEntity:njK,macroMarkerEntity:cSa,
mainDownloadsLibraryEntity:rmG,mainDownloadsListEntity:pX9,mainPlaylistDownloadStateEntity:Jy9,mainPlaylistEntity:dhd,mainPlaylistVideoEntity:mW0,mainVideoDownloadStateEntity:ZKd,mainVideoEntity:Te2,markersEngagementPanelSyncEntity:sgT,markersVisibilityOverrideEntity:G_9,musicAlbumReleaseDetail:Ii2,musicAlbumReleaseDownloadMetadataEntity:TkT,musicAlbumRelease:xW9,musicAlbumReleaseUserDetail:USX,musicArtistDetail:Y4V,musicArtist:s59,musicArtistUserDetail:Uh0,musicDownloadsLibraryEntity:FB9,musicLibraryEdit:$hX,
musicLibraryStatusEntity:ao9,musicPlaylist:ukX,musicPlaylistDownloadMetadataEntity:IDX,musicShare:FN9,musicTrackDetail:PXT,musicTrackDownloadMetadataEntity:Ber,musicTrack:azV,musicTrackUserDetail:gST,offlineOrchestrationActionWrapperEntity:NcG,offlineVideoPolicy:vS1,offlineVideoStreams:Wfr,offlineabilityEntity:SJd,orchestrationWebSamplingEntity:BcK,pageHeaderEntity:bcr,pdpStateEntity:Lf9,pinnedProductEntity:IZ2,playbackData:ivK,playerStateEntity:iT9,quantityIncrementerEntity:Eya,refresh:cm2,saveToPlaylistListEntity:Ejd,
selectedChipIndexEntityPayload:YJ2,settingEntity:kY0,stringEntity:dv9,suggestedFeedbackChipStateEntity:cE9,transfer:Ov0,trendingOfferEntity:Jh9,videoDownloadContextEntity:Hc1,videoOverviewAsyncDataEntity:gyK,videoPlaybackPositionEntity:MD0,votingEntity:fi9,ytMainChannelEntity:c29,youchatPendingResponseEntity:U31,ytMainDownloadedVideoEntity:Yi0,ytMainVideoEntity:u39};g.I(hG,MI9);hG.prototype.j=function(k){return k};
hG.prototype.D=function(k){if(k instanceof Uint8Array)throw cMK(0);return k};
g.I(tG,g.C);tG.prototype.observe=function(k){var a=this;this.observers.push(k);return function(){var y=a.observers.indexOf(k);y>=0&&a.observers.splice(y,1)}};
tG.prototype.D=function(k){AE9(this,k.data)};
tG.prototype.uj=function(){this.channel.close()};
var Dvr,yEa=new g.Xf("elementsCommand");var MP=new g.Xf("entityBatchUpdate");var Ayd=new g.Xf("downloadStatusEntity");var DS9=new g.Xf("mainPlaylistEntityActionMetadata");var Xh=new g.Xf("mainVideoEntityActionMetadata");var A29=new g.Xf("musicPlaylistEntityActionMetadata");var mj1=new g.Xf("musicTrackEntityActionMetadata");var VI0=new g.Xf("localImageEntityActionMetadata");var JK=new g.Xf("playbackDataActionMetadata");var Dh9=new g.Xf("transferEntityActionMetadata");var FqG=new g.Xf("videoPlaybackPositionEntityActionMetadata");var kg2;new g.hu;new g.hu;SSX.prototype.request=function(k,a,y){a=a===void 0?{}:a;return this.locks.request(k,a,function(q){return y(q)})};var Ka=g.DP.caches,Es,cyd;Ij.prototype.open=function(k){return Ka.open(CA2(k))};
Ij.prototype.has=function(k){return Ka.has(CA2(k))};
Ij.prototype.delete=function(k){return Ka.delete(CA2(k))};
Ij.prototype.match=function(k,a){var y=this,q,e,f,H,B,Z;return g.Q(function(z){switch(z.K){case 1:return g.p(z,y.keys(),2);case 2:q=z.D,e=g.A(q),f=e.next();case 3:if(f.done){z.X5(5);break}H=f.value;return g.p(z,y.open(H),6);case 6:return B=z.D,g.p(z,B.match(k,a),7);case 7:if(Z=z.D)return z.return(Z);f=e.next();z.X5(3);break;case 5:return z.return()}})};
g.I(LB9,Ij);LB9.prototype.keys=function(){var k,a,y,q,e,f,H,B,Z;return g.Q(function(z){if(z.K==1)return k=[],a=g.BG("CacheStorage keys"),g.p(z,Ka.keys(),2);y=z.D;q=g.A(y);for(e=q.next();!e.done;e=q.next()){f=e.value;var Y=f.indexOf(":");H=Y===-1?{hg:f}:{hg:f.substring(0,Y),datasyncId:f.substring(Y+1)};B=H.hg;Z=H.datasyncId;Z===a&&k.push(B)}return z.return(k)})};g.I(Fg,g.C);Fg.prototype.j=function(k){this.api.qE("onOfflineOperationFailure",k.data)};
Fg.prototype.L=function(k){this.api.publish("offlinetransferpause",k.data)};
Fg.prototype.uj=function(){var k;(k=this.K)==null||k.close();var a;(a=this.D)==null||a.close()};oi9.prototype.AV=function(){this.K&&Pu(this)};
oi9.prototype.JB=function(){this.D&&this.D.resolve();this.j=this.K=!1;this.aj()};var Io2=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var r29="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var CN9="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.I(WKT,Xg);WKT.prototype.D=function(k){return Gy(k)?oU0(this,k):oj(k)?D3K(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.I(YS2,Xg);YS2.prototype.D=function(k){return oj(k)?h2r(this,k):gi1(k)?ojT(this,k):La(k)?YpT(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.S=xj0.prototype;g.S.GEs=function(k){var a=this,y,q,e,f;return g.Q(function(H){if(!g.h(k.state,128))return H.X5(0);y=k.state.tF;var B=(q=y)==null?void 0:q.errorCode,Z=(e=y)==null?void 0:e.LJ;f=B==="net.connect"&&Z===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(B==null?0:B.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.p(H,a.B5(a.player.getVideoData().videoId,f),0)})};
g.S.B5=function(k,a){var y=this;return g.Q(function(q){if(q.K==1){if(y.D)return q.return();y.D=!0;return a==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(CQ(y,k,!1,!0),q.X5(0)):g.p(q,cu(y,k),3)}g.uz(k,4);return g.p(q,y.K.B5(a),0)})};
g.S.y6=function(k){k.status===2?(k.status!==this.j&&(Nkr(this.K),g.uz(k.videoId,2)),k.rI&&fGr(this.K,k.videoId,k.rI)):k.status===4?(cu(this,k.videoId),this.B5(k.videoId,k.uP?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):k.status===1&&m3T(this.K);this.j=k.status;this.api.qE("localmediachange",{videoId:k.videoId,status:k.status})};
g.S.KP=function(){var k=this,a;return g.Q(function(y){if(y.K==1){if(k.D)return y.return();k.D=!0;a=k.player.getVideoData().videoId;return g.p(y,cu(k,a),2)}return g.p(y,k.K.KP(),0)})};
g.S.xE=function(k){switch(k){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.S.W=function(k){return this.api.Z().W(k)};g.I(tI1,Xg);tI1.prototype.D=function(k){return Gy(k)?chr(this,k):oj(k)?tmG(this,k):gi1(k)?zfr(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};Qw9.prototype.K=function(k,a){var y=k.action.actionMetadata.priority-a.action.actionMetadata.priority;y===0&&(k.K<a.K?y=-1:k.K>a.K&&(y=1));return y};g.I(Wu,g.C);Wu.prototype.uj=function(){this.aj&&this.aj();g.C.prototype.uj.call(this)};
Wu.prototype.createAction=function(k,a){var y=g.Yx(k.entityKey).entityType,q=g.fv(16);return new Bu(y,q,k,a.actionId,a.rootActionId)};
Wu.prototype.vz=function(k){var a=this,y,q,e,f,H,B,Z,z,Y;return g.Q(function(r){if(r.K==1){if(a.xs())return r.return();q=(y=k.offlineOrchestrationActionWrapperEntity)!=null?y:new Set;e=[];f=g.A(q);for(H=f.next();!H.done;H=f.next())B=H.value,Z=g.Yx(B),z=Z.entityId,lid(a.K,z)||e.push(B);return g.p(r,GjK(a,e),2)}Y=r.D;return g.p(r,Vl9(a,Y),0)})};
Wu.prototype.retry=function(){var k=this;return g.Q(function(a){return g.p(a,bj9(k),0)})};wXG.prototype.YH=function(k,a){a=a===void 0?!0:a;var y=this,q,e,f,H,B,Z,z,Y;return g.Q(function(r){switch(r.K){case 1:if(!y.K)return r.return();q=[];e=g.nF(y.K.D,a);f=[];for(H={sW:0};H.sW<e.length;H={sW:H.sW},H.sW++)B=e[H.sW],Z=y.K.F7(B,"json3"),z=g.CN(Z,{withCredentials:!0,format:"RAW"},3,500).then(function(W){return function(m){m={metadata:g.AI(e[W.sW]),trackData:m.xhr.responseText};f.push(m)}}(H)).Bd(function(W){u1("Caption fetch error",W)}),q.push(z);
return g.p(r,ZvX(q),2);case 2:return g.p8(r,3),g.p(r,L39(k,f),5);case 5:g.St(r,0);break;case 3:Y=g.vh(r),u1("Caption DB transaction error",Y),g.wg(r)}})};g.I(Os,g.C);Os.prototype.uj=function(){this.D&&this.D();g.C.prototype.uj.call(this)};
Os.prototype.j=function(k){var a=this,y,q,e,f,H,B,Z,z;return g.Q(function(Y){q=(y=k.transfer)!=null?y:new Set;e=[];f=g.A(q);for(H=f.next();!H.done;H=f.next())B=H.value,Z=g.Yx(B),z=Z.entityId,e.push(z);return e.length===0?Y.return():g.p(Y,MQT(a,e),0)})};g.I(x32,g.C);g.S=x32.prototype;g.S.uj=function(){this.Lw&&this.Lw();this.JG.dispose();this.L.dispose();this.Ij&&g.MS(this.N.nY,this.Ij);this.NE&&g.MS(this.N.nY,this.NE);g.C.prototype.uj.call(this)};
g.S.CpZ=function(k){var a=this,y,q,e;return g.Q(function(f){switch(f.K){case 1:y=g.j5(k,"transfer");if(a.K&&y===a.K.key){CQ(a.G,a.X,!0);a.L.stop();f.X5(0);break}return g.p(f,tK(a.D,{mode:"readwrite",TE:!0},function(H){return EL(H,y,"transfer").then(function(B){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!=="TRANSFER_STATE_FAILED")return B.transferState="TRANSFER_STATE_PAUSED_BY_USER",kM(H,B,"transfer").then(function(){return B})})}),3);
case 3:q=f.D;if(!q){f.X5(0);break}if(!k||!a.j){f.X5(5);break}return g.p(f,Rj(k,a.j,a.D,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.p(f,qP(a,k),7);case 7:e=f.D,z8a({videoId:k,yI:q,offlineModeType:e}),g.wg(f)}})};
g.S.wlZ=function(){var k=this;if(this.K&&this.X){CQ(this.G,this.X,!1);var a=this.K,y=(a==null?0:a.key)?g.Yx(a.key).entityId:"";y&&this.j&&(new Promise(function(q,e){Rj(y,k.j,k.D,"DOWNLOAD_STATE_PAUSED").catch(function(f){e(f)})})).catch(function(q){u1("Download state setting error",q)})}this.L.stop()};
g.S.Dw=function(){this.K?oP0(this,this.K):Us(this)};
g.S.Am=function(k){var a=this;return g.Q(function(y){switch(y.K){case 1:if(!a.K){y.X5(2);break}if(a.K.transferState==="TRANSFER_STATE_COMPLETE"||a.K.transferState==="TRANSFER_STATE_FAILED"||!k.transfer||!k.transfer.has(a.K.key)){y.X5(3);break}return g.p(y,Fh(a.D,a.K.key,"transfer"),4);case 4:a.K=y.D;if(a.K){y.X5(3);break}return g.p(y,XXX(a),3);case 3:if(a.K)return y.return();case 2:return g.p(y,Us(a),0)}})};
g.S.B5=function(k,a){var y=this,q,e,f,H,B;return g.Q(function(Z){switch(Z.K){case 1:if(!y.K){QZ(y,"onTransferFailure: "+k);Z.X5(2);break}q=y.K;f=((e=q)==null?0:e.key)?g.Yx(q.key).entityId:"";a:switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var z=!1;break a;default:z=!0}return z&&mv0(y)?g.p(Z,xM(y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.p(Z,
Wy0(y,k),5);case 5:if(!f||!y.j){Z.X5(2);break}return g.p(Z,Rj(f,y.j,y.D,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.p(Z,qP(y,f),9);case 9:H=Z.D;e4({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:f,yI:q,offlineModeType:H});if(!f||!y.j){Z.X5(2);break}return g.p(Z,Rj(f,y.j,y.D,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:S4(y),B=Us(y,!0),a&&a(B),g.wg(Z)}})};
g.S.KP=function(k){var a=this,y,q,e,f,H,B,Z,z,Y,r,W,m;return g.Q(function(T){switch(T.K){case 1:if(!a.K){QZ(a,"onMaybeTransferStreamsExpired");T.X5(2);break}return mv0(a)?g.p(T,xM(a,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.p(T,Wy0(a,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!a.j){T.X5(2);break}y=a.K;e=((q=y)==null?0:q.key)?g.Yx(y.key).entityId:"";if(!e){T.X5(2);break}return g.p(T,Rj(e,a.j,a.D,"DOWNLOAD_STATE_FAILED"),2);case 9:return a.K||QZ(a,"onMaybeTransferStreamsExpiredRetryAttempting"),
f=a.K,B=((H=f)==null?0:H.key)?g.Yx(f.key).entityId:"",g.p(T,qP(a,B),10);case 10:return Z=T.D,e4({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:B,yI:f,offlineModeType:Z}),z=rMK(),g.jb(z,JK,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Y=g.j5(B,"playbackData"),r={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:Y,actionMetadata:z},W=Zd(new Bu("playbackData",B,r)),g.p(T,oS(a.D,W,"offlineOrchestrationActionWrapperEntity"),2);case 2:S4(a),m=Us(a,!0),
k&&k(m),g.wg(T)}})};
var ES0={},gjK=(ES0.TRANSFER_STATE_TRANSFERRING=1,ES0.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ES0);g.S=uR.prototype;g.S.Hy=function(){return this.X.promise};
g.S.LB=function(){if(this.D&&this.G)return this.X.promise;bv0(this).then(this.X.resolve).catch(this.X.reject);return this.X.promise};
g.S.RW=function(k){var a={};return a.playbackData=new WKT(k,this.B,this.K),a.transfer=new tI1(k,this.B),a.videoPlaybackPositionEntity=new YS2(k,this.B),a};
g.S.W8=function(){var k=this;return g.Q(function(a){return k.D?g.p(a,Xar(k.D),0):a.X5(0)})};
g.S.Xa=function(){var k=this,a,y;return g.Q(function(q){if(q.K==1)return k.D||k.G?g.p(q,k.Hy(),2):q.return();k.V!==void 0&&(g.Gt(k.V),k.V=void 0);k.L!==void 0&&(g.Gt(k.L),k.L=void 0);(a=k.D)==null||a.dispose();k.D=void 0;(y=k.G)==null||y.dispose();k.G=void 0;k.api.qE("onOrchestrationLostLeader");k.X=new g.hu;g.wg(q)})};
g.S.isOrchestrationLeader=function(){return this.j.K};
g.S.RD=function(){return g.Q(function(k){return k.return(!1)})};
g.S.Aw=function(k){var a=this.K;a.api.publish("offlinetransferpause",k);var y;(y=a.D)==null||y.postMessage(k)};
g.S.Dw=function(k){var a,y;return g.Q(function(q){if(q.K==1)return g.p(q,dA(),2);a=q.D;if(!a)return q.return();y=g.j5(k,"transfer");return g.p(q,tK(a,{mode:"readwrite",TE:!0},function(e){var f=EL(e,y,"transfer"),H=EL(e,g.j5(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.NY.all([f,H]).then(function(B){B=g.A(B);var Z=B.next().value;var z=B.next().value;return Z&&Z.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(Z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",kM(e,Z,"transfer").then(function(){e4({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:k,yI:Z,offlineModeType:z==null?void 0:z.offlineModeType});return g.NY.resolve(null)})):g.NY.resolve(null)})}),0)})};
g.S.P8=function(k){k=k===void 0?43200:k;var a=this,y,q,e,f,H,B,Z,z;return g.Q(function(Y){if(Y.K==1)return a.N.Ca()?g.p(Y,dA(),2):Y.return(Qg9());if(Y.K!=3){y=Y.D;if(!y)return Y.return([]);q=Date.now()/1E3;return g.p(Y,j4(y,"offlineVideoPolicy"),3)}e=Y.D;f=[];H=g.A(e);for(B=H.next();!B.done;B=H.next())Z=B.value,Number(Z.lastUpdatedTimestampSeconds)+k<=q&&(z=g.Yx(Z.key).entityId,f.push(z));return f.length?Y.return(zy(a,f,a.aj,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):Y.return([])})};
g.S.deleteAll=function(){return zy(this,["!*$_ALL_ENTITIES_!*$"],this.aj,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.S.refreshAllStaleEntities=function(k){var a=this;return g.Q(function(y){return y.K==1?g.p(y,a.P8(k),2):y.return(y.D)})};
g.S.setUpPositionSyncInterval=function(k){var a=this;this.L!==void 0&&(g.Gt(this.L),this.L=void 0);var y=k!=null?k:864E5;this.L=g.qx(function(){a.BL(y)},y)};
g.S.BL=function(k){var a=this,y,q,e,f,H,B;return g.Q(function(Z){switch(Z.K){case 1:return g.p8(Z,2),g.p(Z,pa.getInstance(),4);case 4:y=Z.D;if(!y)throw Error("prefStorage is undefined");return g.p(Z,y.get("psi"),5);case 5:q=Z.D;f=((e=q)==null?0:e.Df)?Number(q.Df)/1E3:0;H=Date.now();if(!(f+k<=H)){Z.X5(6);break}return g.p(Z,zy(a,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.St(Z,0);break;case 2:B=g.vh(Z),u1("Offline manager error",B),
g.wg(Z)}})};
g.S.Ju=function(){var k=this,a,y,q,e,f,H,B;return g.Q(function(Z){if(Z.K==1)return g.p(Z,dA(),2);if(Z.K!=3)return(a=Z.D)?g.p(Z,j4(a,"transfer"),3):Z.return([]);y=Z.D;q=[];e=g.A(y);for(f=e.next();!f.done;f=e.next())H=f.value,H.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&H.key&&(B=g.Yx(H.key).entityId,q.push(B));return Z.return(NyK(k,q))})};
g.S.vH=function(){return g.Q(function(k){return k.return([])})};
g.S.Ig=function(){return g.Q(function(k){g.wg(k)})};
g.S.Vb=function(){return g.Q(function(k){g.wg(k)})};g.I(MVX,Xg);MVX.prototype.D=function(k){return Gy(k)?jgX(this,k):oj(k)?Ri9(this,k):La(k)?JE2(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var iR=[10];g.I(Ah0,Xg);Ah0.prototype.D=function(k){return Gy(k)?Uva(this,k):oj(k)?zwG(this,k):La(k)?kjG(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var ZT9=[10];g.I(k_r,Xg);k_r.prototype.D=function(k){return oj(k)?btr(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.I(t$2,uR);g.S=t$2.prototype;g.S.RW=function(k){var a=uR.prototype.RW.call(this,k);a.mainVideoEntity=new Ah0(k,this.B,this.K);a.mainPlaylistEntity=new MVX(k,this.B,this.K);a.mainDownloadsListEntity=new k_r(k,this.B,this.K);return a};
g.S.refreshAllStaleEntities=function(k,a){var y=this,q,e,f,H,B,Z,z,Y,r,W,m;return g.Q(function(T){switch(T.K){case 1:q=[];if(!y.B.W("web_player_offline_playlist_auto_refresh")){T.X5(2);break}return g.p(T,v8d(y,k,a),3);case 3:q=T.D;case 2:return g.p(T,pa.getInstance(),4);case 4:return e=T.D,g.p(T,(f=e)==null?void 0:f.get("sdois"),5);case 5:return H=T.D,g.p(T,(B=e)==null?void 0:B.get("lmqf"),6);case 6:Z=T.D;if(!H){T.X5(7);break}Y=q;r=Y.concat;return g.p(T,SeK(y,H,(z=Z)!=null?z:"SD",k===0),8);case 8:q=
r.call(Y,T.D);case 7:return W=q,m=W.concat,g.p(T,uR.prototype.refreshAllStaleEntities.call(y,k,a),9);case 9:return q=m.call(W,T.D),T.return(q)}})};
g.S.RD=function(k){var a,y,q,e,f,H,B,Z;return g.Q(function(z){if(z.K==1)return g.p(z,dA(),2);if(z.K!=3)return(a=z.D)?g.p(z,Fh(a,g.nw,"mainDownloadsListEntity"),3):z.return(!1);y=z.D;if((q=y)==null?0:(e=q.downloads)==null?0:e.length)for(f=g.j5(k,"mainVideoEntity"),H=g.A(y.downloads),B=H.next();!B.done;B=H.next())if(Z=B.value,Z.videoItem===f)return z.return(!0);return z.return(!1)})};
g.S.vH=function(){var k=this,a,y,q,e,f,H,B,Z;return g.Q(function(z){if(z.K==1)return g.p(z,dA(),2);if(z.K!=3)return(a=z.D)?g.p(z,j4(a,"downloadStatusEntity"),3):z.return([]);y=z.D;q=[];e=g.A(y);for(f=e.next();!f.done;f=e.next())H=f.value,H.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&H.key&&(B=g.Yx(H.key).entityId,q.push(B));return q.length?(Z={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},z.return(zy(k,q,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Z))):z.return([])})};
g.S.Vb=function(){var k;return g.Q(function(a){return a.K==1?g.p(a,dA(),2):(k=a.D)?g.p(a,tK(k,{mode:"readwrite",TE:!0},function(y){return wA(y,"mainVideoEntity").then(function(q){var e=[];q=g.A(q);for(var f=q.next();!f.done;f=q.next()){f=f.value;var H=void 0;(H=f.userState)!=null&&H.playbackPosition||(H=g.Yx(f.key).entityId,H={key:g.j5(H,"videoPlaybackPositionEntity"),videoId:H,lastPlaybackPositionSeconds:"0"},e.push(kM(y,H,"videoPlaybackPositionEntity")),f.userState={playbackPosition:H.key},e.push(kM(y,
f,"mainVideoEntity")))}return g.NY.all(e)})}),0):a.return()})};
g.S.Ig=function(){var k,a,y,q,e,f,H,B,Z,z,Y,r,W,m,T,O,x,V,l,P,N,F,t,M,ea,Zl,fG,r4,a3,OZ,I3,ka,Ya,CG,AO,K1,p1,oV;return g.Q(function(b){if(b.K==1)return g.p(b,dA(),2);if(b.K!=3){k=b.D;if(!k)return b.return();a=g.j5("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.p(b,tK(k,{mode:"readonly",TE:!0},function(Yh){return g.NY.all([EL(Yh,a,"mainDownloadsListEntity"),EL(Yh,g.nw,"mainDownloadsListEntity"),wA(Yh,"mainVideoEntity"),wA(Yh,"mainPlaylistEntity")])}),3)}y=b.D;
q=g.A(y);e=q.next().value;f=q.next().value;H=q.next().value;B=q.next().value;Z=e;z=f;Y=H;r=B;W=new Set;if((m=Z)==null?0:(T=m.downloads)==null?0:T.length)for(O=g.A(Z.downloads),x=O.next();!x.done;x=O.next())V=x.value,l=void 0,(P=(l=V.videoItem)!=null?l:V.playlistItem)&&W.add(P);if((N=z)==null?0:(F=N.downloads)==null?0:F.length)for(t=g.A(z.downloads),M=t.next();!M.done;M=t.next())ea=M.value,ea.videoItem&&W.add(ea.videoItem);Zl=new Set;fG=[];r4=g.A(r);for(a3=r4.next();!a3.done;a3=r4.next()){OZ=a3.value;
if(OZ.videos)for(I3=g.A(OZ.videos),ka=I3.next();!ka.done;ka=I3.next())Ya=ka.value,(CG=JSON.parse(g.Yx(Ya).entityId).videoId)&&Zl.add(CG);OZ.key&&!W.has(OZ.key)&&fG.push(OZ.key)}AO=g.A(Y);for(K1=AO.next();!K1.done;K1=AO.next())p1=K1.value,p1.key&&!W.has(p1.key)&&(oV=g.Yx(p1.key).entityId,Zl.has(oV)||fG.push(p1.key));return fG.length?g.p(b,lo0(k,fG),0):b.X5(0)})};g.I(FyX,Xg);FyX.prototype.D=function(k){return Gy(k)?ZjX(this,k):oj(k)?tDG(this,k):La(k)?NoV(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var $M=[10];g.I(LNV,Xg);LNV.prototype.D=function(k){return Gy(k)?wL9(this,k):oj(k)?PN9(this,k):La(k)?GgG(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var AG=[10];g.I(vyG,Xg);vyG.prototype.D=function(k){return Gy(k)?hfV(this,k):oj(k)?Sp0(this,k):La(k)?TNV(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var TyT=[10];g.I(kr,uR);kr.prototype.RW=function(k){var a=uR.prototype.RW.call(this,k);a.musicTrack=new vyG(k,this.K);a.musicPlaylist=new LNV(k,this.K);a.musicAlbumRelease=new FyX(k,this.K);return a};
kr.prototype.refreshAllStaleEntities=function(k,a){var y=this,q,e,f;return g.Q(function(H){if(H.K==1)return g.p(H,tVG(y,k,a),2);if(H.K!=3)return e=q=H.D,f=e.concat,g.p(H,uR.prototype.refreshAllStaleEntities.call(y,k,a),3);q=f.call(e,H.D);return H.return(q)})};g.I(o89,g.pF);g.S=o89.prototype;g.S.create=function(){var k=this;g.U(this,this.events);if(g.ry(this.B))this.K=new t$2(this.B,this.player);else if(g.mi(this.B)||g.Tn(this.B))this.K=new kr(this.B,this.player);this.events.Y(this.player,"onPlaybackStartExternal",function(){k.qW()});
this.events.Y(this.player,"videodatachange",function(){k.qW()});
this.B.W("html5_offline_playback_position_sync")&&this.events.Y(this.player,"presentingplayerstatechange",this.Lb)};
g.S.fY=function(){return!1};
g.S.MC=function(k,a,y,q){var e=this;return g.Q(function(f){return e.K?f.return(zy(e.K,k,a,y,q)):f.return(Promise.reject())})};
g.S.deleteAll=function(){return this.K.deleteAll()};
g.S.P8=function(k){return this.K.P8(k)};
g.S.refreshAllStaleEntities=function(k){return this.K.refreshAllStaleEntities(k)};
g.S.setUpPositionSyncInterval=function(k){this.K.setUpPositionSyncInterval(k)};
g.S.Aw=function(k){this.K.Aw(k)};
g.S.Dw=function(k){return this.K.Dw(k)};
g.S.qW=function(){var k=this,a;return g.Q(function(y){a=k.player.getVideoData();return g.gQ(a)?tlK(a)&&k.D!==a.clientPlaybackNonce?g.p(y,E82(k,a),0):y.X5(0):y.return()})};
g.S.Lb=function(k){var a=this,y,q,e,f,H,B,Z;return g.Q(function(z){if(z.K==1)return y=a.player.getVideoData(),q=y.iY,g.QI(k,2)||g.QI(k,512)?g.p(z,dA(),2):z.return();if(z.K!=3){e=z.D;if(!e)return u1("PES is undefined"),z.return();f=y.videoId;return g.p(z,Fh(e,g.j5(f,"mainVideoEntity"),"mainVideoEntity"),3)}H=z.D;if(!H)return z.return();B=Math.floor(q).toString();Z={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:B}};return g.p(z,a.MC([f],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
Z),0)})};
g.S.isOrchestrationLeader=function(){return this.K.isOrchestrationLeader()};
g.S.updateDownloadState=function(k,a){var y,q,e,f;return g.Q(function(H){if(H.K==1)return g.p(H,dA(),2);y=H.D;if(!y)return u1("PES is undefined"),H.return();q=g.Yx(k);e=q.entityType;f=q.entityId;return g.p(H,Rj(f,e,y,a,!0),0)})};g.ht("offline",o89);})(_yt_player);
